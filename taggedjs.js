(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,r(o.key),o)}}function r(e){var r=function(e,r){if("object"!=t(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!=t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(r)?r:String(r)}var n=[];function o(t,e){var r=t.indexOf(e);-1!==r&&t.splice(r,1)}function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,f(n.key),n)}}function u(){return u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=l(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},u.apply(this,arguments)}function c(t,e){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},c(t,e)}function s(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function l(t){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},l(t)}function f(t){var e=function(t,e){if("object"!=i(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==i(e)?e:String(e)}var p=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&c(t,e)}(y,t);var e,r,n,o,p=(n=y,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=l(n);if(o){var r=l(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return s(t)}(this,t)});function y(t){var e,r,n,o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,y),r=s(e=p.call(this)),o=void 0,(n=f(n="value"))in r?Object.defineProperty(r,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[n]=o,e.value=t,e}return e=y,(r=[{key:"subscribe",value:function(t){var e=u(l(y.prototype),"subscribe",this).call(this,t);return t(this.value),e}}])&&a(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),y}(function(){function t(){var e,n,o;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e=this,n="next",o=this.set,(n=r(n))in e?Object.defineProperty(e,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[n]=o,this.subscribers=[]}var i,a;return i=t,(a=[{key:"subscribe",value:function(t){var e=this;this.subscribers.push(t),n.push(t);var r=function(){o(e.subscribers,t),o(n,t)};return r.unsubscribe=r,r}},{key:"set",value:function(t){this.value=t,this.subscribers.forEach((function(e){e.value=t,e(t)}))}}])&&e(i.prototype,a),Object.defineProperty(i,"prototype",{writable:!1}),t}());function y(t){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y(t)}function v(t,e){if(t===e)return!0;if("object"!==y(t)||"object"!==y(e)||null===t||null===e)return!1;var r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(var o=0,i=r;o<i.length;o++){var a=i[o];if(!n.includes(a)||!v(t[a],e[a])){if(t[a]instanceof Function&&e[a]instanceof Function&&t[a].toString()===e[a].toString())continue;return!1}}if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(var u=0;u<t.length;u++)if(!v(t[u],e[u]))return!1}else if(Array.isArray(t)||Array.isArray(e))return!1;return!0}var g={templater:function(){},renderCount:0,mutatingRender:function(){throw new Error('Tag function "render()" was called in sync but can only be called async')},render:function(){},init:function(t){},async:function(t){return function(){var e=t.apply(void 0,arguments);tagSupport.render(),e instanceof Promise&&e.then((function(){tagSupport.render()}))}},hasPropChanges:function(t,e,r){var n=this.templater.cloneProps;return!(void 0===t&&t===r||v(e,n))}};function h(t){var e={templater:t,renderCount:0,mutatingRender:function(){throw new Error('Tag function "render()" was called in sync but can only be called async')},render:function(){return++e.renderCount,e.mutatingRender.apply(e,arguments)},hasPropChanges:function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return g.hasPropChanges.apply(e,r)},init:function(t){t(),e.init=function(){}},async:function(t){return function(){var r=t.apply(void 0,arguments);e.render(),r instanceof Promise&&r.then((function(){e.render()}))}}};return e}var d={array:[],rearray:[],currentTag:void 0,ownerTag:void 0};function b(t){return t instanceof Function&&t.toString().includes("html`")}var m={array:[],rearray:[],currentTag:void 0};function S(t){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},S(t)}function w(t){return function(t){if(Array.isArray(t))return T(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return T(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?T(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function P(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,R(n.key),n)}}function j(t,e,r){return(e=R(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function R(t){var e=function(t,e){if("object"!=S(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=S(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==S(e)?e:String(e)}var O="__tagVar",k="--"+O+"--",E=new RegExp(O,"g"),C=(new RegExp(k,"g"),[{beforeRedraw:function(t){var e;m.currentTag=t,t.states.length&&(e=m.rearray).push.apply(e,w(t.states))},afterRender:function(t){if(m.rearray.length&&m.rearray.length!==m.array.length)throw new Error("States lengths mismatched ".concat(m.rearray.length," !== ").concat(m.array.length));m.rearray.length=0,t.states=w(m.array),m.array.length=0}},{beforeRedraw:function(t){var e;d.currentTag=t,d.ownerTag=t.ownerTag,t.providers.length&&(e=d.rearray).push.apply(e,w(t.providers))},afterRender:function(t){if(d.rearray.length&&d.rearray.length!==d.array.length)throw new Error("Providers lengths mismatched ".concat(d.rearray.length," !== ").concat(d.array.length));d.rearray.length=0,t.providers=w(d.array),d.array.length=0}}]),A=function(){function t(e,r){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),j(this,"context",{}),j(this,"clones",[]),j(this,"cloneSubs",[]),j(this,"children",[]),j(this,"tagSupport",void 0),j(this,"states",[]),j(this,"providers",[]),j(this,"lastTemplateString",void 0),this.strings=e,this.values=r}return e=t,r=[{key:"beforeRedraw",value:function(){var t=this;C.forEach((function(e){return e.beforeRedraw(t)}))}},{key:"afterRender",value:function(){var t=this;C.forEach((function(e){return e.afterRender(t)}))}},{key:"key",value:function(t){return this.arrayValue=t,this}},{key:"destroy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1?arguments[1]:void 0;return this.children.forEach((function(t,e){return t.destroy(0,!0)})),this.destroySubscriptions(),e||(t=this.destroyClones(t).stagger),t}},{key:"destroySubscriptions",value:function(){this.cloneSubs.forEach((function(t){return t.unsubscribe()})),this.cloneSubs.length=0}},{key:"destroyClones",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.clones.reverse().forEach((function(e,r){var n=Promise.resolve();e.ondestroy&&(n=function(t,e){var r=t.ondestroy;if(r){var n=r.tagFunction;if(n){var o=n.tagFunction;if(o)return o({target:t,stagger:e})}}}(e,t)),n.then((function(){return e.parentNode.removeChild(e)}))})),this.clones.length=0,t}},{key:"updateByTag",value:function(t){this.updateConfig(t.strings,t.values),this.tagSupport.templater=t.tagSupport.templater}},{key:"setSupport",value:function(t){this.tagSupport=this.tagSupport||t,this.tagSupport.mutatingRender=this.tagSupport.mutatingRender||t.mutatingRender,this.children.forEach((function(e){return e.setSupport(t)}))}},{key:"updateConfig",value:function(t,e){this.strings=t,this.updateValues(e)}},{key:"getTemplate",value:function(){var t=this;return{string:this.lastTemplateString=this.strings.map((function(e,r){return e.replace(E,k)+(t.values.length>r?"{".concat(O).concat(r,"}"):"")})).join(""),strings:this.strings,values:this.values,context:this.context}}},{key:"isLikeTag",value:function(e){var r=this;return e.lastTemplateString===this.lastTemplateString&&e.values.length===this.values.length&&!!e.values.every((function(e,n){var o=r.values[n];return e instanceof Function&&o instanceof Function?!(e.toString()!==o.toString()):!(e instanceof t&&o instanceof t&&(e.ownerTag=r,r.children.push(e),e.lastTemplateString||e.getTemplate().string,!e.isLikeTag(o)))}))}},{key:"update",value:function(){return this.updateContext(this.context)}},{key:"updateValues",value:function(t,e){return this.values=t,this.updateContext(this.context,e)}},{key:"updateContext",value:function(e){var r=this;return this.strings.map((function(n,o){var i=O+o,a=r.values.length>o,u=r.values[o],c=e[i];if(c){var s,l=null===(s=c.value)||void 0===s?void 0:s.tag;if(b(u)){var f,y,g=u.cloneProps,d=c.tag;if(!c.tag)return F(u,c,r),void u.redraw(g);var m=d.tagSupport,S=u.tagSupport||m||h(u),w=null===(f=S.templater)||void 0===f?void 0:f.cloneProps,T=null===(y=S.templater)||void 0===y?void 0:y.props;if(d&&(void 0===T&&T===g||v(w,g)))return;return F(u,c,r),m.templater=u,void(c.value.tag=m.newest=u.redraw(g))}if(l){var P=l.tagSupport,j=u;P.oldest.beforeRedraw();var R=j(P);return j.newest=R,P.oldest.afterRender(),l.updateByTag(R),void c.set(u)}return u instanceof Function?void c.set(x(u,r)):void c.set(u)}b(u)?F(u,e[i]=new p(u),r):u instanceof Function?e[i]=function(t,e){return new p(x(t,e))}(u,r):a&&(u instanceof t&&(u.ownerTag=r,r.children.push(u)),e[i]=new p(u))})),e}},{key:"getAppElement",value:function(){for(var t=this;t.ownerTag;)t=t.ownerTag;return t}}],r&&P(e.prototype,r),n&&P(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t;var e,r,n}();function x(t,e){function r(r,n){var o=e.tagSupport.renderCount,i=t.bind(r).apply(void 0,w(n));if(o===e.tagSupport.renderCount)return e.tagSupport.render(),i instanceof Promise&&i.then((function(){e.tagSupport.render()})),i}return r.tagFunction=t,r}function F(t,e,r){var n=this;t.redraw=function(){var o,i=e.tag,a=(null==i?void 0:i.tagSupport)||h(t);++a.renderCount,e.tagSupport=a,a.mutatingRender=a.mutatingRender||(null===(o=e.tagSupport)||void 0===o?void 0:o.mutatingRender)||n.tagSupport.mutatingRender;var u=(null==i?void 0:i.ownerTag)||r;a.oldest?a.oldest.beforeRedraw():d.ownerTag=u;var c=t(a);a.oldest?a.oldest.afterRender():c.afterRender(),t.newest=c,c.ownerTag=u,a.oldest=a.oldest||c,a.newest=c;var s=a.oldest.tagSupport;if(a.oldest.tagSupport=s||a,a.oldest.tagSupport.templater=t,c.setSupport(a),!i||!i.isLikeTag(c))return e.set(t),c;a.oldest.updateByTag(c)}}new A})();