var e={519:e=>{function t(e){return Promise.resolve().then((()=>{return import(e);throw t.code="MODULE_NOT_FOUND",t}))}t.keys=()=>[],t.resolve=t,t.id=519,e.exports=t}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,r),a.exports}r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{class e{isSubject=!0;subscribers=[];value;subscribe(e){this.subscribers.push(e),n.globalSubs.push(e),n.globalSubCount$.set(n.globalSubCount$.value+1);const r=()=>{r.unsubscribe()};return r.unsubscribe=()=>{t(this.subscribers,e),t(n.globalSubs,e),n.globalSubCount$.set(n.globalSubCount$.value-1),r.unsubscribe=()=>{}},r}set(e){this.value=e,this.subscribers.forEach((t=>{t.value=e,t(e)}))}next=this.set}function t(e,t){const r=e.indexOf(t);-1!==r&&e.splice(r,1)}const n=e;function o(e,t=new WeakMap){if(null===e||"object"!=typeof e)return e;if(t.has(e))return t.get(e);if(e instanceof Date)return new Date(e);if(e instanceof RegExp)return new RegExp(e);const r=Array.isArray(e)?[]:Object.create(Object.getPrototypeOf(e));if(t.set(e,r),Array.isArray(e))for(let n=0;n<e.length;n++)r[n]=o(e[n],t);else for(const n in e)e.hasOwnProperty(n)&&(r[n]=o(e[n],t));return r}function a(e,t){if(e===t)return!0;if("object"!=typeof e||"object"!=typeof t||null===e||null===t)return!1;const r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(const o of r)if(!n.includes(o)||!a(e[o],t[o])){if(e[o]instanceof Function&&t[o]instanceof Function&&e[o].toString()===t[o].toString())continue;return!1}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!a(e[r],t[r]))return!1}else if(Array.isArray(e)||Array.isArray(t))return!1;return!0}function s(e){const t={beforeRender:e.beforeRender||(()=>{}),beforeRedraw:e.beforeRedraw||(()=>{}),afterRender:e.afterRender||(()=>{}),beforeDestroy:e.beforeDestroy||(()=>{})};s.tagUse.push(t)}function i(e,t){const r=function(e,r){if("object"!=typeof e)return e;const n={...e};return Object.entries(n).forEach((([e,r])=>{n[e]=r instanceof Function?(...e)=>function(e,r){const n=e(...r);return t.newest?.ownerTag?.tagSupport.render(),n}(r,e):r})),n}((n=e,!0===n?.isTag)?0:e);var n;return r}n.globalSubs=[],n.globalSubCount$=new e,n.globalSubCount$.set(0),s.tagUse=[],s.memory={};class c{templater;props;clonedProps;latestProps;latestClonedProps;memory={context:{},state:{newest:[]},providers:[],renderCount:0};constructor(e,t){this.templater=e,this.props=t,this.latestProps=t;const r=i(t,e);this.latestClonedProps=o(r),this.clonedProps=this.latestClonedProps}oldest;newest;hasPropChanges(e,t,r){const n=this.props;return!(void 0===e&&e===r||a(t,n))}mutatingRender(){const e='Tag function "render()" was called in sync but can only be called async';throw console.error(e,{tagSupport:this}),new Error(e)}render(){return++this.memory.renderCount,this.mutatingRender()}renderExistingTag(e,t){const r=this.memory.renderCount;if(function(e){e.tagSupport.memory.providers.filter((e=>!a(e.instance,e.clone))).forEach((t=>{!function(e,t){p(e,t).forEach((({tag:e,renderCount:t,provider:r})=>{t===e.tagSupport.memory.renderCount&&(r.clone=o(r.instance),e.tagSupport.render())}))}(e.getAppElement(),t),t.clone=o(t.instance)}))}(e),r!==this.memory.renderCount)return!0;const n=e.tagSupport.templater,s=t.tagSupport.props,i=n?.tagSupport.props;return function(e,t,r,n,o){const a=e.hasPropChanges(t,n,r);return e.newest=o.redraw(),!a}(this,s,i,t.tagSupport.clonedProps,this.templater)}}function p(e,t,r=[]){const n=e.tagSupport.memory.providers.find((e=>e.constructMethod===t.constructMethod));return n&&r.push({tag:e,renderCount:e.tagSupport.memory.renderCount,provider:n}),e.children.forEach((e=>p(e,t,r))),r}var l;!function(e){e.tag="tag",e.tagArray="tag-array",e.tagComponent="tag-component",e.value="value"}(l||(l={}));const u="__tagvar",g="--"+u+"--";new RegExp(u,"g"),new RegExp(g,"g"),new class{};const d=[];function f(e,t){const r=s.memory.providerConfig;r.currentTagSuport=e,r.ownerTag=t,e.memory.providers.length&&(r.providers.length=0,r.providers.push(...e.memory.providers))}s.memory.providerConfig={providers:[],currentTagSupport:void 0,ownerTag:void 0},s({beforeRender:(e,t)=>{f(e,t)},beforeRedraw:(e,t)=>{f(e,t.ownerTag)},afterRender:e=>{const t=s.memory.providerConfig;e.memory.providers=[...t.providers],t.providers.length=0}}),s.memory.stateConfig={array:[],rearray:[]},s({beforeRender:e=>m(e),beforeRedraw:e=>m(e),afterRender:(e,t)=>{const r=e.memory.state,n=s.memory.stateConfig;if(n.rearray.length&&n.rearray.length!==n.array.length){const t=`States lengths mismatched ${n.rearray.length} !== ${n.array.length}`;throw console.error(t,{oldStates:n.array,newStates:n.rearray,component:e.templater?.wrapper.original}),new Error(t)}n.rearray=[],r.newest=[...n.array],n.array=[]}});function m(e){const t=e.memory.state,r=s.memory.stateConfig;if(r.rearray.length){const n="last array not cleared";throw console.error(n,{config:r,component:e.templater?.wrapper.original,state:t}),n}r.rearray=[],t?.newest.length&&r.rearray.push(...t.newest)}function y(e){s.memory.initCurrentSupport=e}let w;s({beforeRender:e=>y(e),beforeRedraw:e=>y(e)}),s({beforeRender:e=>w=e,beforeRedraw:e=>w=e,beforeDestroy:(e,t)=>{const r=e.memory.destroyCallback;r&&r()}});function h(e){[...document.querySelectorAll("app")].forEach(e)}async function b(){const e=[...document.querySelectorAll("[tag]")].map((async e=>{const t=e.getAttribute("url"),n=e.getAttribute("name");console.log(`loading tagName ${n}...`);const o=await r(519)(`${t}?${Date.now()}`);try{const e=o[n]();return{newApp:o,newTemplater:e,tagName:n}}catch(e){throw console.error(`Could not load tag by name ${n}`,o),e}}));return await Promise.all(e)}s({beforeRender:e=>{},beforeRedraw:e=>{}}),function e(){const t=new WebSocket("ws://localhost:3000");t.addEventListener("error",(e=>{console.error("WebSocket error:",e)})),t.addEventListener("open",(e=>{console.info("WebSocket connection opened:",e)})),t.addEventListener("message",(async e=>{console.info("Message from server:",e.data,e.data),"Connected to the WebSocket endpoint"!==e.data?h((e=>{!async function(e){const t=v,r=e.setUse;(await b()).forEach((async e=>{const{newTemplater:n}=e,o=n.wrapper.original.tags,a=n.wrapper.original.setUse;r.tagUse=a.tagUse,Object.assign(r.memory,a.memory),a.memory=r.memory;const s=t.reduce(((e,t)=>{const r=o.find((e=>e.toString()===t.toString()));return r||e.push({oldTag:t,newTag:r}),e}),[]);s||console.warn("No old tags changed");const i=t.length===o.length;if(o.forEach((e=>{let r=t.find((t=>e.toString()===t.toString())),n=null;if(!r&&s[0].newTag&&(n=e.tagIndex,i&&t[n].length===e.length&&(r=t[n])),!r){if(s[0].newTag){const r="HMR has two tags";throw console.warn(r,{first:s[0].newTag,second:e,equal:e===s[0].newTag,oldTags:t,newTags:o,tagIndex:n}),new Error(r)}s[0].newTag=e}})),s.length){const e=s[0].oldTag,t=S.tagSupport.templater,r=t.wrapper.original===e,n=t.wrapper.original.toString()===e.toString();if(r||n){const e=s[0].newTag;return S.tagSupport.templater.wrapper.original=e,await S.destroy(),S=await C(S),void(v=o)}const a=await R(S,s[0]);a<=0?console.warn("✋ No components were updated",s[0]):console.debug(`✅ Replaced and update components ${a}`,s[0])}v=o,console.info("✅ ✅ ✅ rebuilt")}))}(e)})):h((e=>{b().then((t=>{t.forEach((({newApp:t,tagName:r})=>{const n=function(e,t,r){const n=d.findIndex((e=>e.element===t));n>=0&&(d[n].tag.destroy(),d.splice(n,1),console.warn("Found and destroyed app element already rendered to element",{element:t}));const o=function(e){const t=e.tagSupport;!function(e,t){s.tagUse.forEach((t=>t.beforeRender(e,void 0)))}(t);const r=e.wrapper();return r.tagSupport=t,r.afterRender(),{tag:r,tagSupport:t}}(e(r)),{tag:a,tagSupport:i}=o;a.appElement=t,function(e,t){let r;e.mutatingRender=()=>{t.beforeRedraw();const n=e.templater,o=r=n.wrapper();return e.latestProps=o.tagSupport.props,e.latestClonedProps=o.tagSupport.clonedProps,o.setSupport(e),t.afterRender(),t.updateByTag(o),e.newest=o,r}}(i,a);const c=document.createElement("template");return c.setAttribute("tag-detail","app-template-placeholder"),t.appendChild(c),a.buildBeforeElement(c),t.setUse=e.original.setUse,d.push({element:t,tag:a}),{tag:a,tags:e.original.tags}}(t[r],e,{test:1});return v=n.tags,S=n.tag,n}))}))}))})),t.addEventListener("close",(t=>{console.info("WebSocket connection closed:",t),e()}))}();let S,v=[];async function C(e){const{retag:t}=function(e,t,r){const n=e?.tagSupport||function(e,t){return new c(e,void 0)}(t);return t.renderWithSupport(n,e,r)}(e,e.tagSupport.templater);return t.insertBefore=e.insertBefore,t.rebuild(),e.ownerTag&&t.ownerTag.children.push(t),t}async function R(e,{oldTag:t,newTag:r},n=0){const o=e.values.map((async(o,a)=>{if(!o||!o.isTemplater)return;const s=o.wrapper.original===t,i=o.wrapper.original.toString()===t.toString();if(s||i){const t=e.tagSupport.memory.context[`__tagVar${a}`];return o.wrapper.original=r,t?.tag?(t.tag.tagSupport.templater.wrapper.original=r,await t.tag.destroy(),T(t.tag.tagSupport.memory.context),t.tag=await C(t.tag),void++n):void console.warn("potential hmr issue here")}}));await Promise.all(o);const a=e.children.map((async e=>{n+=await R(e,{oldTag:t,newTag:r})}));return await Promise.all(a),n}function T(e){Object.values(e).forEach((e=>{e.clone&&delete e.clone,e.tag&&T(e.tag.tagSupport.memory.context)}))}})();