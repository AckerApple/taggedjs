var e={519:e=>{function t(e){return Promise.resolve().then((()=>{return import(e);throw t.code="MODULE_NOT_FOUND",t}))}t.keys=()=>[],t.resolve=t,t.id=519,e.exports=t}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,r),a.exports}r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{class e{isSubject=!0;subscribers=[];value;subscribe(e){this.subscribers.push(e),n.globalSubs.push(e),n.globalSubCount$.set(n.globalSubCount$.value+1);const r=()=>{r.unsubscribe()};return r.unsubscribe=()=>{t(this.subscribers,e),t(n.globalSubs,e),n.globalSubCount$.set(n.globalSubCount$.value-1),r.unsubscribe=()=>{}},r}set(e){this.value=e,this.subscribers.forEach((t=>{t.value=e,t(e)}))}next=this.set}function t(e,t){const r=e.indexOf(t);-1!==r&&e.splice(r,1)}const n=e;function o(e){return a(e,new WeakMap)}function a(e,t){if(null===e||"object"!=typeof e)return e;if(t.has(e))return t.get(e);if(e instanceof Date)return new Date(e);if(e instanceof RegExp)return new RegExp(e);const r=Array.isArray(e)?[]:Object.create(Object.getPrototypeOf(e));if(t.set(e,r),Array.isArray(e))for(let n=0;n<e.length;n++)r[n]=a(e[n],t);else for(const n in e)e.hasOwnProperty(n)&&(r[n]=a(e[n],t));return r}function s(e,t){return i(e,t,new WeakMap)}function i(e,t,r){if(e===t)return!0;if("object"!=typeof e||"object"!=typeof t||null===e||null===t)return!1;const n=Object.keys(e),o=Object.keys(t);if(n.length!==o.length)return!1;if(r.has(e))return!0;r.set(e,0);for(const a of n)if(!o.includes(a)||!i(e[a],t[a],r)){if(e[a]instanceof Function&&t[a]instanceof Function&&e[a].toString()===t[a].toString())continue;return!1}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!i(e[n],t[n],r))return!1}else if(Array.isArray(e)||Array.isArray(t))return!1;return!0}function c(e){return!0===e?.isTag}function l(e){const t={beforeRender:e.beforeRender||(()=>{}),beforeRedraw:e.beforeRedraw||(()=>{}),afterRender:e.afterRender||(()=>{}),beforeDestroy:e.beforeDestroy||(()=>{})};l.tagUse.push(t)}function p(e,t){const r=function(e,r){if("object"!=typeof e)return e;const n={...e};return Object.entries(n).forEach((([e,r])=>{n[e]=r instanceof Function?(...e)=>function(e,r){const n=e(...r);return t.newest?.ownerTag?.tagSupport.render(),n}(r,e):r})),n}(c(e)?0:e);return r}n.globalSubs=[],n.globalSubCount$=new e,n.globalSubCount$.set(0),l.tagUse=[],l.memory={};class u{templater;props;latestProps;clonedProps;latestClonedProps;memory={context:{},state:{newest:[]},providers:[],renderCount:0};constructor(e,t){this.templater=e,this.props=t,this.latestProps=t;const r=p(t,e);this.latestClonedProps=r,c(t)||(this.latestClonedProps=o(r)),this.clonedProps=this.latestClonedProps}oldest;newest;hasPropChanges(e,t,r){return!(void 0===e&&e===r||s(t,e))}mutatingRender(){const e='Tag function "render()" was called in sync but can only be called async';throw console.error(e,{tagSupport:this}),new Error(e)}render(){return++this.memory.renderCount,this.mutatingRender()}renderExistingTag(e,t){const r=this.memory.renderCount;if(function(e){e.tagSupport.memory.providers.filter((e=>!s(e.instance,e.clone))).forEach((t=>{!function(e,t){g(e,t).forEach((({tag:e,renderCount:t,provider:r})=>{t===e.tagSupport.memory.renderCount&&(r.clone=o(r.instance),e.tagSupport.render())}))}(e.getAppElement(),t),t.clone=o(t.instance)}))}(e),r!==this.memory.renderCount)return!0;const n=e.tagSupport.templater,a=t.tagSupport.props,i=n.tagSupport.clonedProps,c=n?.tagSupport.props;return function(e,t,r,n,o){const a=e.hasPropChanges(t,r,n);return e.newest=o.redraw(),!a}(this,a,i,c,this.templater)}}function g(e,t,r=[]){const n=e.tagSupport.memory.providers.find((e=>e.constructMethod===t.constructMethod));return n&&r.push({tag:e,renderCount:e.tagSupport.memory.renderCount,provider:n}),e.children.forEach((e=>g(e,t,r))),r}var d;!function(e){e.tag="tag",e.tagArray="tag-array",e.tagComponent="tag-component",e.value="value"}(d||(d={}));const f="__tagvar",m="--"+f+"--";new RegExp(f,"g"),new RegExp(m,"g"),new class{};const y=[];function w(e,t){const r=l.memory.providerConfig;r.currentTagSuport=e,r.ownerTag=t,e.memory.providers.length&&(r.providers.length=0,r.providers.push(...e.memory.providers))}l.memory.providerConfig={providers:[],currentTagSupport:void 0,ownerTag:void 0},l({beforeRender:(e,t)=>{w(e,t)},beforeRedraw:(e,t)=>{w(e,t.ownerTag)},afterRender:e=>{const t=l.memory.providerConfig;e.memory.providers=[...t.providers],t.providers.length=0}}),l.memory.stateConfig={array:[],rearray:[]},l({beforeRender:e=>h(e),beforeRedraw:e=>h(e),afterRender:(e,t)=>{const r=e.memory.state,n=l.memory.stateConfig;if(n.rearray.length&&n.rearray.length!==n.array.length){const t=`States lengths mismatched ${n.rearray.length} !== ${n.array.length}`;throw console.error(t,{oldStates:n.array,newStates:n.rearray,component:e.templater?.wrapper.original}),new Error(t)}n.rearray=[],r.newest=[...n.array],n.array=[]}});function h(e){const t=e.memory.state,r=l.memory.stateConfig;if(r.rearray.length){const n="last array not cleared";throw console.error(n,{config:r,component:e.templater?.wrapper.original,state:t}),n}r.rearray=[],t?.newest.length&&r.rearray.push(...t.newest)}function b(e){l.memory.initCurrentSupport=e}let S;l({beforeRender:e=>b(e),beforeRedraw:e=>b(e)}),l({beforeRender:e=>S=e,beforeRedraw:e=>S=e,beforeDestroy:(e,t)=>{const r=e.memory.destroyCallback;r&&r()}});function v(e){[...document.querySelectorAll("app")].forEach(e)}async function C(){const e=[...document.querySelectorAll("[tag]")].map((async e=>{const t=e.getAttribute("url"),n=e.getAttribute("name");console.log(`loading tagName ${n}...`);const o=await r(519)(`${t}?${Date.now()}`);try{const e=o[n]();return{newApp:o,newTemplater:e,tagName:n}}catch(e){throw console.error(`Could not load tag by name ${n}`,o),e}}));return await Promise.all(e)}l({beforeRender:e=>{},beforeRedraw:e=>{}}),function e(){const t=new WebSocket("ws://localhost:3000");t.addEventListener("error",(e=>{console.error("WebSocket error:",e)})),t.addEventListener("open",(e=>{console.info("WebSocket connection opened:",e)})),t.addEventListener("message",(async e=>{console.info("Message from server:",e.data,e.data),"Connected to the WebSocket endpoint"!==e.data?v((e=>{!async function(e){const t=T,r=e.setUse;(await C()).forEach((async e=>{const{newTemplater:n}=e,o=n.wrapper.original.tags,a=n.wrapper.original.setUse;r.tagUse=a.tagUse,Object.assign(r.memory,a.memory),a.memory=r.memory;const s=t.reduce(((e,t)=>{const r=o.find((e=>e.toString()===t.toString()));return r||e.push({oldTag:t,newTag:r}),e}),[]);s||console.warn("No old tags changed");const i=t.length===o.length;if(o.forEach((e=>{let r=t.find((t=>e.toString()===t.toString())),n=null;if(!r&&s[0].newTag&&(n=e.tagIndex,i&&t[n].length===e.length&&(r=t[n])),!r){if(s[0].newTag){const r="HMR has two tags";throw console.warn(r,{first:s[0].newTag,second:e,equal:e===s[0].newTag,oldTags:t,newTags:o,tagIndex:n}),new Error(r)}s[0].newTag=e}})),s.length){const e=s[0].oldTag,t=R.tagSupport.templater,r=t.wrapper.original===e,n=t.wrapper.original.toString()===e.toString();if(r||n){const e=s[0].newTag;return R.tagSupport.templater.wrapper.original=e,await R.destroy(),R=await E(R),void(T=o)}const a=await A(R,s[0]);a<=0?console.warn("✋ No components were updated",s[0]):console.debug(`✅ Replaced and update components ${a}`,s[0])}T=o,console.info("✅ ✅ ✅ rebuilt")}))}(e)})):v((e=>{C().then((t=>{t.forEach((({newApp:t,tagName:r})=>{const n=function(e,t,r){const n=y.findIndex((e=>e.element===t));n>=0&&(y[n].tag.destroy(),y.splice(n,1),console.warn("Found and destroyed app element already rendered to element",{element:t}));const o=function(e){const t=e.tagSupport;!function(e,t){l.tagUse.forEach((t=>t.beforeRender(e,void 0)))}(t);const r=e.wrapper();return r.tagSupport=t,r.afterRender(),{tag:r,tagSupport:t}}(e(r)),{tag:a,tagSupport:s}=o;a.appElement=t,function(e,t){let r;e.mutatingRender=()=>{t.beforeRedraw();const n=e.templater,o=r=n.wrapper();return e.latestProps=o.tagSupport.props,e.latestClonedProps=o.tagSupport.clonedProps,o.setSupport(e),t.afterRender(),t.updateByTag(o),e.newest=o,r}}(s,a);const i=document.createElement("template");return i.setAttribute("tag-detail","app-template-placeholder"),t.appendChild(i),a.buildBeforeElement(i),t.setUse=e.original.setUse,y.push({element:t,tag:a}),{tag:a,tags:e.original.tags}}(t[r],e,{test:1});return T=n.tags,R=n.tag,n}))}))}))})),t.addEventListener("close",(t=>{console.info("WebSocket connection closed:",t),e()}))}();let R,T=[];async function E(e){const{retag:t}=function(e,t,r){const n=e?.tagSupport||function(e,t){return new u(e,void 0)}(t);return t.renderWithSupport(n,e,r)}(e,e.tagSupport.templater);return t.insertBefore=e.insertBefore,t.rebuild(),e.ownerTag&&t.ownerTag.children.push(t),t}async function A(e,{oldTag:t,newTag:r},n=0){const o=e.values.map((async(o,a)=>{if(!o||!o.isTemplater)return;const s=o.wrapper.original===t,i=o.wrapper.original.toString()===t.toString();if(s||i){const t=e.tagSupport.memory.context[`__tagVar${a}`];return o.wrapper.original=r,t?.tag?(t.tag.tagSupport.templater.wrapper.original=r,await t.tag.destroy(),P(t.tag.tagSupport.memory.context),t.tag=await E(t.tag),void++n):void console.warn("potential hmr issue here")}}));await Promise.all(o);const a=e.children.map((async e=>{n+=await A(e,{oldTag:t,newTag:r})}));return await Promise.all(a),n}function P(e){Object.values(e).forEach((e=>{e.clone&&delete e.clone,e.tag&&P(e.tag.tagSupport.memory.context)}))}})();