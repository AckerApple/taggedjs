var t={519:t=>{function e(t){return Promise.resolve().then((()=>{return import(t);throw e.code="MODULE_NOT_FOUND",e}))}e.keys=()=>[],e.resolve=e,e.id=519,t.exports=e}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var s=e[r]={exports:{}};return t[r](s,s.exports,n),s.exports}n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{function t(t,e){const n=t.templater,r=e.templater,o=n?.tag||t,s=r.tag,a=o.strings,i=e.strings||s.strings;return a.length===i.length&&(!!a.every(((t,e)=>i[e]===t))&&function(t,e){if(!(t.length===e.length))return!1;return!!e.every(((e,n)=>{const r=t[n];return!(e instanceof Function&&r instanceof Function)||!(e.toString()!==r.toString())}))}(t.values||o.values,e.values||s.values))}function e(t){t.global.oldest.destroy(),r(t),t.global.context={}}function r(t){delete t.global.oldest,delete t.global.newest}function o(t,e){e.parentNode.insertBefore(t,e.nextSibling)}function s(t){return["string","number","boolean"].includes(t)}function a(t,e){r(t),t.destroy({stagger:e.removed++});const n=t.global.insertBefore;n.parentNode.removeChild(n)}function i(t){const e=t.global.insertBefore,n=t.global,r=n.placeholder;r&&(o(e,r),delete n.placeholder)}var l;function c(t){if(null==t)return l.undefined;const e=typeof t;if(t instanceof Function)return l.function;if("object"===e){if(t instanceof Date)return l.date;if(s(e))return e;const n=t.tagJsType;if(n&&[l.tagComponent,l.templater,l.tag].includes(n))return n;if(f(t))return l.tagArray;if(d(t))return l.subject}return l.unknown}function u(t){return[l.tag,l.templater].includes(t?.tagJsType)}function p(t){return t?.tagJsType===l.tagComponent}function g(t){return t?.tagJsType===l.tag}function d(t){return!(!0!==t?.isSubject&&!t?.subscribe)}function f(t){return t instanceof Array&&t.every((t=>[l.tag,l.templater,l.tag,l.tagComponent].includes(t?.tagJsType)))}function h(t,e,n){const r=[...e],o=r.shift(),s=t=>{if(r.length)return h(t,r,n);n(t)};let a=s;const i=o(t,{setHandler:t=>a=t,next:s});a(i)}!function(t){t.unknown="unknown",t.tag="tag",t.templater="templater",t.tagComponent="tag-component",t.tagArray="tag-array",t.subject="subject",t.date="date",t.string="string",t.boolean="boolean",t.function="function",t[void 0]="undefined"}(l||(l={}));class m{value;onSubscription;methods=[];isSubject=!0;subscribers=[];subscribeWith;_value;set;constructor(t,e){this.value=t,this.onSubscription=e,this._value=t,b(this)}subscribe(t){const e=function(t,e,n){const r=m.globalSubCount$;m.globalSubCount$.next(r._value+1);const o=()=>{o.unsubscribe()};return o.callback=e,o.subscriptions=[],o.unsubscribe=()=>{!function(t,e){const n=t.findIndex((t=>t.callback===e));-1!==n&&t.splice(n,1)}(n,e),m.globalSubCount$.next(r._value-1),o.unsubscribe=()=>o;const t=o.subscriptions;for(let e=t.length-1;e>=0;--e)t[e].unsubscribe();return o},o.add=t=>(o.subscriptions.push(t),o),o.next=t=>{e(t,o)},o}(0,t,this.subscribers),n=this.subscribeWith;if(n){if(this.methods.length){const n=t;t=t=>{h(t,this.methods,(t=>n(t,e)))}}return n(t)}this.subscribers.push(e);const r=m.globalSubCount$.value;return m.globalSubCount$.next(r+1),this.onSubscription&&this.onSubscription(e),e}next(t){this._value=t,this.emit()}emit(){const t=this._value,e=[...this.subscribers],n=e.length;for(let r=0;r<n;++r){const n=e[r];n.callback(t,n)}}toPromise(){return new Promise((t=>{this.subscribe(((e,n)=>{n.unsubscribe(),t(e)}))}))}toCallback(t){return this.subscribe(((e,n)=>{n.unsubscribe(),t(e)})),this}pipe(...t){const e=new m(this._value);return e.setMethods(t),e.subscribeWith=t=>this.subscribe(t),e.next=t=>this.next(t),e}setMethods(t){this.methods=t}static all(t){return function(t){const e=new m;return e.subscribeWith=e=>{const n=[],r=[],o=(o,s)=>{if(n[s]=!0,r[s]=o,n.length===t.length){for(let t=n.length-1;t>=0;--t)if(!n[t])return;e(r,a)}},s=[...t],a=s.shift().subscribe((t=>o(t,0))),i=s.map(((t,e)=>t.subscribe((t=>o(t,e+1)))));return a.subscriptions=i,a},e}(t.map((t=>d(t)?t:new m(t,(e=>(e.next(t),e))))))}static globalSubCount$=new m(0)}function b(t){Object.defineProperty(t,"value",{set(e){t._value=e,t.emit()},get:()=>t._value}),Object.defineProperty(t,"set",{set:e=>t.next(e),get:()=>e=>t.next(e)})}class y extends m{value;constructor(t){super(t),this.value=t,b(this)}subscribe(t){const e=super.subscribe(t);return t(this._value,e),e}}function w(){return v.memory.stateConfig.tagSupport}function v(t){const e={beforeRender:t.beforeRender||(()=>{}),beforeRedraw:t.beforeRedraw||(()=>{}),afterRender:t.afterRender||(()=>{}),beforeDestroy:t.beforeDestroy||(()=>{})};v.tagUse.push(e)}v.tagUse=[],v.memory={};class S extends Error{details;constructor(t,e,n={}){super(t),this.name=S.name,this.details={...n,errorCode:e}}}class C extends S{constructor(t,e){super(t,"array-no-key-error",e),this.name=C.name}}class T extends S{constructor(t,e){super(t,"state-mismatch-error",e),this.name=T.name}}class x extends S{constructor(t,e){super(t,"sync-callback-error",e),this.name=x.name}}v.memory.stateConfig={array:[]};const A=t=>function(t){const e=t.memory.state,n=v.memory.stateConfig;n.rearray=[];const r=e?.length;if(r){for(let t=0;t<r;++t)R(e[t]);n.rearray.push(...e)}n.tagSupport=t}(t);function R(t){const e=t.callback;if(!e)return t.defaultValue;const[n,r]=function(t){const e=t(j),[n]=e,[r]=t(n);return[n,r]}(e);if(r!==j){const o='State property not used correctly. Second item in array is not setting value as expected.\n\nFor "let" state use `let name = state(default)(x => [name, name = x])`\n\nFor "const" state use `const name = state(default)()`\n\nProblem state:\n'+(e?e.toString():JSON.stringify(t))+"\n";throw console.error(o,{state:t,callback:e,value:n,checkValue:r}),new Error(o)}return n}v({beforeRender:A,beforeRedraw:A,afterRender:t=>{const e=t.memory,n=v.memory.stateConfig,r=n.rearray;if(r.length&&r.length!==n.array.length){const e=`States lengths have changed ${r.length} !== ${n.array.length}. State tracking requires the same amount of function calls every render. Typically this errors is thrown when a state like function call occurs only for certain conditions or when a function is intended to be wrapped with a tag() call`,o=t.templater?.wrapper,s={oldStates:n.array,newStates:n.rearray,tagFunction:o.parentWrap.original},a=new T(e,s);throw console.warn(e,s),a}delete n.rearray,delete n.tagSupport,e.state.length=0,e.state.push(...n.array);const o=e.state;for(let t=o.length-1;t>=0;--t){const e=o[t];e.lastValue=R(e)}n.array=[]}});class j{}function E(t,e){for(let n=t.length-1;n>=0;--n){const r=t[n].get(),o=e[n].callback;o&&o(r),e[n].lastValue=r}}function k(t){const e=v.memory.stateConfig;let n;const r=e.rearray[e.array.length];if(r){let t=R(r);n=e=>[t,t=e];const o={get:()=>R(o),callback:n,lastValue:t,defaultValue:r.defaultValue};return e.array.push(o),t}let o=(t instanceof Function?t:()=>t)();if(o instanceof Function){const t=e.array,n=e.tagSupport,r=o;o=(...e)=>{const o=n.global.newest.memory.state;E(o,t);const s=r(...e);return E(t,o),s},o.original=r}n=t=>[o,o=t];const s={get:()=>R(s),callback:n,lastValue:o,defaultValue:o};return e.array.push(s),o}const B=t=>t,P=(t,e,{init:n,before:r=(()=>!0),final:o=B}={})=>{let s=k({pastResult:void 0,values:void 0});const a=s.values;if(void 0===a){if(!r(t))return s.values=t,s.pastResult;const i=(n||e)(t,a);return s.pastResult=o(i),s.values=t,s.pastResult}if(t.every(((t,e)=>t===a[e])))return s.pastResult;if(!r(t))return s.values=t,s.pastResult;const i=e(t,a);return s.pastResult=o(i),a.length=0,a.push(...t),s.pastResult};function F(t,e){return Object.defineProperty(e,"noInit",{get(){const e=t();return e.setup.init=()=>{},e}}),Object.defineProperty(e,"asSubject",{get(){const e=t(),n=(t,n)=>{const r=k((()=>w().memory.state)),o=k((()=>new y(void 0)));return P(t,((t,e)=>{const s=n(t,e);r.length&&E(v.memory.stateConfig.array,r),o.next(s)}),e.setup),o};return n.setup=e.setup,F((()=>n),n),n}}),Object.defineProperty(e,"truthy",{get(){const e=t();return e.setup.before=t=>t.every((t=>t)),e}}),e}function N(t,e){const n=k((()=>v.memory.stateConfig.array)),r=w();return k((()=>new m(t,e).pipe((t=>(E(r.memory.state,n),t)))))}function W(t){return V(t,new WeakMap)}function V(t,e){if(null===t||"object"!=typeof t)return t;if(e.has(t))return e.get(t);if(t instanceof Date)return new Date(t);if(t instanceof RegExp)return new RegExp(t);const n=Array.isArray(t)?[]:Object.create(Object.getPrototypeOf(t));if(e.set(t,n),Array.isArray(t))for(let r=0;r<t.length;r++)n[r]=V(t[r],e);else for(const r in t)t.hasOwnProperty(r)&&(n[r]=V(t[r],e));return n}function O(t,e){return _(t,e,new WeakMap)}function _(t,e,n){return!!(t===e||(r=t,o=e,r instanceof Function&&o instanceof Function&&r.toString()===o.toString()))||!!n.has(t)||"object"==typeof t&&"object"==typeof e&&(t instanceof Date&&e instanceof Date?t.getTime()===e.getTime():(n.set(t,0),Array.isArray(t)&&Array.isArray(e)?function(t,e,n){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!_(t[r],e[r],n))return!1;return!0}(t,e,n):!Array.isArray(t)&&!Array.isArray(e)&&function(t,e,n){const r=Object.keys(t),o=Object.keys(e);if(0===r.length&&0===o.length)return!0;if(r.length!==o.length)return!1;for(const s of r)if(!o.includes(s)||!_(t[s],e[s],n))return!1;return!0}(t,e,n)));var r,o}function M(t,e){const n=v.memory.providerConfig;n.ownerSupport=e,t.global.providers.length&&(n.providers.length=0,n.providers.push(...t.global.providers))}function $(t,e){const n=D(t,e);for(let t=n.length-1;t>=0;--t){const{tagSupport:e,renderCount:r,provider:o}=n[t];e.global.deleted||r===e.global.renderCount&&(o.clone=W(o.instance),J(e,!1))}}function D(t,e,n=[]){const r=t.global,o=r.providers.find((t=>t.constructMethod.compareTo===e.constructMethod.compareTo));o&&n.push({tagSupport:t,renderCount:r.renderCount,provider:o});const s=t.childTags;for(let t=s.length-1;t>=0;--t)D(s[t],e,n);return n}function U(t,e){const n=v.tagUse,r=n.length;for(let o=0;o<r;++o)n[o].beforeDestroy(t,e)}function L(t,e,n,r){const o=t.global.renderCount;!function(t,e,n){const r=n?.ownerTagSupport,o=r||e;if(n){const e=n.memory.state;t.memory.state=[...e],t.global=n.global,function(t,e){const n=v.tagUse,r=n.length;for(let o=0;o<r;++o)n[o].beforeRedraw(t,e)}(t,n)}else!function(t,e){const n=v.tagUse,r=n.length;for(let o=0;o<r;++o)n[o].beforeRender(t,e)}(t,o),v.memory.providerConfig.ownerSupport=o}(t,r,e);let s=(0,t.templater.wrapper)(t,n);return function(t,e){const n=v.tagUse,r=n.length;for(let o=0;o<r;++o)n[o].afterRender(t,e);v.memory.tagClosed$.next(e)}(t,r),s.global.renderCount>o+1?t.global.newest:(t.global.newest=s,s)}function I(n,r,o,s){const a=L(n,r,o,s);!r||t(r,a)||function(t,n,r){const o=t.global,s=o.insertBefore;e(t),n.global={...o};const a=n.global;a.insertBefore=s,a.deleted=!1,delete a.oldest,delete a.newest,delete r.tagSupport}(r,a,o);const i=r?.ownerTagSupport;return a.ownerTagSupport=s||i,a}function J(e,n){const r=e.global,o=e.templater;if(!o.wrapper){const t=e.ownerTagSupport;return++r.renderCount,J(t,!0)}const s=e.subject;let a,i=!1;if(n&&e&&(a=e.ownerTagSupport,a)){const t=o.props,n=e.propsConfig.latestCloned;i=!t.every(((t,e)=>O(t,n[e])))}const l=function(e,n,r,o){const s=o.tagSupport,a=s.global;n.global=a;const i=a.renderCount;!function(t){const e=t.global.providers.filter((t=>!O(t.instance,t.clone)));for(let n=e.length-1;n>=0;--n){const r=e[n];$(t.getAppTagSupport(),r),r.clone=W(r.instance)}}(e);const l=a.newest;if(i!==a.renderCount)return e.updateBy(l),l;const c=I(n,l||s||a.oldest,o,r),u=a.oldest||e;return c.global.oldest=u,t(l,c)&&(o.tagSupport=c,u.updateBy(c)),c}(e.global.oldest,e,a,s);return a&&i?(J(a,!0),l):l}F((()=>function(t){const e=(e,n)=>P(e,n,t);return e.setup=t,F((()=>e),e),e}({})),((t,e)=>P(t,e))),N._value=t=>{const e=k((()=>v.memory.stateConfig.array)),n=w();return k((()=>new y(t).pipe((t=>(E(n.memory.state,e),t)))))},N.all=function(t){const e=k((()=>v.memory.stateConfig.array)),n=w();return m.all(t).pipe((t=>(E(n.memory.state,e),t)))},v.memory.providerConfig={providers:[],ownerSupport:void 0},v({beforeRender:(t,e)=>{M(t,e)},beforeRedraw:(t,e)=>{M(t,e.ownerTagSupport)},afterRender:t=>{const e=v.memory.providerConfig;t.global.providers=[...e.providers],e.providers.length=0}}),v.memory.tagClosed$=new m(void 0,(t=>{w()||t.next()}));let K=t=>(t,e,n,r,o,s)=>{throw new x("Callback function was called immediately in sync and must instead be call async")};const q=K;function H(t){const e=v.memory.stateConfig.array;K=n=>(...r)=>t.global.callbackMaker?function(t,e,n,...r){const o=t.memory.state;E(o,n);const s=e(...r);return E(n,o),J(t,!1),s instanceof Promise&&s.finally((()=>{E(n,o),J(t,!1)})),s}(t,n,e,...r):n(...r)}function G(t){v.memory.currentSupport=t}function X(t){v.memory.destroyCurrentSupport=t}function z(t){v.memory.childrenCurrentSupport=t}v({beforeRender:t=>H(t),beforeRedraw:t=>H(t),afterRender:t=>{t.global.callbackMaker=!0,K=q}}),v({beforeRender:t=>G(t),beforeRedraw:t=>G(t)}),v({beforeRender:t=>X(t),beforeRedraw:t=>X(t),beforeDestroy:t=>{const e=t.global.destroyCallback;e&&e()}}),v({beforeRender:t=>z(t),beforeRedraw:t=>z(t)});const Q="__tagvar",Y="--"+Q+"--",Z=new RegExp(Y,"g");class tt{strings;values;tagJsType=l.tag;memory={};templater;constructor(t,e){this.strings=t,this.values=e}key(t){return this.memory.arrayValue=t,this}children;html(t,...e){return this.children={strings:t,values:e},this}}class et{props;tagJsType="templater";tagged;wrapper;madeChildIntoSubject;tag;children=new y([]);constructor(t){this.props=t}html(t,...e){const n=function(t,e){if(d(t))return t;if(f(t))return e.madeChildIntoSubject=!0,new y(t);const n=t;return n?(e.madeChildIntoSubject=!0,n.memory.arrayValue=0,new y([n])):(e.madeChildIntoSubject=!0,new y([]))}(new tt(t,e),this);return this.children=n,this}}const nt=[];function rt(t,e,n,r){const o=e.global,s=o.renderCount,a=t.bind(n)(...r);if(s!==o.renderCount||o.deleted)return a instanceof Promise?a.then((()=>"promise-no-data-ever")):"no-data-ever";const i=J(o.newest,!0);return o.newest=i,a instanceof Promise?a.then((()=>{if(o.deleted)return"promise-no-data-ever";const t=J(o.newest,!0);return o.newest=t,"promise-no-data-ever"})):"no-data-ever"}function ot(t){return t.map((t=>{const e=t;switch(c(t)){case l.tagComponent:return W(t.props);case l.tag:case l.templater:return ot(e.values);case l.tagArray:return ot(e)}return W(t)}))}function st(t,e=[]){for(let n=t.length-1;n>=0;--n){const r=t[n];e.push(r),t.splice(n,1),st(r.childTags,e)}return e}function at(t,e){const n=t;let r=n.templater;r||(r=new et([]),r.tag=n,n.templater=r);const o=new y(r);return o.tagSupport=new qt(r,e,o),o}function it(t){const e=document.createTextNode(""),n=t.parentNode;return n.insertBefore(e,t),n.removeChild(t),e}function lt(t,e,n){const r=t.split(".");if("style"===r[0]&&(n.style[r[1]]=e),"class"===r[0])if(r.shift(),e)for(let t=0;t<r.length;++t)n.classList.add(r[t]);else for(let t=0;t<r.length;++t)n.classList.remove(r[t])}const ct=/^\s*{__tagvar/,ut=/}\s*$/;function pt(t){return t&&t.search(ct)>=0&&t.search(ut)>=0}function gt(t,e,n,r,o,s){if(pt(e))return function(t,e,n,r,o,s){return ft(t,dt(r,e),n,o,s)}(t,e,n,r,o,s);if(pt(t)){let e;const a=dt(r,t).subscribe((t=>{!function(t,e,n,r,o){if(e&&e!=t)if("string"==typeof e)n.removeAttribute(e);else if(e instanceof Object)for(const t in e)n.removeAttribute(t);if("string"!=typeof t){if(t instanceof Object)for(const e in t)ft(e,t[e],n,r,o)}else{if(!t.length)return;ft(t,"",n,r,o)}}(t,e,n,o,s),e=t}));return o.global.subscriptions.push(a),void n.removeAttribute(t)}return ht(t)?lt(t,e,n):void 0}function dt(t,e){return t[e.replace("{","").split("").reverse().join("").replace("}","").split("").reverse().join("")]}function ft(t,e,n,r,o){const s=ht(t);if(e instanceof Function){const r=function(...t){return e(n,t)};n[t].action=r}if(d(e)){n.removeAttribute(t);const a=e=>{if(e instanceof Function){const t=r.templater.wrapper,n=t?.parentWrap,o=n?.oneRender;o||(e=function(t,e){if(t.isChildOverride)return t;const n=(n,r)=>rt(t,e,n,r);return n.tagFunction=t,n}(e,r))}return function(t,e,n,r,o){if(t instanceof Function){const r=function(...n){return t(e,n)};return r.tagFunction=t,void(e[n]=r)}if(r)return void lt(n,t,e);if(t)return void o(e,n,t);[void 0,!1,null].includes(t)?e.removeAttribute(n):o(e,n,t)}(e,n,t,s,o)},i=e.subscribe(a);r.global.subscriptions.push(i)}else o(n,t,e)}function ht(t){return t.search(/^(class|style)(\.)/)>=0}function mt(t,e,n){t.setAttribute(e,n)}function bt(t,e,n){t[e]=n}function yt(t,e,n){const r=t.getAttributeNames();let o=mt;for(let s=0;s<r.length;++s){const a=r[s];"INPUT"===t.nodeName&&"value"===a&&(o=bt),gt(a,t.getAttribute(a),t,e,n,o),o=mt}}const wt=/(?:<[^>]*?(?:(?:\s+\w+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^>\s]+)))*\s*)\/?>)|({__tagvar[^}]+})/g;function vt(t,e,n,r,o){if(!0!==t.tagged){const e=t.wrapper.parentWrap.original;let n=e.name||e.constructor?.name;"Function"===n&&(n=void 0);const r=n||e.toString().substring(0,120);throw new Error(`Not a tag component. Wrap your function with tag(). Example tag(props => html\`\`) on component:\n\n${r}\n\n`)}const s=new qt(t,r,e);let a=e.tagSupport;return(s.global=a?.global||s.global).insertBefore=n,v.memory.providerConfig.ownerSupport=r,a||(a=function(t,e,n){const r=n.clones.map((t=>t));if((e=I(e,t.tagSupport,t,n)).global.newest=e,n.clones.length>r.length){const t=n.clones.filter((t=>!r.find((e=>e===t))));e.clones.push(...t)}return n.childTags.push(e),e}(e,a||s,r)),function(t,e,n,{counts:r}){const o=e,s=o.tagSupport,a=s?.global.oldest||void 0;if(a&&a)return function(t,e,n){if(e instanceof Function){const t=e(n);return n.updateBy(t),void(e.tagSupport=t)}return n.updateBy(t),void(e.tagSupport=t)}(t,o,a);t.buildBeforeElement(n,{counts:r})}(a,e,n,o),a}function St(t,e,n,r){let o=r.tagSupport;o||(o=xt(t,n,r)),r.tagSupport=o,o.ownerTagSupport=n,o.buildBeforeElement(e,{counts:{added:0,removed:0}})}function Ct(t){const e=Tt();return e.tag=t,t.templater=e,e}function Tt(){const t={children:new y([]),props:[],isTag:!0,tagJsType:"templater",tagged:!1,madeChildIntoSubject:!1,html:()=>t};return t}function xt(t,e,n){const r=new qt(t,e,n);return At(r,e,n),e.childTags.push(r),r}function At(t,e,n){t.global.oldest=t,t.global.newest=t,t.ownerTagSupport=e,n.tagSupport=t}function Rt(t,e,n,r,o){const s=r.clones;let i=t.lastArray=t.lastArray||[];t.placeholder||function(t,e){if("TEMPLATE"!==t.nodeName)return void(e.placeholder=t);const n=e.placeholder=document.createTextNode(""),r=t.parentNode;r.insertBefore(n,t),r.removeChild(t)}(n,t);const l=t.placeholder;let c=0;i=t.lastArray=t.lastArray.filter(((t,n)=>{const r=e.length-1<n-c,s=e[n-c],l=t.tagSupport.templater.tag,u=s?.memory.arrayValue,p=l.memory.arrayValue,g=r||!((d=u)===(f=p)||d instanceof Array&&f instanceof Array&&d.length==f.length&&d.every(((t,e)=>t==f[e])));var d,f;if(g){const t=i[n];return a(t.tagSupport,o.counts),t.deleted=!0,++c,++o.counts.removed,!1}return!0}));const u=e.length;for(let t=0;t<u;++t){const n=e[t],s=i[t],a=s?.tagSupport,c=n;g(c)&&!c.templater&&Ct(c);const u=new qt(c.templater,r,new y(void 0));if(a){At(u,r,a.subject);const t=a.global;u.global=t,t.newest=u}if(!("arrayValue"in c.memory)){const t={template:u.getTemplate().string,array:e},n="Use html`...`.key(item) instead of html`...` to template an Array";throw console.error(n,t),new C(n,t)}i.length>t?s.tagSupport.global.oldest.updateBy(u):(jt(l,u,t,o,i),r.childTags.push(u))}return s}function jt(t,e,n,r,o){const s={tagSupport:e,index:n};o.push(s);const a={added:r.counts.added+n,removed:r.counts.removed},i=document.createDocumentFragment(),l=document.createElement("template");i.appendChild(l),e.buildBeforeElement(l,{counts:a}),t.parentNode.insertBefore(i,t)}function Et(t,e){const n=e.parentNode,r=document.createTextNode(t);return n.insertBefore(r,e),n.removeChild(e),r}function kt(t){return[void 0,!1,null].includes(t)?"":t}function Bt(t,e,n){e.insertBefore=n;const r=e.clone||n;if(e.lastValue===t&&"lastValue"in e)return;e.lastValue=t;const o=kt(t),s=e.clone;if(s)return void(s.textContent=o);const a=Et(o,r);e.clone=a}const Pt=new RegExp('\\s*<template interpolate end id="__tagvar(\\d{1,4})"([^>]*)></template>(\\s*)');function Ft(t,e,n){if(!(t instanceof Function))return!!O(t,e)&&4;if(!(e instanceof Function))return!1;const r=e?.original;return r&&(e=r),t.original&&(t=t.original),t.toString()===e.toString()?(n(),3):(n(),5)}function Nt(t,e,n){const r=w(),o=t(...e),s=()=>{const t=n.global.newest;if(r){const e=t.memory.state.every((t=>{const e=t.lastValue,n=t.get();return O(W(e),n)}));if(e)return o}const e=J(t,!0);return t.global.newest=e,o};return r?(v.memory.tagClosed$.toCallback(s),o):s()}function Wt(n,r,o,s){let a=o.tagSupport?.global.newest,i=a.global.oldest;const l=a.templater.wrapper,c=r.templater.wrapper;let u=!1;l&&c&&(u=l.parentWrap.original===c.parentWrap.original);const p=r.templater;if(!u)return e(a.global.oldest),vt(p,o,s,n,{counts:{added:0,removed:0}});if(!function(t,e,n){const r=function(t,e){let n=t,r=e;if("object"==typeof t){if(!e)return 3;if(n=[...t],r=[...e||[]],!n.every(((t,e)=>{let o=r[e];if(t&&"object"==typeof t){const e={...t},n={...o||{}},r=Object.entries(e).every((([t,r])=>Ft(r,n[t],(()=>{delete e[t],delete n[t]}))));return r}return Ft(t,o,(()=>{n.splice(e,1),r.splice(e,1)}))})))return 6}return!1}(n.props,t.propsConfig.latestCloned);if(r)return r;return function(t,e){const n=t.propsConfig.lastClonedKidValues,r=e.propsConfig.lastClonedKidValues;return!n.every(((t,e)=>{const n=r[e];return t.every(((t,e)=>t===n[e]))}))&&9}(t,e)}(a,r,p))return function(t,e,n){const r=(t=t.global.newest||t).propsConfig.latestCloned,o=e.global.newest;for(let t=n.length-1;t>=0;--t){const e=n[t];if("object"!=typeof e)return;const s=r[t];if("object"!=typeof s)return;for(const t in e){if(!(e[t]instanceof Function))continue;const n=e[t];n instanceof Function&&n.toCall||(s[t].toCall=(...t)=>Nt(n,t,o))}}}(a,n,p.props),a;const g=a.global.newest,d=J(r,!1);a=o.tagSupport;const f=d.global.oldest;return f?(f&&p.children._value.length&&f.templater.children.next(p.children._value),u&&t(g,d)?(o.tagSupport=d,i.updateBy(d),d):(u&&a&&(e(a),d.global.context={}),i=void 0,i||(a=d,Vt(d,a.global.insertBefore,a,o)),a.global.newest=d,d)):Vt(d,s,a,o)}function Vt(t,e,n,r){return t.buildBeforeElement(e,{counts:{added:0,removed:0}}),t.global.oldest=t,t.global.newest=t,n.global.oldest=t,n.global.newest=t,r.tagSupport=t,t}function Ot(t,e,n,r,o){const s=[];if(!t.hasAttribute("end"))return{clones:s};const a=t.getAttribute("id");if(a?.substring(0,Q.length)!==Q)return{clones:s};const i=e[a];return p(i._value)||f(i.value)?{clones:s,tagComponent:{variableName:a,ownerSupport:n,subject:i,insertBefore:t}}:(_t(t,i,n,r),{clones:s})}function _t(n,r,p,d){let f=!1;const h=h=>{f?function(n,r,p,d){const f=n,h=c(r);if(function(n,r,c,p){const g=n,d="lastValue"in g,f=g.lastValue;if(d&&f!==r){const t=typeof r;return(!s(t)||typeof f!==t)&&!(r instanceof Function&&f instanceof Function)&&(function(t,e){const n=e.clone,r=n.parentNode;r.insertBefore(t,n),r.removeChild(n),delete e.clone,delete e.lastValue}(c,g),"changed-simple-value")}const h=n,m=h.lastArray;if(m&&p!==l.tagArray){const t=h.placeholder;delete h.lastArray,delete h.placeholder,o(c,t);for(let t=m.length-1;t>=0;--t){const{tagSupport:e}=m[t];a(e,{added:0,removed:0})}return"array"}const b=n.tagSupport;if(b){const o=u(r);u(n._value)&&o?!t(r,b)&&(i(b),e(b)):p!==l.tagComponent&&(!r||!r.oneRender)&&(i(b),e(b))}}(n,r,d,h),h===l.tagComponent)return function(t,e,n,r){if(!e.tagSupport)return vt(t,e,n,r,{counts:{added:0,removed:0}}),e;const o=new qt(t,r,e),s=e.tagSupport,a=s.global.newest;if(!a)return i(s),vt(t,e,n,r,{counts:{added:0,removed:0}}),e;{const t=a.memory.state;o.memory.state.length=0,o.memory.state.push(...t)}return o.global=s.global,e.tagSupport=o,Wt(r,o,e,n),e}(r,f,d,p);if(f.tagSupport)return h===l.function||function(e,n,r){const o=e.tagSupport;let s=n;const a=g(n);if(a){const t=n;s=t.templater,s||(s=new et([]),s.tag=t,t.templater=s)}const i=new qt(s,r,e);a&&(i.global=o.global);const c=n&&t(o,i);if(function(t){return t?.tagJsType===l.templater}(n)&&At(i,r,e),!c)return c?St(s,o.global.insertBefore,r,e):void Bt(n,e,e.insertBefore);o.updateBy(i)}(n,r,p),f;switch(h){case l.tagArray:return Rt(n,r,d,p,{counts:{added:0,removed:0}}),n;case l.templater:return St(r,d,p,f),f;case l.tag:const t=r;let e=t.templater;return e||(e=Tt(),t.templater=e,e.tag=t),St(e,d,p,f),f;case l.subject:return r;case l.function:return n.clone||(n.clone=it(d)),n}Bt(r,n,d)}(r,h,p,n):(function(t,e,n,r,o){switch(c(t)){case l.templater:return void St(t,n,r,e);case l.tag:const s=t;let a=s.templater;return a||(a=Ct(s)),void St(a,n,r,e);case l.tagArray:return Rt(e,t,n,r,o);case l.tagComponent:return void vt(t,e,n,r,o);case l.function:const i=t;if(i.oneRender){const t=function(t,e,n){const r=new et([]);r.tagJsType="oneRender";const o=xt(r,n,e),s=()=>(r.tag=t(),o);return r.wrapper=s,s.parentWrap=s,s.oneRender=!0,s.parentWrap.original=t,o}(i,e,r);return L(t,t,e,r),void St(t.templater,n,r,e)}}!function(t,e,n){e.lastValue=t;const r=Et(kt(t),n);e.clone=r}(t,e,n)}(h,r,n,p,{counts:{...d}}),f=!0)};let m=h;const b=r.subscribe((t=>m(t)));if(n.parentNode){const t=r.clone=it(n);m=e=>{const o=t.parentNode;o.insertBefore(n,t),o.removeChild(t),delete r.clone,m=h,h(e)}}p.global.subscriptions.push(b)}function Mt(t,e,n,r){if(!t.getAttribute)return;"TEXTAREA"===t.nodeName&&function(t,e,n){const r=t.value;if(r.search(Pt)>=0){const o=r.match(/__tagvar(\d{1,4})/),s="{"+(o?o[0]:"")+"}";t.value="",t.setAttribute("text-var-value",s);const a=(e,n,r)=>t.value=r;gt("text-var-value",s,t,e,n,a)}}(t,n,r);let o=e.counts.added;if(o=function(t,e){const n=t.oninit;if(!n)return e.added;const r=n.tagFunction;if(!r)return e.added;const o=r.tagFunction;return o?(o({target:t,stagger:e.added}),++e.added):e.added}(t,e.counts)-o,t.children){const o=t.children;for(let t=o.length-1;t>=0;--t)return Mt(o[t],{...e,counts:e.counts},n,r)}}function $t(t,e,n,r){const o=n.counts,s=[],a=[];for(let i=r.length-1;i>=0;--i){const l=r[i],{clones:c,tagComponent:u}=Ot(l,t,e,o);if(s.push(...c),u)a.push(u);else if(l.children)for(let r=l.children.length-1;r>=0;--r){const i=l.children[r];if(Dt(i)){const{tagComponent:n}=Ot(i,t,e,o);n&&a.push(n)}const{clones:c,tagComponents:u}=$t(t,e,n,i.children);s.push(...c),a.push(...u)}}return{clones:s,tagComponents:a}}function Dt(t){return"TEMPLATE"===t.tagName&&void 0!==t.getAttribute("interpolate")&&void 0!==t.getAttribute("end")}function Ut(t,e,n,r,o){const s=[],a=[],i=n.interpolation,l=t.children[0],c=l.content.children;if(i.keys.length){const{clones:t,tagComponents:n}=$t(e,r,o,c);s.push(...t),a.push(...n)}return yt(l,e,r),Lt(c,e,r),{clones:s,tagComponents:a}}function Lt(t,e,n){for(let r=t.length-1;r>=0;--r){const o=t[r];yt(o,e,n),o.children&&Lt(o.children,e,n)}}function It(t,e,n,r,o){const s=function(t,e){const n=[];let r=t.children[0].content.firstChild;const o=document.createDocumentFragment();for(;r;){const t=r.nextSibling;n.push(r),o.appendChild(r),r=t}return e.parentNode&&e.parentNode.insertBefore(o,e),n}(t,e);if(!s.length)return s;for(let t=s.length-1;t>=0;--t){const e=s[t];Mt(e,o,r,n),n.clones.push(e)}return s}const Jt=new RegExp(Q,"g");class Kt{templater;subject;isApp=!0;appElement;strings;values;propsConfig;memory={state:[]};clones=[];global={context:{},providers:[],renderCount:0,deleted:!1,subscriptions:[]};hasLiveElements=!1;childTags=[];constructor(t,e){this.templater=t,this.subject=e;const n=t.children.value,r=t.props,o=r.map((t=>W(t)));this.propsConfig={latest:r,latestCloned:o,lastClonedKidValues:n.map((t=>ot(t.values)))}}buildBeforeElement(t,e={counts:{added:0,removed:0}}){const n=this.subject,r=this.global;r.insertBefore=t,r.placeholder||function(t){const e=t.insertBefore;t.placeholder=it(e)}(r);const o=r.placeholder;r.oldest=this,r.newest=this,n.tagSupport=this,this.hasLiveElements=!0;const s=this.update(),a=this.getTemplate(),i=document.createDocumentFragment(),l=document.createElement("template");l.innerHTML=a.string,i.appendChild(l);const{tagComponents:c}=Ut(i,s,a,this,{counts:e.counts});It(i,o,this,s,e);const u=c.length;for(let t=0;t<u;++t){const n=c[t];_t(n.insertBefore,n.subject,n.ownerSupport,e.counts),It(i,n.insertBefore,n.ownerSupport,s,e)}}getTemplate(){const t=this.templater.tag,e=this.strings||t.strings,n=this.values||t.values,r=function(t){const e=function(t){const e=[];return{string:t.replace(wt,((t,n)=>{if(t.startsWith("<"))return t;const r=n.substring(1,n.length-1);return e.push(r),`<template interpolate end id="${r}"></template>`})),keys:e}}(t);return e.string=e.string.replace(Z,Q),e}(e.map(((t,e)=>(t.replace(Jt,Y)+(n.length>e?`{${Q}${e}}`:"")).replace(/>\s*/g,">").replace(/\s*</g,"<"))).join(""));return{interpolation:r,string:r.string,strings:e,values:n,context:this.global.context||{}}}update(){return this.updateContext(this.global.context)}updateContext(t){const e=this.templater.tag,n=this.strings||e.strings,r=this.values||e.values;return n.map(((e,n)=>{if(!(r.length>n))return;const o=Q+n,s=r[n];if(o in t)return function(t,e,n){const r=t[e],o=r.tagSupport;if(o&&n&&p(n)){let t=new qt(n,o.ownerTagSupport,r);p(o)&&(console.warn("👉 deprecated code is being used #shareTemplaterGlobal 👈"),function(t,e){const n=t.templater.wrapper.parentWrap.original,r=e.templater.wrapper,o=r?.parentWrap.original;if(n===o){e.global=t.global;const n=t.global.newest;if(n){const t=n.memory.state;e.memory.state.length=0,e.memory.state.push(...t)}}}(o,t))}d(n)||r.next(n)}(t,o,s);t[o]=function(t,e){switch(c(t)){case l.tagComponent:return new y(t);case l.templater:return at(t.tag,e);case l.tag:return at(t,e);case l.subject:return t}return new y(t)}(s,this)})),t}updateBy(t){const e=t.templater.tag;this.updateConfig(e.strings,e.values)}updateConfig(t,e){this.strings=t,this.updateValues(e)}updateValues(t){return this.values=t,this.updateContext(this.global.context)}}class qt extends Kt{templater;ownerTagSupport;subject;version;isApp=!1;constructor(t,e,n,r=0){super(t,n),this.templater=t,this.ownerTagSupport=e,this.subject=n,this.version=r}destroy(t={stagger:0,byParent:!1}){const e=!t.byParent,n=this.global,r=this.subject,o=t.byParent?[]:st(this.childTags);e&&p(this.templater)&&U(this,this),this.destroySubscriptions();for(let t=o.length-1;t>=0;--t){const e=o[t],n=e.global;delete n.newest,n.deleted=!0,p(e.templater)&&U(e,e)}let s;if("TEMPLATE"===n.insertBefore.nodeName&&n.placeholder&&!("arrayValue"in this.memory)&&(t.byParent||i(this)),this.ownerTagSupport&&(this.ownerTagSupport.childTags=this.ownerTagSupport.childTags.filter((t=>t!==this))),e){const{stagger:e,promise:n}=this.destroyClones(t);t.stagger=e,n&&(s=n)}else this.destroyClones();return delete n.placeholder,n.context={},delete n.oldest,delete n.newest,n.deleted=!0,this.childTags.length=0,this.hasLiveElements=!1,delete r.tagSupport,s=s?s.then((async()=>{const t=o.map((t=>t.destroy({stagger:0,byParent:!0})));return Promise.all(t)})):Promise.all(o.map((t=>t.destroy({stagger:0,byParent:!0})))),s.then((()=>t.stagger))}destroySubscriptions(){const t=this.global.subscriptions;for(let e=t.length-1;e>=0;--e)t[e].unsubscribe();t.length=0}destroyClones({stagger:t}={stagger:0}){const e=[...this.clones];this.clones.length=0;const n=e.map((e=>this.checkCloneRemoval(e,t))).filter((t=>t)),r=this.global.context;for(const t in r){const e=r[t].clone;e?.parentNode&&e.parentNode.removeChild(e)}return n.length?{promise:Promise.all(n),stagger:t}:{stagger:t}}checkCloneRemoval(t,e){let n;const r=t;r.ondestroy&&(n=function(t,e){const n=t.ondestroy;if(!n)return;const r=n.tagFunction;if(!r)return;const o=r.tagFunction;return o?o({target:t,stagger:e}):void 0}(r,e));const o=()=>{const e=t.parentNode;e&&e.removeChild(t);const n=this.ownerTagSupport;n&&(n.clones=n.clones.filter((e=>e!==t)))};return n instanceof Promise?n.then(o):(o(),n)}getAppTagSupport(){let t=this;for(;t.ownerTagSupport;)t=t.ownerTagSupport;return t}}let Ht,Gt=0;function Xt(t){const e=function(...t){const n=new et(t);n.tagJsType=l.tagComponent;const r=function(t,e){return function(n,r){const o=n.global;++o.renderCount;const s=t.children,a=o.oldest?.templater.children.lastArray;a&&(s.lastArray=a);const i=e.original;let l=t.props,c=l.map((t=>function(t,e){const n=function(t,e){if("object"!=typeof t||!e)return t;for(const n in t){const r=t[n];r instanceof Function&&(t[n].toCall||(t[n]=(...e)=>t[n].toCall(...e),t[n].toCall=(...t)=>Nt(r,t,e),t[n].original=r))}return t}(u(t)?0:t,e);return n}(t,n.ownerTagSupport)));const p=l.map((t=>W(t)));let g=i(...c);g instanceof Function&&(g=g()),g.templater=t,t.tag=g;const d=new qt(t,n.ownerTagSupport,r,o.renderCount);if(d.global=o,d.propsConfig={latest:l,latestCloned:p,lastClonedKidValues:d.propsConfig.lastClonedKidValues},d.memory=n.memory,t.madeChildIntoSubject){const t=s.value;for(let e=t.length-1;e>=0;--e){const n=t[e],r=n.values;for(let t=r.length-1;t>=0;--t){const e=r[t];if(!(e instanceof Function))continue;const o=n.values[t];o.isChildOverride||(n.values[t]=function(...t){const n=d.ownerTagSupport;return rt(e,n,this,t)},o.isChildOverride=!0)}}}return d}}(n,e);return r.parentWrap||(r.parentWrap=e),n.tagged=!0,n.wrapper=r,n};e.original=t,e.compareTo=t.toString();const n=t;return e.isTag=!0,e.original=n,n.tags=nt,n.setUse=v,n.tagIndex=Gt++,nt.push(e),e}function zt(t,e){const n=e.constructMethod.compareTo;t.global.providers.forEach((t=>{n===t.constructMethod.compareTo&&(t.constructMethod.compareTo=e.constructMethod.compareTo)})),t.childTags.forEach((t=>zt(t,e)))}async function Qt(t,e,n,r){const o=t.tagSupport,s=o.global.oldest,a=o.global.newest,i=e.original.toString();n.original&&(n.compareTo=i),n.original=e.original,o.templater.wrapper.parentWrap.original=e.original,a.templater.wrapper.parentWrap.original=e.original,s.templater.wrapper.parentWrap.original=e.original;const l=a.global.providers.map((t=>t.constructMethod)),c=r.renderTagOnly(a,a,a.subject,a.ownerTagSupport),u=s.getAppTagSupport(),p=c.global.providers,g=s.ownerTagSupport.global.oldest;c.ownerTagSupport=g,g.childTags.push(c),p.forEach(((t,e)=>{l[e].compareTo=t.constructMethod.compareTo,t.constructMethod.compareTo=t.constructMethod.toString(),zt(u,t)})),await s.destroy(),s.global.deleted=!1,delete c.global.oldest,delete c.global.newest;const d=s.global.insertBefore;c.buildBeforeElement(d,{counts:{added:0,removed:0}}),c.global.newest=c,c.global.oldest=c,t.tagSupport=c}function Yt(t){[...document.querySelectorAll("app")].forEach(t)}async function Zt(){const t=[...document.querySelectorAll("[tag]")].map((async t=>{const e=t.getAttribute("url"),r=t.getAttribute("name"),o=await n(519)(`${e}?${Date.now()}`);try{const t=o[r]();return{newApp:o,newTemplater:t,tagName:r}}catch(t){throw console.error(`Could not load tag by name ${r}`,{newApp:o,url:e}),t}}));return await Promise.all(t)}Xt.oneRender=(...t)=>{throw new Error("Do not call function tag.oneRender but instead set it as: `(props) => tag.oneRender = (state) => html`` `")},Xt.route=t=>{throw new Error("Do not call function tag.route but instead set it as: `tag.route = (routeProps: RouteProps) => (state) => html`` `")},Xt.app=t=>{throw new Error("Do not call function tag.route but instead set it as: `tag.route = (routeProps: RouteProps) => (state) => html`` `")},Object.defineProperty(Xt,"oneRender",{set(t){t.oneRender=!0}}),function t(){const e=new WebSocket("ws://localhost:3000");e.addEventListener("error",(t=>{console.error("WebSocket error:",t)})),e.addEventListener("open",(t=>{console.info("WebSocket connection opened:",t)})),e.addEventListener("message",(async t=>{console.info("Message from server:",t.data,t.data),"Connected to the WebSocket endpoint"!==t.data?Yt((t=>{!async function(t){const e=te,n=t.setUse;(await Zt()).forEach((async t=>{const{newApp:r,newTemplater:o}=t,s=r.hmr,a=o.wrapper.parentWrap.original,i=a.tags,l=a.setUse;l.memory.providerConfig=n.memory.providerConfig,n.tagUse.length=0,n.tagUse.push(...l.tagUse),Object.assign(n.memory,l.memory),l.memory=n.memory;const c=e.reduce(((t,e)=>{let n=i.map((t=>t.original)).find((t=>t.toString()===e.original.toString()));if(!n){const r=e.tagIndex;void 0!==r&&(n=i[r]),t.push({oldTag:e,newTag:n})}return t}),[]);c.length||console.warn("No old tags changed",{newTags:i,oldTags:e});const u=e.length===i.length;if(i.forEach((t=>{let n=e.map((t=>t.original)).find((e=>t.original.toString()===e.toString())),r=null;if(!n&&c[0].newTag&&(r=t.tagIndex,u&&(n=e[r])),!n){if(c[0].newTag){const n="HMR has two tags";throw console.warn(n,{first:c[0].newTag.original,second:t.original,equal:t.original===c[0].newTag.original,oldTags:e,newTags:i,tagIndex:r}),new Error(n)}c[0].newTag=t}})),c.length){const{oldTag:t,newTag:e}=c[0],n=function(t,e){const n=t.templater.wrapper.parentWrap,r=n.original===e;if(r)return r;return n.original.toString()===e.toString()}(Ht,t.original);if(n)throw Ht.templater.wrapper.parentWrap.original=e.original,Ht.ownerTagSupport={clones:[],childTags:[]},te=i,new Error("app changed, need code for that");console.log("tagChangeStates[0]",{x:c[0],oldOrg:t.original,oldOrgParent:t.parentWrap});const r=await ee(Ht,c[0],s);t.original=e.original,e.compareTo=e.original.toString(),r<=0?console.warn("✋ No components were updated",c[0]):console.debug(`✅ Replaced and update components ${r}`,c[0])}te=i,console.info("✅ ✅ ✅ rebuilt")}))}(t)})):Yt((t=>{Zt().then((e=>{e.forEach((({newApp:e,tagName:n})=>{const{tagElement:r}=e.hmr;t.destroy&&t.destroy();const o=r(e[n],t,{test:1});return te=o.tags,Ht=o.tagSupport,o}))}))}))})),e.addEventListener("close",(e=>{console.info("WebSocket connection closed:",e),t()}))}();let te=[];async function ee(t,{oldTag:e,newTag:n},r){let o=0;const s=t.templater.tag.values.map((async(s,a)=>{const i=s.jsTagType=l.templater;if(!s||!i)return;const c=function(t,e){const n=t.parentWrap.original;if(!n)throw"maybe issue";if(!e.original)throw"maybe issue 2";const r=e.original,o=n===r;if(o)return o;const s=n.toString()===r.toString();if(s)return s;return t.parentWrap.compareTo===r.toString()}(s.wrapper,e);return c?(Qt(t.global.context[Q+a],n,e,r),void++o):void 0}));await Promise.all(s);const a=t.childTags.map((async t=>{o+=await ee(t,{oldTag:e,newTag:n},r)}));return await Promise.all(a),o}})();