var t={519:t=>{function e(t){return Promise.resolve().then((()=>{return import(t);throw e.code="MODULE_NOT_FOUND",e}))}e.keys=()=>[],e.resolve=e,e.id=519,t.exports=e},778:(t,e,n)=>{function r(t){const e={beforeRender:t.beforeRender||(()=>{}),beforeRedraw:t.beforeRedraw||(()=>{}),afterRender:t.afterRender||(()=>{}),beforeDestroy:t.beforeDestroy||(()=>{})};r.tagUse.push(e)}function o(t,e){r.tagUse.forEach((n=>n.beforeRedraw(t,e)))}function s(t,e){e.parentNode.insertBefore(t,e)}function a(t,e,n){const r=t.split(".");if("style"===r[0]&&(n.style[r[1]]=e),"class"===r[0])return r.shift(),void(e?r.forEach((t=>n.classList.add(t))):r.forEach((t=>n.classList.remove(t))))}function i(t){return!0===t?.isTemplater}function u(t){return!0===t?.isTag}function c(t){return!(!0!==t?.isSubject&&!t?.subscribe)}function l(t){return t instanceof Array&&t.every((t=>u(t)))}function p(t,e,n){t.setAttribute(e,n)}function g(t,e,n){t[e]=n}function d(t,e,n){const r=t.getAttributeNames();"TEXTAREA"!==t.nodeName||r.includes("value")||h("textVarValue",t.getAttribute("textVarValue"),t,e,n,((e,n)=>t.value=n));let o=p;r.forEach((r=>{"INPUT"===t.nodeName&&"value"===r&&(o=g),h(r,t.getAttribute(r),t,e,n,o),o=p}))}function f(t){return t.search(/^(class|style)(\.)/)>=0}function h(t,e,n,r,o,s){if(w(e))return function(t,e,n,r,o,s){return v(t,b(r,e),n,o,s)}(t,e,n,r,o,s);if(w(t)){let e;const a=b(r,t).subscribe((t=>{!function(t,e,n,r,o){if(e&&e!=t&&("string"==typeof e?n.removeAttribute(e):e instanceof Object&&Object.entries(e).forEach((([t])=>n.removeAttribute(t)))),"string"!=typeof t)t instanceof Object&&Object.entries(t).forEach((([t,e])=>v(t,e,n,r,o)));else{if(!t.length)return;v(t,"",n,r,o)}}(t,e,n,o,s),e=t}));return o.cloneSubs.push(a),void n.removeAttribute(t)}return f(t)?a(t,e,n):void 0}n.r(e),n.d(e,{ArrayValueNeverSet:()=>ut,Tag:()=>ct,escapeSearch:()=>it,escapeVariable:()=>st,variablePrefix:()=>ot}),r.tagUse=[],r.memory={};const m=/^\s*{__tagvar/,y=/}\s*$/;function w(t){return t&&t.search(m)>=0&&t.search(y)>=0}function b(t,e){return t[e.replace("{","").split("").reverse().join("").replace("}","").split("").reverse().join("")]}function v(t,e,n,r,o){const s=f(t);if(e instanceof Function){const r=function(...t){return e(n,t)};n[t].action=r}if(c(e)){n.removeAttribute(t);const i=e=>function(t,e,n,r,o){if(t instanceof Function)return e[n]=function(...n){return t(e,n)},void(e[n].tagFunction=t);if(r)return void a(n,t,e);if(t)return void o(e,n,t);void 0===t||!1===t||null===t?e.removeAttribute(n):o(e,n,t)}(e,n,t,s,o),u=e.subscribe(i);r.cloneSubs.push(u)}else o(n,t,e)}const S=/(?:<[^>]*?(?:(?:\s+\w+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^>\s]+)))*\s*)\/?>)|({__tagvar[^}]+})/g;function T(t,e,n,{counts:r,forceElement:o}){const s=e,a=s.tag;if(a&&!o&&a.isLikeTag(t)){if(e instanceof Function){const t=e(a.tagSupport);return a.updateByTag(t),[]}return a.updateByTag(t),[]}const i=t.buildBeforeElement(n,{counts:r,forceElement:o});return s.tag=t,i}function E(t,e,n,s,a){if(!0!==t.tagged){let e=t.wrapper.original.name||t.wrapper.original.constructor?.name;"Function"===e&&(e=void 0);const n=e||t.wrapper.original.toString().substring(0,120);throw new Error(`Not a tag component. Wrap your function with tag(). Example tag(props => html\`\`) on component:\n\n${n}\n\n`)}const i=t,u=t.tagSupport;let c=i.newest;return r.memory.providerConfig.ownerTag=s,(!c||a.forceElement)&&(c?o(u,c):function(t,e){r.tagUse.forEach((n=>n.beforeRender(t,e)))}(u,s),c=i.forceRenderTemplate(u,s),i.newest=c),s.children.push(c),u.templater=c.tagSupport.templater,T(c,e,n,a)}class A{value;isSubject=!0;subscribers=[];constructor(t){this.value=t}subscribe(t){this.subscribers.push(t),x.globalSubs.push(t);const e=x.globalSubCount$;x.globalSubCount$.set(e.value+1);const n=()=>{n.unsubscribe()};return n.unsubscribe=()=>{C(this.subscribers,t),C(x.globalSubs,t),x.globalSubCount$.set(e.value-1),n.unsubscribe=()=>{}},n}set(t){this.value=t,this.subscribers.forEach((e=>{e.value=t,e(t)}))}next=this.set}function C(t,e){const n=t.indexOf(e);-1!==n&&t.splice(n,1)}const x=A;x.globalSubs=[],x.globalSubCount$=new A,x.globalSubCount$.set(0);class j extends A{value;constructor(t){super(t),this.value=t}subscribe(t){const e=super.subscribe(t);return t(this.value),e}}function P(t){return N(t,new WeakMap)}function N(t,e){if(null===t||"object"!=typeof t)return t;if(e.has(t))return e.get(t);if(t instanceof Date)return new Date(t);if(t instanceof RegExp)return new RegExp(t);const n=Array.isArray(t)?[]:Object.create(Object.getPrototypeOf(t));if(e.set(t,n),Array.isArray(t))for(let r=0;r<t.length;r++)n[r]=N(t[r],e);else for(const r in t)t.hasOwnProperty(r)&&(n[r]=N(t[r],e));return n}function O(t,e){return R(t,e,new WeakMap)}function R(t,e,n){if(t===e||(o=e,(r=t)instanceof Function&&o instanceof Function&&r.toString()===o.toString()))return!0;var r,o;if("object"!=typeof t||"object"!=typeof e||null===t||null===e)return!1;const s=Object.keys(t),a=Object.keys(e);if(s.length!==a.length)return!1;if(n.has(t))return!0;n.set(t,0);for(const r of s)if(!a.includes(r)||!R(t[r],e[r],n))return!1;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!R(t[r],e[r],n))return!1}else if(Array.isArray(t)||Array.isArray(e))return!1;return!0}function V(t,e){if(t===e)throw new Error("someting here");const n=t.propsConfig.latest;if(function(t,e,n){if(void 0===t&&t===n)return!1;let r=t,o=e;if("object"==typeof t){if(!e)return!0;if(r={...t},o={...e||{}},!Object.entries(r).every((([t,e])=>{let n=o[t];return!(e instanceof Function)||n instanceof Function&&(n.original&&(n=n.original),e.original&&(e=e.original),e.toString()===n.toString()&&(delete r[t],delete o[t],!0))})))return!0}return!O(e,t)}(e.propsConfig.latest,t.propsConfig.latestCloned,n))return!0;const r=function(t,e){const n=t.propsConfig.lastClonedKidValues,r=e.propsConfig.lastClonedKidValues;return!n.every(((t,e)=>{const n=r[e];return t.every(((t,e)=>t===n[e]))}))}(t,e);return r}function B(t){t.tagSupport.memory.providers.filter((t=>!O(t.instance,t.clone))).forEach((e=>{!function(t,e){F(t,e).forEach((({tag:t,renderCount:e,provider:n})=>{e===t.tagSupport.memory.renderCount&&(n.clone=P(n.instance),t.tagSupport.render())}))}(t.getAppElement(),e),e.clone=P(e.instance)}))}function F(t,e,n=[]){const r=t.tagSupport.memory.providers.find((t=>t.constructMethod===e.constructMethod));return r&&n.push({tag:t,renderCount:t.tagSupport.memory.renderCount,provider:r}),t.children.forEach((t=>F(t,e,n))),n}class k{templater;children;propsConfig;memory={context:{},state:{newest:[]},providers:[],renderCount:0};constructor(t,e,n){this.templater=t,this.children=e;const r=function(t,e){const n=function(t,e){if("object"!=typeof t)return t;const n=t;return Object.entries(n).forEach((([t,r])=>{if(r instanceof Function){const o=n[t].original;return o?(n[t]=(...t)=>e(r,t),void(n[t].original=o)):(n[t]=(...t)=>e(r,t),void(n[t].original=r))}})),n}(u(t)?0:t,(function(t,n){const r=t(...n),o=e.newest?.ownerTag?.tagSupport;return o&&o.render(),r}));return n}(n,t);this.propsConfig={latest:n,latestCloned:r,clonedProps:r,lastClonedKidValues:e.value.map((t=>$(t.values)))},u(n)||(this.propsConfig.latestCloned=P(r),this.propsConfig.clonedProps=this.propsConfig.latestCloned)}oldest;newest;mutatingRender(){const t='Tag function "render()" was called in sync but can only be called async';throw console.error(t,{tagSupport:this}),new Error(t)}render(){return++this.memory.renderCount,this.mutatingRender()}renderExistingTag(t,e){const n=this.memory.renderCount;if(B(t),n!==this.memory.renderCount)return!0;const r=V(t.tagSupport,e.tagSupport);return this.newest=this.templater.redraw(),!r}}function $(t){return t.map((t=>{const e=t;return u(e)?$(e.values):i(e)?P(e.tagSupport.propsConfig.latestCloned):l(e)?$(e):P(t)}))}class U extends Error{details;constructor(t,e,n={}){super(t),this.name=U.name,this.details={...n,errorCode:e}}}class _ extends U{constructor(t,e){super(t,"array-no-key-error",e),this.name=_.name}}function L(t,e,n,r,o){const s=[];t.lastArray=t.lastArray||[],t.template=n;let a=0;t.lastArray=t.lastArray.filter(((n,r)=>{const s=e.length-1<r-a,i=e[r-a],u=i?.arrayValue;return!(s||!M(u,n.tag.arrayValue))||(t.lastArray[r].tag.destroy({stagger:o.counts.removed,byParent:!1}),++a,++o.counts.removed,!1)}));const i=n||n.clone;return e.forEach(((n,a)=>{const u=t.lastArray[a],c=n.tagSupport||u?.tag.tagSupport;n.tagSupport=c||new k({},new j([])),c?c.newest=n:(n.tagSupport.mutatingRender=()=>(r.tagSupport.render(),n),r.children.push(n)),n.ownerTag=r;const l=n.arrayValue;if(l?.isArrayValueNeverSet){const t={template:n.getTemplate().string,array:e,ownerTagContent:r.lastTemplateString},o="Use html`...`.key(item) instead of html`...` to template an Array";throw console.error(o,t),new _(o,t)}if(t.lastArray.length>a)return M(u.tag.arrayValue,n.arrayValue)?(n.tagSupport=n.tagSupport||u.tag.tagSupport,u.tag.updateByTag(n),[]):[];const p=function(t,e,n,r,o){n.lastArray.push({tag:e,index:r});const s={added:o.counts.added+r,removed:o.counts.removed},a=t;return e.buildBeforeElement(a,{counts:s,forceElement:o.forceElement})}(i,n,t,a,o);s.push(...p)})),s}function M(t,e){return t===e||!!(t instanceof Array&&e instanceof Array&&t.length==e.length)&&t.every(((t,n)=>t==e[n]))}function D(t,e,n,r){const o=e.clone||n;e.template=n;const s=H(t,o);e.clone=s;const a=[],i=r.clones.indexOf(o);return i>=0&&!r.clones.includes(s)&&!o.parentNode&&(r.clones.splice(i,1),r.clones.push(s),a.push(s)),a}var W;function I(t,e,n,r,o){return t.tagSupport||(t.tagSupport=new k({},new j([])),t.tagSupport.mutatingRender=()=>{r.tagSupport.render()},t.tagSupport.oldest=t.tagSupport.oldest||t,r.children.push(t),t.ownerTag=r),e.template=n,T(t,e,n,o)}function q(t,e,n,r){const o=e.tag,s=e.clone||n;s.parentNode.insertBefore(n,s);const a=H(t,s);e.clone=a,delete e.tag;const i=r.counts.removed;return o.destroy({stagger:i}).then((t=>r.counts.removed=i+t))}function K(t,e){const n=e.clone,r=n.parentNode;r.insertBefore(t,n),r.removeChild(n),delete e.clone}function X(t,e,n,r,o){const s=[];if(!t.hasAttribute("end"))return s;const a=t.getAttribute("id");if(a?.substring(0,ot.length)!==ot)return s;const c=e[a];let p=o.forceElement;const g=c.subscribe((e=>{const{clones:o}=function(t,e,n,r,o){const s=function(t){return i(t)?W.tagComponent:u(t)?W.tag:l(t)?W.tagArray:W.value}(t),a=e,c=a.clone;switch(s!==W.value&&c&&K(n,a),s){case W.tag:return{clones:I(t,e,n,r,o)};case W.tagArray:return{clones:L(e,t,n,r,o)};case W.tagComponent:return{clones:E(t,e,n,r,o)}}return e.tag?{clones:[],promise:q(t,e,n,o)}:{clones:D(t,e,n,r)}}(e,c,t,n,{counts:{added:r.added,removed:r.removed},forceElement:p});p&&(p=!1),o.push(...o)}));return n.cloneSubs.push(g),s}function H(t,e){const n=e.parentNode;void 0!==t&&!1!==t&&null!==t||(t="");const r=document.createTextNode(t);return n.insertBefore(r,e),n.removeChild(e),r}function z(t,e){if(!t.getAttribute)return;let n=e.counts.added;e.forceElement||(n=function(t,e){const n=t.oninit;if(!n)return e.added;const r=n.tagFunction;if(!r)return e.added;const o=r.tagFunction;return o?(o({target:t,stagger:e.added}),++e.added):e.added}(t,e.counts)-n),t.children&&(e.counts.added,e.counts.removed,new Array(...t.children).forEach(((t,n)=>z(t,{...e,counts:e.counts}))))}!function(t){t.tag="tag",t.tagArray="tag-array",t.tagComponent="tag-component",t.value="value"}(W||(W={}));const G=new RegExp('\\s*<template interpolate end id="__tagvar(\\d{1,4})"([^>]*)></template>(\\s*)');function J(t,e,n,r,o){if(!o||"TEMPLATE"===t.tagName)return[];const s=r.counts,a=[],i=new Array(...o);return"TEXTAREA"===t.tagName&&Q(t),i.forEach(((t,o)=>{const i=X(t,e,n,s,r);"TEXTAREA"===t.tagName&&Q(t),a.push(...i),t.children&&new Array(...t.children).forEach(((t,o)=>{(function(t){return"TEMPLATE"===t.tagName&&void 0!==t.getAttribute("interpolate")&&void 0!==t.getAttribute("end")})(t)&&X(t,e,n,s,r);const i=J(t,e,n,r,t.children);a.push(...i)}))})),a}function Q(t){const e=t.value;if(e.search(G)>=0){const n=e.match(/__tagvar(\d{1,4})/),r="{"+(n?n[0]:"")+"}";t.value="",t.setAttribute("textVarValue",r)}}function Y(t,e,n,r,o){const s=[],a=n.interpolation,i=t.children[0].content.children;if(a.keys.length){const n=J(t,e,r,o,i);s.push(...n)}return d(t,e,r),Z(i,e,r),s}function Z(t,e,n){new Array(...t).forEach((t=>{d(t,e,n),t.children&&Z(t.children,e,n)}))}function tt(t,e){if(t.isChildOverride)return t;const n=(n,r)=>function(t,e,n,r){const o=e.tagSupport,s=(o&&o.memory.renderCount,t.bind(n)(...r));return o.memory.renderCount,o.render(),s instanceof Promise?s.then((()=>(o.render(),"no-data-ever"))):"no-data-ever"}(t,e,n,r);return n.tagFunction=t,n}function et(t,e,n){t.redraw=()=>{const r=e.tag,o=t.tagSupport.newest,s=r?.tagSupport||t.tagSupport,{remit:a,retag:i}=function(t,e,n,r){return e.renderWithSupport(t,n,r)}(s,t,o,n);if(a)return e.set(t),i}}function nt(t,e,n){const s=t.value,a=e,p=t,g=t,d=p.isChildSubject,f=function(t,e){const n=t.lastArray;if(n&&!l(e))return n.forEach((({tag:t})=>t.destroy())),delete t.lastArray,!0;const r=t,o=r.tag,s=i(e),a=!(s||l(e)||u(e));if(o)return(i(o)&&!s||!u(e))&&(rt(o,r),!0);const c=t;return!(!c.clone||a||(K(c.template,c),0))}(t,e);console.log("wasDestroyed",{wasDestroyed:f,isChildSubject:d,value:e}),d&&(e=e.value);const h=g.tag;if(h)!function(t,e,n,s){const a=t.tagSupport.templater.wrapper,i=n?.wrapper,u=a&&i&&a?.original===i?.original,c=n&&t.lastTemplateString===n.lastTemplateString,l=n&&n.getTemplate&&t.isLikeTag(n);if(c||l)return I(n,e,e.template,s,{counts:{added:0,removed:0}});if(u)return function(t,e,n){const s=e.tagSupport,a=s.oldest,i=s.newest;o(a.tagSupport,i||a);const u=t.wrapper();return t.newest=u,s.newest=u,function(t,e){r.tagUse.forEach((n=>n.afterRender(t,e)))}(a.tagSupport,a),e.updateByTag(u),n.set(t),[]}(n,t,e);D(n,e,e.template,s)}(h,t,e,n);else if(l(e))L(t,e,p.template||g.tag?.insertBefore,n,{counts:{added:0,removed:0}});else{if(i(a))return function(t,e,n,r){let o=n.tag;if(!o)return et(e,n,t),void e.redraw();const s=o.tagSupport.templater.wrapper,a=e.wrapper;let i=!1;s&&a&&(i=s.original===a.original);const c=e.tagSupport.propsConfig.latest,l=o.tagSupport;if(l.propsConfig.latest=c,i){const t=r?.tagSupport;let n=t.props;if(u(t.props)||(n=P(t.props)),o&&!V(l,e.tagSupport))return}else rt(o,n);et(e,n,t),l.templater=e,e.redraw(),l.propsConfig={...e.tagSupport.propsConfig}}(n,a,g,s);e instanceof Function?g.set(tt(e,n)):c(e)?g.set(e.value):g.set(e)}}function rt(t,e){delete e.tag,delete e.tagSupport,t.destroy()}const ot="__tagvar",st="--"+ot+"--",at=new RegExp(ot,"g"),it=new RegExp(st,"g");class ut{isArrayValueNeverSet=!0}class ct{strings;values;isTag=!0;clones=[];cloneSubs=[];children=[];tagSupport;ownerTag;insertBefore;appElement;arrayValue=new ut;constructor(t,e){this.strings=t,this.values=e}key(t){return this.arrayValue=t,this}async destroy(t={stagger:0,byParent:!1}){var e,n;!!this.tagSupport&&(e=this.tagSupport,n=this,r.tagUse.forEach((t=>t.beforeDestroy(e,n)))),this.destroySubscriptions();const o=this.children.map((e=>e.destroy({...t,byParent:!0})));return this.ownerTag&&(this.ownerTag.children=this.ownerTag.children.filter((t=>t!==this))),t.byParent||(t.stagger=await this.destroyClones(t)),await Promise.all(o),t.stagger}destroySubscriptions(){this.cloneSubs.forEach((t=>t.unsubscribe())),this.cloneSubs.length=0}async destroyClones({stagger:t}={stagger:0}){let e=!1;const n=this.clones.reverse().map(((n,r)=>{let o;n.ondestroy&&(o=function(t,e){const n=t.ondestroy;if(!n)return;const r=n.tagFunction;if(!r)return;const o=r.tagFunction;return o?o({target:t,stagger:e}):void 0}(n,t));const s=()=>{n.parentNode?.removeChild(n);const t=this.ownerTag;t&&(t.clones=t.clones.filter((t=>t!==n)))};return o instanceof Promise?(e=!0,o.then(s)):s(),o}));return e&&await Promise.all(n),t}updateByTag(t){this.updateConfig(t.strings,t.values),this.tagSupport.templater=t.tagSupport.templater,this.tagSupport.propsConfig={...t.tagSupport.propsConfig},this.tagSupport.newest=t}lastTemplateString=void 0;updateConfig(t,e){this.strings=t,this.updateValues(e)}getTemplate(){const t=function(t){const e=function(t){const e=[];return{string:t.replace(S,((t,n)=>{if(t.startsWith("<"))return t;const r=n.substring(1,n.length-1);return e.push(r),`<template interpolate end id="${r}"></template>`})),keys:e}}(t);return e.string=e.string.replace(it,ot),e}(this.strings.map(((t,e)=>(t.replace(at,st)+(this.values.length>e?`{${ot}${e}}`:"")).replace(/>\s*/g,">").replace(/\s*</g,"<"))).join(""));return this.lastTemplateString=t.string,{interpolation:t,string:t.string,strings:this.strings,values:this.values,context:this.tagSupport?.memory.context||{}}}isLikeTag(t){const{string:e}=t.getTemplate();if(!this.lastTemplateString)throw new Error("no template here");return e===this.lastTemplateString&&t.values.length===this.values.length&&!!t.values.every(((t,e)=>{const n=this.values[e];return!(t instanceof Function&&n instanceof Function)||!(t.toString()!==n.toString())}))}update(){return this.updateContext(this.tagSupport.memory.context)}updateValues(t){return this.values=t,this.updateContext(this.tagSupport.memory.context)}updateContext(t){return this.strings.map(((e,n)=>{const r=ot+n,o=this.values.length>n,s=this.values[n];if(r in t)return nt(t[r],s,this);!function(t,e,n,r,o){if(i(e))et(e,n[r]=new j(e),o);else if(e instanceof Function)n[r]=function(t,e){return new j(tt(t,e))}(e,o);else if(t)u(e)?(e.ownerTag=o,o.children.push(e),n[r]=new j(e)):c(e)?n[r]=e:n[r]=new j(e)}(o,s,t,r,this)})),t}getAppElement(){let t=this;for(;t.ownerTag;)t=t.ownerTag;return t}rebuild(){const t=this.insertBefore;if(!t){const t=new Error("Cannot rebuild. Previous insertBefore element is not defined on tag");throw t.tag=this,t}this.buildBeforeElement(t,{forceElement:!0,counts:{added:0,removed:0}})}buildBeforeElement(t,e={forceElement:!1,counts:{added:0,removed:0}}){this.insertBefore=t;const n=this.update(),r=this.getTemplate(),o=document.createElement("div");o.id="tag-temp-holder",o.innerHTML=`<template tag-wrap="22">${r.string}</template>`;const a=Y(o,n,r,this,{forceElement:e.forceElement,counts:e.counts});this.clones.length=0;const i=function(t,e){const n=[];let r=t.children[0].content.firstChild;for(;r;){const t=r.nextSibling;s(r,e),n.push(r),r=t}return n}(o,t);return this.clones.push(...i),a.length&&(this.clones=this.clones.filter((t=>!a.find((e=>e===t))))),this.clones.forEach((t=>z(t,e))),this.clones}}}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var s=e[r]={exports:{}};return t[r](s,s.exports,n),s.exports}n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{const{variablePrefix:t}=n(778);function e(t){[...document.querySelectorAll("app")].forEach(t)}async function r(){const t=[...document.querySelectorAll("[tag]")].map((async t=>{const e=t.getAttribute("url"),r=t.getAttribute("name"),o=await n(519)(`${e}?${Date.now()}`);try{const t=o[r]();return{newApp:o,newTemplater:t,tagName:r}}catch(t){throw console.error(`Could not load tag by name ${r}`,{newApp:o,url:e}),t}}));return await Promise.all(t)}!function t(){const n=new WebSocket("ws://localhost:3000");n.addEventListener("error",(t=>{console.error("WebSocket error:",t)})),n.addEventListener("open",(t=>{console.info("WebSocket connection opened:",t)})),n.addEventListener("message",(async t=>{console.info("Message from server:",t.data,t.data),"Connected to the WebSocket endpoint"!==t.data?e((t=>{!async function(t){const e=s,n=t.setUse;(await r()).forEach((async t=>{const{newApp:r,newTemplater:u}=t,{redrawTag:c}=r.hmr,l=u.wrapper.original.tags,p=u.wrapper.original.setUse;n.tagUse=p.tagUse,Object.assign(n.memory,p.memory),p.memory=n.memory;const g=e.reduce(((t,e,n)=>{let r=l.find((t=>t.toString()===e.toString()));if(!r){const n=e.tagIndex;void 0!==n&&(r=l[n]),t.push({oldTag:e,newTag:r})}return t}),[]);g.length||console.warn("No old tags changed",{newTags:l,oldTags:e});const d=e.length===l.length;if(l.forEach(((t,n)=>{let r=e.find((e=>t.toString()===e.toString())),o=null;if(!r&&g[0].newTag&&(o=t.tagIndex,d&&(r=e[o])),!r){if(g[0].newTag){const n="HMR has two tags";throw console.warn(n,{first:g[0].newTag,second:t,equal:t===g[0].newTag,oldTags:e,newTags:l,tagIndex:o}),new Error(n)}g[0].newTag=t}})),g.length){const t=g[0].oldTag,e=o.tagSupport.templater,n=e.wrapper.original===t,r=e.wrapper.original.toString()===t.toString();if(n||r){const t=g[0].newTag;return o.tagSupport.templater.wrapper.original=t,await o.destroy(),o=await a(o,c),void(s=l)}const u=await i(o,g[0],c);u<=0?console.warn("✋ No components were updated",g[0]):console.debug(`✅ Replaced and update components ${u}`,g[0])}s=l,console.info("✅ ✅ ✅ rebuilt")}))}(t)})):e((t=>{r().then((e=>{e.forEach((({newApp:e,tagName:n})=>{const{tagElement:r}=e.hmr,a=r(e[n],t,{test:1});return s=a.tags,o=a.tag,a}))}))}))})),n.addEventListener("close",(e=>{console.info("WebSocket connection closed:",e),t()}))}();let o,s=[];async function a(t,e,n){const{retag:r}=e(t.tagSupport,t.tagSupport.templater,t,n);return r.tagSupport.templater.insertBefore=t.tagSupport.templater.insertBefore,r.rebuild(),t.ownerTag&&r.ownerTag.children.push(r),r}async function i(e,{oldTag:n,newTag:r},o){let s=0;const u=e.values.map((async(i,u)=>{if(!i||!i.isTemplater)return;const c=i.wrapper.original===n,l=i.wrapper.original.toString()===n.toString();if(c||l){const n=e.tagSupport.memory.context[t+u];return i.wrapper.original=r,n.tag.tagSupport.templater.wrapper.original=r,await n.tag.destroy(),n.tag=await a(n.tag,o,e),void++s}}));await Promise.all(u);const c=e.children.map((async t=>{s+=await i(t,{oldTag:n,newTag:r},o)}));return await Promise.all(c),s}})();