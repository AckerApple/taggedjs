var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};t.d(e,{W9:()=>z,jo:()=>Te,ew:()=>i,Jf:()=>p,Y2:()=>n,ei:()=>K,B7:()=>B,EF:()=>Ae,XF:()=>H,vw:()=>u,PC:()=>U,O9:()=>Tt,Ot:()=>_,tD:()=>o,E2:()=>$e,OH:()=>_e,Y_:()=>Ke,zV:()=>N,WJ:()=>J,Ie:()=>r,wY:()=>c,eZ:()=>l,Az:()=>k,AZ:()=>jt,cF:()=>Xe,qy:()=>Le,O5:()=>ft,Ze:()=>T,_4:()=>V,iO:()=>P,dk:()=>R,mn:()=>E,NM:()=>A,z:()=>at,bc:()=>ot,sA:()=>Ue,MG:()=>Ie,PL:()=>we,r5:()=>pt,uc:()=>Fe,pG:()=>mt,QB:()=>Pe,Vz:()=>Ee,vJ:()=>gt,AI:()=>I,wk:()=>Q,uz:()=>rt,Tc:()=>Ge,Hf:()=>Qe,_A:()=>He,NU:()=>s,Ah:()=>a,wB:()=>X,id:()=>D,MC:()=>W,zC:()=>$});class n{get(t){return"todo"}}const r="";var o;!function(t){t.unknown="unknown",t.tag="tag",t.dom="dom",t.templater="templater",t.tagComponent="tag-component",t.object="object",t.tagArray="tag-array",t.subject="subject",t.tagJsSubject="tagJsSubject",t.oneRender="oneRender",t.date="date",t.string="string",t.number="number",t.boolean="boolean",t.function="function",t[void 0]="undefined"}(o||(o={}));const s=":tagvar",a=":",l="--"+s+"--",c=new RegExp(l,"g");class i{values;tagJsType;arrayValue;templater;constructor(t){this.values=t}key(t){return this.arrayValue=t,this}}class u extends i{strings;values;tagJsType=o.tag;children;constructor(t,e){super(e),this.strings=t,this.values=e}html(t,...e){return this.children={strings:t,values:e},this}}class p extends i{dom;values;tagJsType=o.dom;children;constructor(t,e){super(e),this.dom=t,this.values=e}html={dom:(t,...e)=>(this.children={dom:t,values:e},this)}}function d(t,e){for(let n=0;n<t.length;n++){const r=t[n];if("attributes"in r&&(r.attributes=g(r.attributes,e)),"children"in r){const t=r.children;d(t,e),r.children=t,0===r.children.length&&delete r.children}n=f(r,e,t,n)}}function f(t,e,n,r){if("text"!==t.nodeName)return r;const l=t;let c=l.textContent;if("string"!=typeof c)return r;const i=new RegExp(s+"(\\d+)"+a,"g");let u;for(;null!==(u=i.exec(c));){const t=parseInt(u[1],10);if(!isNaN(t)&&t<e.length){const l=s+t+a,p=c.slice(0,u.index),f=c.slice(u.index+l.length);let g=e[t];g instanceof Array&&(g=g.map(((t,e)=>{if(t?.tagJsType===o.dom){const e=[...t.dom];d(e,t.values);return e}return t}))),n.splice(r,1,{nodeName:"text",textContent:p},{nodeName:"text",textContent:"",value:g},{nodeName:"text",textContent:f}),c=f,i.lastIndex=0,r+=2}}return l.textContent=c,r}function g(t,e){return t.map((([t,n])=>{if(t.startsWith(s)){const n=parseInt(t.replace(s,""),10);if(!isNaN(n)&&n<e.length)return[e[n]]}if("string"==typeof n&&n.startsWith(s)){const t=parseInt(n.replace(s,""),10);!isNaN(t)&&t<e.length&&(n=e[t])}return[t,n]}))}const b="__safeTagVar";const h=/__safeTagVar(\d+)/g;function m(t){if("attributes"in t&&(t.attributes=t.attributes.map((t=>{if(1===t.length)return t;let[e,n]=t;if("string"==typeof n&&n.startsWith(b)){const t=parseInt(n.replace(b,""),10);n=s+t+a}return[e,n]}))),"children"in t){const e=t.children;for(let t=0;t<e.length;t++){const n=e[t];if("text"===n.nodeName){if("string"!=typeof n.textContent)return;n.textContent=n.textContent.replace(h,((t,e)=>s+e+a))}m(n)}0===e.length&&delete t.children}}const y=/(^:tagvar\d+:|:tagvar\d+:$)/g,v="__safeTagVar",w=/([:_a-zA-Z0-9\-\.]+)(?:="([^"]*)"|=(\S+))?/g,j=/<\/?([a-zA-Z0-9\-]+)([^>]*)>/;function C(t,e){const n=function(t,e){const n=t.map(((t,n)=>n<e.length?t+s+n+a:t));return function(t,e,n){const r=n.length-e.length;if(r>0)for(let n=r;n>0;--n)t.push(s+(e.length+n-1)+a)}(n,t,e),n}(t.map((t=>t.replace(y,((t,e)=>v+e)))),e),r=function(t){const e=[],n=[];let r=null,o=0,l=0;const c=new RegExp(j,"g");for(;l<t.length;){const i=c.exec(t);if(!i)break;const[u,p,d]=i,f=u.startsWith("</"),g=u.endsWith("/>");if(l<i.index){const n=t.slice(l,i.index);if(n.trim()){const t={nodeName:"text",textContent:n};r?(r.children||(r.children=[]),r.children.push(t)):e.push(t)}}if(l=i.index+u.length,f){r=n.pop()||null;continue}const b={nodeName:p,attributes:[]};let h;for(;null!==(h=w.exec(d));){let[t,e,n,r]=h,l=n||r;if(void 0===l){if(e.slice(0,s.length)===s){b.attributes.push([e]);continue}l=s+o+++a}b.attributes.push([e.toLowerCase(),l])}r?(r.children||(r.children=[]),r.children.push(b)):e.push(b),g||(n.push(r),r=b)}if(l<t.length){const n=t.slice(l);if(n.trim()){const t={nodeName:"text",textContent:n.trim()};r?(r.children||(r.children=[]),r.children.push(t)):e.push(t)}}return e}(n.join(""));return r}function x(t,e){return d(t,e),t.forEach(m),t}const S={};function k(t,e){const n=function(t,e){const n=t.map((t=>t.length));return n.push(t.length),Number(n.join(""))}(t),r=S[n],o=r&&function(t,e,n){if(n&&n.strings.length===t.length&&n.strings.every(((e,n)=>e===t[n]))&&n.values.length===e.length)return!0;return!1}(t,e,r);let s;if(o)return s=r.domMeta,s;s=C(t,e);const a={interpolation:void 0,string:void 0,strings:t,values:e,domMeta:s};return S[n]=a,s}function T(t){return[o.dom,o.tag,o.templater].includes(t?.tagJsType)}function A(t){return t?.tagJsType===o.templater}function E(t){return t?.tagJsType===o.tagComponent}function R(t){const e=t?.tagJsType;return e&&[o.tag,o.dom].includes(e)}function V(t){return!(!(!0===t?.isSubject)&&!t?.subscribe)}function P(t){return t instanceof Array&&t.every((t=>[o.tag,o.templater,o.dom,o.tagComponent].includes(t?.tagJsType)))}function N(t){const e=new B;return e.subscribeWith=e=>{const n=[],r=[],o=(o,s)=>{n[s]=!0,r[s]=o;if(n.length===t.length){for(let t=n.length-1;t>=0;--t)if(!n[t])return;e(r,a)}},s=[...t],a=s.shift().subscribe((t=>o(t,0))),l=s.map(((t,e)=>t.subscribe((t=>o(t,e+1)))));return a.subscriptions=l,a},e}function O(t,e,n){const r=B.globalSubCount$;B.globalSubCount$.next(r._value+1);const o=function(){o.unsubscribe()};return o.callback=e,o.subscriptions=[],o.unsubscribe=function(){return function(t,e,n){(function(t,e){const n=t.findIndex((t=>t.callback===e));-1!==n&&t.splice(n,1)})(e,n),B.globalSubCount$.next(B.globalSubCount$._value-1),t.unsubscribe=()=>t;const r=t.subscriptions;for(let t=r.length-1;t>=0;--t)r[t].unsubscribe();return t}(o,n,e)},o.add=t=>(o.subscriptions.push(t),o),o.next=t=>{e(t,o)},o}function F(t,e,n){const r=[...e],o=r.shift(),s=t=>{if(r.length)return F(t,r,n);n(t)};let a=s;const l=o(t,{setHandler:t=>a=t,next:s});a(l)}class B{value;onSubscription;methods=[];isSubject=!0;subscribers=[];subscribeWith;_value;constructor(t,e){this.value=t,this.onSubscription=e,this._value=t,J(this)}subscribe(t){const e=O(0,t,this.subscribers),n=this.subscribeWith;if(n){if(this.methods.length){const n=t;t=t=>{F(t,this.methods,(t=>n(t,e)))}}return n(t)}return this.subscribers.push(e),this.onSubscription&&this.onSubscription(e),e}next(t){this._value=t,this.emit()}set=this.next;emit(){const t=this._value,e=this.subscribers;for(let n=0;n<e.length;++n){const r=e[n];r.callback(t,r)}}toPromise(){return new Promise((t=>{this.subscribe(((e,n)=>{n.unsubscribe(),t(e)}))}))}toCallback(t){const e=this.subscribe(((n,r)=>{e.unsubscribe(),t(n)}));return this}pipe(...t){const e=new B(this._value);return e.setMethods(t),e.subscribeWith=t=>this.subscribe(t),e.next=t=>this.next(t),e}setMethods(t){this.methods=t}static all(t){return N(t.map((t=>{if(V(t))return t;return new B(t,(e=>(e.next(t),e)))})))}static globalSubCount$=new B(0)}function J(t){Object.defineProperty(t,"value",{set(e){t._value=e,t.emit()},get:()=>t._value})}class _ extends B{value;constructor(t){super(t),this.value=t,J(this)}subscribe(t){const e=super.subscribe(t);return t(this._value,e),e}}function D(t){return(e,n)=>{n.setHandler((()=>{})),t(e,n.next)}}function W(t){return(e,n)=>{n.setHandler((()=>{}));t(e).then((t=>n.next(t)))}}const $=t=>(e,n)=>{n.setHandler((()=>{}));const r=t(e).subscribe((t=>{r.unsubscribe(),n.next(t)}))};function M(){return I.memory.stateConfig.support}function I(t){const e={beforeRender:t.beforeRender||(()=>{}),beforeRedraw:t.beforeRedraw||(()=>{}),afterRender:t.afterRender||(()=>{}),beforeDestroy:t.beforeDestroy||(()=>{})};I.tagUse.push(e)}I.tagUse=[],I.memory={};class U extends Error{details;constructor(t,e,n={}){super(t),this.name=U.name,this.details={...n,errorCode:e}}}class z extends U{constructor(t,e){super(t,"array-no-key-error",e),this.name=z.name}}class K extends U{constructor(t,e){super(t,"state-mismatch-error",e),this.name=K.name}}class H extends U{constructor(t,e){super(t,"sync-callback-error",e),this.name=H.name}}const L='letState function incorrectly used. Second item in array is not setting expected value.\n\nFor "let" state use `let name = state(default)(x => [name, name = x])`\n\nFor "const" state use `const name = state(default)()`\n\nProblem state:\n';I.memory.stateConfig={array:[]};const Z=t=>function(t){const e=t.state,n=I.memory.stateConfig;n.rearray=[];const r=e?.length;if(r){for(let t=0;t<r;++t)Y(e[t]);n.rearray.push(...e)}n.support=t}(t);function Y(t){const e=t.callback;if(!e)return t.defaultValue;const[n,r]=function(t){const e=t(G),[n]=e,[r]=t(n);return[n,r]}(e);if(r!==G){const o=L+(e?e.toString():JSON.stringify(t))+"\n";throw console.error(o,{state:t,callback:e,value:n,checkValue:r}),new Error(o)}return n}I({beforeRender:Z,beforeRedraw:Z,afterRender:t=>{const e=t.state,n=I.memory.stateConfig,r=n.rearray;if(r.length&&r.length!==n.array.length){const e=`States lengths have changed ${r.length} !== ${n.array.length}. State tracking requires the same amount of function calls every render. Typically this errors is thrown when a state like function call occurs only for certain conditions or when a function is intended to be wrapped with a tag() call`,o=t.templater?.wrapper,s={oldStates:n.array,newStates:n.rearray,tagFunction:o.parentWrap.original},a=new K(e,s);throw console.warn(e,s),a}delete n.rearray,delete n.support,e.length=0,e.push(...n.array);for(let t=e.length-1;t>=0;--t){const n=e[t];n.lastValue=Y(n)}n.array=[]}});class G{}function q(t,e){for(let n=t.length-1;n>=0;--n){const r=t[n].get(),o=e[n].callback;o&&o(r),e[n].lastValue=r}}function Q(t){const e=I.memory.stateConfig;let n;const r=e.rearray[e.array.length];if(r){let t=Y(r);n=e=>[t,t=e];const o={get:()=>Y(o),callback:n,lastValue:t,defaultValue:r.defaultValue};return e.array.push(o),t}let o=(t instanceof Function?t:()=>t)();if(o instanceof Function){const t=e.array,n=e.support,r=o;o=(...e)=>{const o=n.subject.global.newest.state;q(o,t);const s=r(...e);return q(t,o),s},o.original=r}n=t=>[o,o=t];const s={get:()=>Y(s),callback:n,lastValue:o,defaultValue:o};return e.array.push(s),o}const X=(t,e)=>et(t,e),tt=t=>t;const et=(t,e,{init:n,before:r=(()=>!0),final:o=tt}={})=>{let s=Q({pastResult:void 0,values:void 0});const a=s.values;if(void 0===a){if(!r(t))return s.values=t,s.pastResult;const l=(n||e)(t,a);return s.pastResult=o(l),s.values=t,s.pastResult}if(t.every(((t,e)=>t===a[e])))return s.pastResult;if(!r(t))return s.values=t,s.pastResult;const l=e(t,a);return s.pastResult=o(l),a.length=0,a.push(...t),s.pastResult};function nt(t,e){return Object.defineProperty(e,"noInit",{get(){const e=t();return e.setup.init=()=>{},e}}),Object.defineProperty(e,"asSubject",{get(){const e=t(),n=Q((()=>M())),r=Q((()=>new _(void 0))),o=(t,o)=>(et(t,((t,e)=>{const s=M(),a=o(t,e);if(s!==n){q(I.memory.stateConfig.array,n.state)}r.next(a)}),e.setup),r);return o.setup=e.setup,nt((()=>o),o),o}}),Object.defineProperty(e,"truthy",{get(){const e=t();return e.setup.before=t=>t.every((t=>t)),e}}),e}function rt(t,e){const n=Q((()=>I.memory.stateConfig.array)),r=M();return Q((()=>new B(t,e).pipe((t=>(q(r.state,n),t)))))}function ot(t){const e=I.memory.stateConfig;let n;const r=e.rearray[e.array.length];if(r){let t=Y(r);n=e=>[t,t=e];const o={get:()=>Y(o),callback:n,lastValue:t,defaultValue:r.defaultValue};return e.array.push(o),st(t,o)}let o=(t instanceof Function?t:()=>t)();n=t=>[o,o=t];const s={get:()=>Y(s),callback:n,lastValue:o,defaultValue:o};return e.array.push(s),st(o,s)}function st(t,e){return n=>(e.callback=n||(e=>[t,t=e]),t)}function at(t){return e=>{let n=ot(t)(e);return X([t],(()=>e(n=t))),e(n),n}}function lt(t){return ct(t,0)}function ct(t,e){if(null===t||typeof t!==o.object)return t;if(15===e)return t;if(t instanceof Date)return new Date(t);if(t instanceof RegExp)return new RegExp(t);const n=Array.isArray(t)?[]:Object.create(Object.getPrototypeOf(t));if(Array.isArray(t))for(let r=0;r<t.length;r++)n[r]=ct(t[r],e+1);else for(const r in t)t.hasOwnProperty(r)&&(n[r]=ct(t[r],e+1));return n}function it(t,e){return ut(t,e,0)}function ut(t,e,n){return!!(t===e||(r=t,s=e,r instanceof Function&&s instanceof Function&&r.toString()===s.toString()))||(15===n||typeof t===o.object&&typeof e===o.object&&(t instanceof Date&&e instanceof Date?t.getTime()===e.getTime():Array.isArray(t)&&Array.isArray(e)?function(t,e,n){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!ut(t[r],e[r],n+1))return!1;return!0}(t,e,n+1):!Array.isArray(t)&&!Array.isArray(e)&&function(t,e,n){const r=Object.keys(t),o=Object.keys(e);if(0===r.length&&0===o.length)return!0;if(r.length!==o.length)return!1;for(const s of r){if(!o.includes(s)||!ut(t[s],e[s],n+1))return!1}return!0}(t,e,n+1)));var r,s}nt((()=>function(t){const e=(e,n)=>et(e,n,t);return e.setup=t,nt((()=>e),e),e}({})),X),rt._value=t=>{const e=Q((()=>I.memory.stateConfig.array)),n=M();return Q((()=>new _(t).pipe((t=>(q(n.state,e),t)))))},rt.all=function(t){const e=Q((()=>I.memory.stateConfig.array)),n=M();return B.all(t).pipe((t=>(q(n.state,e),t)))};const pt={create:t=>{const e=Q((()=>({stateDiff:0,provider:void 0})));if(e.stateDiff){for(let t=e.stateDiff;t>0;--t)Q(void 0);return Q(void 0)}const n=Q((()=>{const n=I.memory.stateConfig,r=n.array.length,o="prototype"in t?new t:t(),s=n.support,a=n.array.length-r,l={constructMethod:t,instance:o,clone:lt(o),stateDiff:a,owner:s,children:[]};return e.provider=l,s.subject.global.providers.push(l),e.stateDiff=a,o})),r=t,o=r.compareTo=r.toString();return e.provider.constructMethod.compareTo=o,n},inject:t=>Q((()=>{const e=I.memory,n=t,r=n.compareTo=n.compareTo||t.toString(),o=e.stateConfig.support,s=[];let a={ownerSupport:o.ownerSupport};for(;a.ownerSupport;){const t=a.ownerSupport.subject.global.providers.find((t=>{s.push(t);if(t.constructMethod.compareTo===r)return!0}));if(t){t.clone=lt(t.instance);const n=e.stateConfig.support;return n.subject.global.providers.push(t),t.children.push(n),t.instance}a=a.ownerSupport}const l=`Could not inject provider: ${t.name} ${t}`;throw console.warn(`${l}. Available providers`,s),new Error(l)}))};function dt(t,e){const n=t.templater,r=e.templater,s=n?.tag||t,a=r.tag;return s.tagJsType===a.tagJsType&&(s.tagJsType===o.dom?function(t,e,n,r){const o=t.dom,s=e.dom;if(o!==s){if(!it(t.dom,e.dom))return!1}const a=n.values||t.values,l=r.values||e.values;return ft(a,l)}(s,a,t,e):function(t,e,n,r){const o=t.strings,s=e.strings||r.strings;if(o.length!==s.length)return!1;if(!o.every(((t,e)=>s[e].length===t.length)))return!1;const a=n.values||t.values,l=r.values||e.values;return ft(a,l)}(s,a,t,e))}function ft(t,e){if(!(t.length===e.length))return!1;return!!e.every(((e,n)=>{const r=t[n];if(e instanceof Function&&r instanceof Function){return!!(e.toString()===r.toString())}return!0}))}function gt(t,e){const n=I.tagUse,r=n.length;for(let o=0;o<r;++o)n[o].beforeRender(t,e)}function bt(t,e){const n=I.tagUse,r=n.length;for(let o=0;o<r;++o)n[o].afterRender(t,e);I.memory.tagClosed$.next(e)}function ht(t,e){const n=I.tagUse,r=n.length;for(let o=0;o<r;++o)n[o].beforeDestroy(t,e);if(t.subject.global.deleted=!0,t.hasLiveElements=!1,e){e.subject.global.childTags=e.subject.global.childTags.filter((e=>e!==t.subject.global.oldest));const n=t.subject.global;n.providers.forEach((t=>t.children.forEach(((e,r)=>{e.subject.global===n&&t.children.splice(r,1)}))))}}function mt(t,e,n,r){const o=n.global.renderCount;!function(t,e,n){const r=n?.ownerSupport,o=r||e;if(n){if(n!==t){const e=n.state;t.subject.global=n.subject.global,t.state.length=0,t.state.push(...e)}return function(t,e){const n=I.tagUse,r=n.length;for(let o=0;o<r;++o)n[o].beforeRedraw(t,e)}(t,n)}gt(t,o)}(t,r,e);let s=(0,t.templater.wrapper)(t,n,e);return bt(t,r),n.global.newest=s,!e&&r&&r.subject.global.childTags.push(s),n.global.renderCount>o+1?n.global.newest:s}function yt(t){t.subject.global.oldest.destroy(),t.subject.global.context=[]}function vt(t){return[o.string,o.number,o.boolean].includes(t)}function wt(t,e){t.destroy({stagger:e.removed++})}function jt(t){if(null==t)return o.undefined;const e=typeof t;if(t instanceof Function)return o.function;if(vt(e))return e;if(e===o.object){if(t instanceof Date)return o.date;const e=t.tagJsType;if(e)return e;if(P(t))return o.tagArray;if(V(t))return o.subject}return o.unknown}function Ct(t){return t.map(xt)}function xt(t){const e=t;switch(jt(t)){case o.tagComponent:return lt(t.props);case o.dom:case o.tag:case o.templater:return Ct(e.values);case o.tagArray:return Ct(e)}return lt(t)}function St(t,e=[]){for(let n=t.length-1;n>=0;--n){const r=t[n];e.push(r),St(r.subject.global.childTags,e)}return e}function kt(t,e){if(V(t))return t;if(P(t))return e.madeChildIntoSubject=!0,new _(t);const n=t;return n?(e.madeChildIntoSubject=!0,n.arrayValue=0,new _([n])):(e.madeChildIntoSubject=!0,new _([]))}I.memory.tagClosed$=new B(void 0,(t=>{M()||t.next()}));class Tt{props;tagJsType=o.templater;tagged;wrapper;madeChildIntoSubject;tag;children=new _([]);arrayValue;constructor(t){this.props=t,this.html.dom=this.dom.bind(this)}key(t){return this.arrayValue=t,this}html(t,...e){const n=kt(new u(t,e),this);return this.children=n,this}dom(t,...e){const n=kt(new p(t,e),this);return this.children=n,this}}class At extends _{tagJsType=o.tagJsSubject;global=Et()}function Et(){return{destroy$:new B,context:[],providers:[],renderCount:0,subscriptions:[],oldest:void 0,blocked:[],childTags:[],clones:[]}}function Rt(t,e){const n=t;let r=n.templater;r||(r=new Tt([]),r.tag=n,n.templater=r);const o=new At(r);return o.support=new Ae(r,e,o),o.global.oldest=o.support,e.subject.global.childTags.push(o.support),o}const Vt="undefined"==typeof document?function t(){return{textContent:r,cloneNode:e=>t()}}():document.createTextNode(r);const Pt="style",Nt="class";function Ot(t,e,n){const r=t.split(".");if(r[0]===Pt&&(n.style[r[1]]=e),r[0]===Nt)if(r.shift(),e)for(let t=0;t<r.length;++t)n.classList.add(r[t]);else for(let t=0;t<r.length;++t)n.classList.remove(r[t])}function Ft(t,e,n){t.setAttribute(e,n)}function Bt(t,e){let n=t,r=e;if(typeof t===o.object){if(!e)return 3;n=[...t],r=[...e||[]];if(!n.every(((t,e)=>{let s=r[e];if(t&&typeof t===o.object){const e={...t},n={...s||{}},r=Object.entries(e).every((([t,r])=>Jt(r,n[t],(()=>{delete e[t],delete n[t]}))));return r}return Jt(t,s,(()=>{n.splice(e,1),r.splice(e,1)}))})))return"functions-changed"}return!1}function Jt(t,e,n){if(!(t instanceof Function))return!!it(t,e)&&4;if(!(e instanceof Function))return!1;const r=e?.original;r&&(e=r);t.original&&(t=t.original);return t.toString()===e.toString()?(n(),3):(n(),5)}function _t(t,e,{counts:n},r){const o=e,s=o.support,a=s?.subject.global.oldest||void 0;if(a&&a)return function(t,e,n){if(e instanceof Function){const t=e(n);return n.updateBy(t),e.support=t,t}return e.global.oldest.updateBy(t),e.support=t,t}(t,o,a);const l=t.buildBeforeElement(void 0,{counts:n}),c=e.global.placeholder;return c.parentNode.insertBefore(l,c),t}function Dt(t,e,n,r){if(!t.getAttribute)return;let o=e.counts.added;o=function(t,e){const n=t.oninit;if(!n)return e.added;const r=n.tagFunction;if(!r)return e.added;const o=r.tagFunction;return o?(o({target:t,stagger:e.added}),++e.added):e.added}(t,e.counts)-o;t.focus&&(t.hasAttribute("autofocus")&&t.focus(),t.hasAttribute("autoselect")&&t.select());const s=t.children;if(s)for(let t=s.length-1;t>=0;--t){Dt(s[t],{...e,counts:e.counts},n,r)}}function Wt(t,e,n){let r=n.support;r||(r=It(t,e,n)),n.support=r,r.ownerSupport=e;const o=r.buildBeforeElement(void 0,{counts:{added:0,removed:0}}),s=[...o.children],a=n.global.placeholder;return a.parentNode.insertBefore(o,a),zt(s,n,e),r}function $t(t){const e=Mt();return e.tag=t,t.templater=e,e}function Mt(){const t={children:new _([]),props:[],isTag:!0,tagJsType:"templater",tagged:!1,html:()=>t,dom:()=>t,key:()=>t};return t}function It(t,e,n){const r=new Ae(t,e,n);return Ut(r,e,n),e.subject.global.childTags.push(r),r}function Ut(t,e,n){t.subject=n,n.global.oldest=t,n.global.newest=t,t.ownerSupport=e}function zt(t,e,n){t.forEach((t=>Dt(t,{counts:{added:0,removed:0}},e.global.context,n)))}function Kt(t,e,n,r,o,s){if(!0!==t.tagged){const e=t.wrapper.parentWrap.original;let n=e.name||e.constructor?.name;"Function"===n&&(n=void 0);const r=n||e.toString().substring(0,120);throw new Error(`Not a tag component. Wrap your function with tag(). Example tag(props => html\`\`) on component:\n\n${r}\n\n`)}const a=new Ae(t,r,e);let l=e.support;Ut(a,r,e);const c=a.subject.global=l?.subject.global||a.subject.global;c.oldest=a,c.insertBefore=n;if(!l){l=function(t,e,n){const r=n.subject.global,o=r.clones.map((t=>t)),s=(e=Pe(e,t.support,t,n)).subject.global;if(r.clones.length>o.length){const t=r.clones.filter((t=>!o.find((e=>e===t))));s.clones.push(...t)}return e}(e,l||a,r)}const i=_t(l,e,o);return r.subject.global.childTags.push(i),l}function Ht(t,e,n,r){return t.map((t=>function(t,e,n,r,o){if(T(t)||!t)return t;if(!e)return t;return Lt(t,e,n,r,o)}(t,e.ownerSupport,n,e,r)))}function Lt(t,e,n,r,o,s,a){if(t instanceof Function)return function(t,e,n){const r=t.toCall;if(r)return t;const o=(...t)=>o.toCall(...t);return o.toCall=(...t)=>function(t,e,n){const r=n.subject.global,o=r.newest,s=M(),a=void 0===s;s&&(s.subject.global.locked=!0);const l=t(...e);if(s){const t=s?.subject.global.blocked;if(s&&t?.length)return I.memory.tagClosed$.toCallback((()=>{let t=s;delete s.subject.global.locked,t=se(s,s.state,s),Fe(t,!1)})),l;delete s.subject.global.locked}const c=()=>{if(!1===a){const t=o.state.every((t=>{const e=t.lastValue,n=t.get();return it(xt(e),n)}));if(t)return l}return Fe(o,!0),l};if(a)return c();return I.memory.tagClosed$.toCallback(c),l}(o.mem.prop,t,e),o.original=t,o.mem={prop:t},Object.assign(o,t),o}(t,e);if(15===o)return t;if(Yt(t))return t;if(t instanceof Array){for(let s=t.length-1;s>=0;--s){const a=t[s];if(t[s]=Lt(a,e,n,r,o+1,s,t),a instanceof Function){if(a.toCall)continue;Zt(o+1,s,a,t,r)}}return t}const l=Object.keys(t);for(const s of l){const a=t[s],l=Lt(a,e,n,r,o+1,s,t);if(t[s]===l)continue;const c=Object.getOwnPropertyDescriptor(t,s);if(!(c?.get||c?.set)&&(t[s]=l,l instanceof Function)){if(a.toCall)continue;Zt(o+1,s,a,t,r)}}return t}function Zt(t,e,n,r,o){if(n?.toCall)throw new Error("meg");if(t>0){const t=o.subject.global;r[e].subscription=t.destroy$.toCallback((()=>{r[e]=n}))}}function Yt(t){return"object"!=typeof t||!t}function Gt(t,e,n,r,o=!1){let s=n.global.newest;const a=s.templater.wrapper,l=e.templater.wrapper;let c=!1;if(a&&l){c=a.parentWrap.original===l.parentWrap.original}const i=e.templater;if(!c){yt(n.global.oldest);return Kt(i,n,r,t,{counts:{added:0,removed:0}})}const u=function(t,e,n){const r=Bt(n.props,t.propsConfig.latestCloned);if(r)return r;const o=Bt(t.propsConfig.latestCloned,e.propsConfig.latestCloned);if(o)return o;const s=function(t,e){const n=t.propsConfig.lastClonedKidValues,r=e.propsConfig.lastClonedKidValues;return!n.every(((t,e)=>{const n=r[e];return t.every(((t,e)=>t===n[e]))}))&&9}(t,e);return s}(s,e,i);if(!u){const n=qt(e,s,t,i.props);return e.propsConfig.castProps=n,s.propsConfig.latestCloned=e.propsConfig.latestCloned,s.propsConfig.lastClonedKidValues=e.propsConfig.lastClonedKidValues,s}const p=n.global.oldest;if(n.global.locked)return n.global.blocked.push(e),e;return function(t,e,n,r,o,s){let a=t.support;if(e&&n.children._value.length){e.templater.children.next(n.children._value)}const l=s&&dt(r,o);if(l){const e=t.global.oldest;return t.support=o,e.updateBy(o),o}if(s&&a){r.subject.global.deleted||Ve(r)}return function(t,e){const n=t.buildBeforeElement(void 0,{counts:{added:0,removed:0}}),r=[...n.children],o=e.global.placeholder;return o.parentNode.insertBefore(n,o),zt(r,e,t),e.global.oldest=t,e.global.newest=t,e.support=t,t.ownerSupport.subject.global.childTags.push(t),t}(o,t)}(n,p,i,n.global.newest,Fe(e,o),c)}function qt(t,e,n,r,o=-1){const s=e.subject.global.newest;if(!s){const e=n.state;r.length=0;const s=Ht(r,t,e,o);return r.push(...s),t.propsConfig.castProps=s,r}const a=(e=s||e).propsConfig.castProps,l=[];for(let e=0;e<r.length;++e){const s=r[e],c=Qt(a[e],s,t,n,o+1,e);l.push(c)}return t.propsConfig.castProps=l,l}function Qt(t,e,n,r,o,s){if(t instanceof Function){if(e.mem)return t.mem.prop=e.mem.prop,t.mem.stateArray=e.mem.stateArray,e;const n=r.subject.global.newest.state;return t.mem.prop=e,t.stateArray=n,t}if(15===o)return e;if(Yt(e))return e;if(e instanceof Array){for(let s=e.length-1;s>=0;--s){const a=e[s];e[s]=Qt(t[s],a,n,r,o+1,s)}return e}if(void 0===t)return e;const a=Object.keys(e);for(const s of a){const a=e[s],l=Qt(t[s],a,n,r,o+1,s);if(e[s]===l)continue;const c=Object.getOwnPropertyDescriptor(e,s)?.set;c||(e[s]=l)}return e}const Xt=!0,te="no-data-ever",ee="promise-no-data-ever";function ne(t,e,n,r,o){const s=re(e),a=s.subject.global.newest.state;a.length===o.length&&q(a,o);const l=t.bind(n);s.subject.global.locked=Xt;return function(t,e,n){const r=t.subject.global;delete r.locked;const o=r.blocked;if(o.length){let o;return o=se(t,n,o),oe(e,o,r)}const s=function(t,e,n){if(n.deleted)return te;return Fe(t,!0),oe(e,t,n)}(r.newest,e,r);return s}(s,l(...r),o)}function re(t){if(t.templater.tagJsType===o.templater){return re(t.ownerSupport)}return t}function oe(t,e,n){return t instanceof Promise?(e.subject.global.locked=Xt,t.then((()=>(delete e.subject.global.locked,n.deleted||(delete e.subject.global.locked,Fe(n.newest,!0)),ee)))):te}function se(t,e,n){const r=t.subject.global,o=r.blocked;for(;o.length>0;){const t=o[0];o.splice(0,1),n=Gt(t.ownerSupport,t,t.subject,t.subject.global.insertBefore,!0),r.newest=n}return r.blocked.length=0,n}const ae="INPUT",le="value",ce="ondoubleclick";function ie(t,e,n,s,a=Ft){const l=t[0],c=t[1];e.nodeName===ae&&l===le&&(a=Ft);if(1===t.length){let t;const n=l.subscribe((n=>{n!==t&&(!function(t,e,n,s,a){if(e&&e!=t)if(typeof e===o.string)n.removeAttribute(e);else if(e instanceof Object)for(const t in e)n.removeAttribute(t);if(typeof t===o.string){if(!t.length)return;return void ue(t,new At(r),n,s,a)}if(t instanceof Object)for(const e in t)ue(e,t[e],n,s,a)}(n,t,e,s,a),t=n)}));return s.subject.global.subscriptions.push(n),void e.removeAttribute(l)}if(c&&V(c))return ue(l,c,e,s,a);if(de(l))return Ot(l,c,e);a(e,l,c)}function ue(t,e,n,r,o){if(V(e)){const s=de(t);let a;n.removeAttribute(t);const l=e=>e instanceof Function?function(t,e,n,r,o,s){const a=t.templater.wrapper,l=a?.parentWrap,c=l?.oneRender;c||(e=function(t,e){if(t.isChildOverride)return t;const n=e.state,r=(r,o)=>ne(t,e,r,o,n);return r.tagFunction=t,r}(e,t));return pe(e,n,r,o,s)}(r,e,n,t,s,o):a===e?a:(a=e,pe(e,n,t,s,o)),c=e.subscribe(l);r.subject.global.subscriptions.push(c)}else o(n,t,e._value)}function pe(t,e,n,r,o){if(t instanceof Function){const r=function(...n){return t(e,n)};return r.tagFunction=t,n===ce&&(n="ondblclick"),void(e[n]=r)}if(r)return void Ot(n,t,e);if(t)return void o(e,n,t);[void 0,!1,null].includes(t)?e.removeAttribute(n):o(e,n,t)}function de(t){return t.search(/^(class|style)(\.)/)>=0}function fe(t,e,n,r,o,s){const a=r.subject.global.clones;let l=t.lastArray=t.lastArray||{array:[]};t.global.placeholder||function(t,e){const n=e.global.placeholder=Vt.cloneNode(!1),r=t.parentNode;r.insertBefore(n,t),r.removeChild(t)}(n,t);const c=t.global.placeholder;let i=0;l.array=l.array.filter(((t,n)=>{if(e.length-1<n-i)return he(l.array,n,o),++i,!1;const r=e[n-i],s=R(r);let a,c=r,u=r.templater;s?a=c.arrayValue:(u=r,c=u.tag,a=u.arrayValue);const p=!function(t,e){if(t===e)return!0;if(t instanceof Array&&e instanceof Array&&t.length==e.length)return t.every(((t,n)=>t===e[n]));return!1}(a,t.support.templater.tag.arrayValue);return!p||(he(l.array,n,o),++i,!1)}));const u=e.length;for(let t=0;t<u;++t){const n=e[t],a=l.array[t],i=a?.support,u=n,p=R(u),d=i?.subject||new At(void 0);let f,g=u.templater;if(p?(g||(g=$t(u)),f=new Ae(g,r,d)):(g=u,f=be(g,r,d)),i){const t=i.subject,e=t.global;Ut(f,r,t),f.subject.global=e,e.newest=f}else Ut(f,r,d);if(!("arrayValue"in(g.tag||u))){const t={array:e},n="Use html`...`.key(item) instead of html`...` to template an Array";console.error(n,t);throw new z(n,t)}if(l.array.length>t){a.support.subject.global.oldest.updateBy(f)}else ge(c,f,t,o,l.array,s),r.subject.global.childTags.push(f)}return a}function ge(t,e,n,r,o,s){const a={support:e,index:n};o.push(a);const l={added:r.counts.added+n,removed:r.counts.removed};e.subject.global.placeholder=t;const c=e.buildBeforeElement(void 0,{counts:l}),i=[...c.children],u=t;u.parentNode.insertBefore(c,u),zt(i,e.subject,e)}function be(t,e,n){const r=It(t,e,n);return mt(r,r,n,e),r}function he(t,e,n){const r=t[e];wt(r.support,n.counts),r.deleted=!0,++n.counts.removed}function me(t,e){const n=e.parentNode,r=document.createTextNode(t);return n.insertBefore(r,e),n.removeChild(e),r}function ye(t){return[void 0,!1,null].includes(t)?r:t}function ve(t,e,n){e.global.insertBefore=n;const r=e.global.placeholder||n;if(e.lastValue===t&&"lastValue"in e)return;e.lastValue=t;const o=ye(t),s=e.global.placeholder;if(s)return void(s.textContent=o);const a=me(o,r);e.global.placeholder=a}function we(t,e,n){const r=new Tt([]);r.tagJsType=o.oneRender;const s=It(r,n,e);const a=()=>(r.tag=t(),s);return r.wrapper=a,a.parentWrap=a,a.oneRender=!0,a.parentWrap.original=t,s}function je(t,e,n,r,s,a){switch(jt(t)){case o.templater:return void Wt(t,r,e);case o.dom:case o.tag:const l=t;let c=l.templater;return c||(c=$t(l)),void Wt(c,r,e);case o.tagArray:return fe(e,t,n,r,s,a);case o.tagComponent:return Kt(t,e,n,r,s);case o.function:const i=t;if(i.oneRender){const t=we(i,e,r);return mt(t,t,e,r),void Wt(t.templater,r,e)}}!function(t,e,n){e.lastValue=t;const r=me(ye(t),n);e.global.placeholder=r}(t,e,e.global.placeholder||n)}function Ce(t){const e=Vt.cloneNode(!1),n=t.parentNode;return n.insertBefore(e,t),n.removeChild(t),e}function xe(t,e,n,r){const s=jt(e);if(function(t,e,n){const r=t,s="lastValue"in r,a=r.lastValue;if(s&&a!==e){const t=typeof e;return(!vt(t)||typeof a!==t)&&!(e instanceof Function&&a instanceof Function)&&(function(t){delete t.lastValue}(r),"changed-simple-value")}const l=t,c=l.lastArray;if(c&&n!==o.tagArray){delete l.lastArray;for(let t=c.array.length-1;t>=0;--t){const{support:e}=c.array[t];wt(e,{added:0,removed:0})}return"array"}const i=t.support;if(i){const r=T(e);return T(t._value)&&r?!dt(e,i)&&(yt(i),2):n!==o.tagComponent&&(!e||!e.oneRender)&&(yt(i),"different-tag")}}(t,e,s),s===o.tagComponent)return function(t,e,n,r){if(!e.support)return Kt(t,e,n,r,{counts:{added:0,removed:0}}),e;const o=new Ae(t,r,e),s=e.support,a=s.subject.global.newest;if(!a)return Kt(t,e,n,r,{counts:{added:0,removed:0}}),e;{const t=a.state;o.state.length=0,o.state.push(...t)}return e.global=s.subject.global,e.support=o,Gt(r,o,e,n),e}(e,t,r,n);if(t.support)return s===o.function||function(t,e,n){const r=t.support;let o=e;const s=R(e);if(s){const t=e;o=t.templater,o||(o=new Tt([]),o.tag=t,t.templater=o)}const a=new Ae(o,n,t),l=e&&dt(r,a);A(e)&&Ut(a,n,t);if(l)return void r.subject.global.oldest.updateBy(a);if(l)return Wt(o,n,t);ve(e,t,t.global.insertBefore)}(t,e,n),t;switch(s){case o.tagArray:return fe(t,e,r,n,{counts:{added:0,removed:0}}),t;case o.templater:return Wt(e,n,t),t;case o.tag:case o.dom:const s=e;let a=s.templater;return a||(a=Mt(),s.templater=a,a.tag=s),Wt(a,n,t),t;case o.subject:return e;case o.function:return t.global.placeholder||(t.global.placeholder=Ce(r)),t}return ve(e,t,r),t}function Se(t,e,n,r,o){let s=!1;n.global.placeholder||(n.global.placeholder=Ce(e));let a=!0;const l=n.subscribe((l=>(l=>{if(s)return void xe(n,l,r,e);je(l,n,e,r,{counts:{...o}},a?t:void 0),s=!0})(l)));a=!1,r.subject.global.subscriptions.push(l)}function ke(t,e,n,r,o,s){return t.forEach(((t,a)=>{const l=t.marker=Vt.cloneNode(!1),c=t.value;if(c)return s.appendChild(l),c.global.placeholder=l,void Se(s,l,c,n,o);if("text"===t.nodeName){const e=t.textContent,n=(new DOMParser).parseFromString(e,"text/html"),r=e.replace(/(^\s+)?.+/g,"$1")+n.documentElement.textContent;return s.appendChild(l),t.domElement=document.createTextNode(r),void s.appendChild(t.domElement)}const i=t.domElement=document.createElement(t.nodeName);s.appendChild(i),s.appendChild(l),t.attributes&&t.attributes.forEach((t=>{ie(t,i,0,n)})),t.children&&ke(t.children,e,n,r,o,i)})),t}class Te{templater;subject;isApp=!0;appElement;strings;dom;values;propsConfig;state=[];hasLiveElements=!1;constructor(t,e,n){this.templater=t,this.subject=e;const r=t.props;this.propsConfig=this.clonePropsBy(r,n)}clonePropsBy(t,e){const n=this.templater.children.value,r=t.map((t=>xt(t)));return this.propsConfig={latest:t,latestCloned:r,castProps:e,lastClonedKidValues:n.map((t=>Ct(t.values)))}}getHtmlDomMeta(t,e={counts:{added:0,removed:0}}){const n=this.templater.tag,r=this.update();let s;s=n.tagJsType===o.dom?n.dom:k(n.strings,n.values);const a=lt(s);return x(a,r),ke(a,r,this,t,e.counts,t),a}buildBeforeElement(t=document.createDocumentFragment(),e){const n=this.subject,r=this.subject.global;r.oldest=this,r.newest=this,n.support=this,this.hasLiveElements=!0;return Re(this.getHtmlDomMeta(t,e),this.subject.global.clones),t}updateBy(t){const e=t.templater.tag;this.updateConfig(e,e.values)}updateConfig(t,e){t.tagJsType===o.dom?this.dom=t.dom:this.strings=t.strings,this.updateValues(e)}updateValues(t){return this.values=t,this.updateContext(this.subject.global.context)}update(){return this.updateContext(this.subject.global.context)}updateContext(t){const e=this.templater.tag,n=this.values||e.values;return"x,".repeat(n.length).split(",").forEach(((e,r)=>function(t,e,n,r){const s=t.length>e;if(!s)return;const a=t[e],l=n.length>e;if(l){if(r.subject.global.deleted){const t=a&&a.support;if(t)return t.destroy(),n}return function(t,e,n){const r=t[e];V(n)||r.next(n)}(n,e,a)}n[e]=function(t,e){switch(jt(t)){case o.tagComponent:return new At(t);case o.templater:return Rt(t.tag,e);case o.tag:case o.dom:return Rt(t,e);case o.subject:return t.global=Et(),t}return new At(t)}(a,r)}(n,r,t,this))),t}destroy(t={stagger:0}){const e=this.subject.global,n=t.byParent?[]:St(this.subject.global.childTags);E(this.templater)&&(e.destroy$.next(),ht(this,this)),this.destroySubscriptions();for(let t=n.length-1;t>=0;--t){const e=n[t],r=e.subject.global;delete r.newest,r.deleted=!0,E(e.templater)&&ht(e,e),e.destroySubscriptions()}Ee(this);const{stagger:r,promises:o}=this.smartRemoveKids(t);return t.stagger=r,o.length?Promise.all(o).then((()=>t.stagger)):t.stagger}smartRemoveKids(t={stagger:0}){const e=t.stagger,n=[],r=this.subject.global.clones;this.subject.global.childTags.forEach((e=>{let o=e.subject.global.clones[0];if(void 0===o){const{stagger:r,promises:o}=e.smartRemoveKids(t);return t.stagger=t.stagger+r,n.push(...o),{promise:Promise.all(n),stagger:t.stagger}}let s=0;for(;o.parentNode&&s<5;){if(r.includes(o))return;o=o.parentNode,++s}const{stagger:a,promises:l}=e.smartRemoveKids(t);t.stagger=t.stagger+a,n.push(...l)}));const o=this.destroyClones({stagger:e}).promise;return this.subject.global.clones.length=0,this.subject.global.childTags.length=0,o&&n.unshift(o),{promises:n,stagger:t.stagger}}destroyClones(t={stagger:0}){const e=this.subject.global.clones.map((e=>this.checkCloneRemoval(e,t.stagger))).filter((t=>t));return e.length?{promise:Promise.all(e),stagger:t.stagger}:{stagger:t.stagger}}checkCloneRemoval(t,e){let n;const r=t;if(r.ondestroy&&(n=function(t,e){const n=t.ondestroy;if(!n)return;const r=n.tagFunction;if(!r)return;const o=r.tagFunction;if(!o)return;return o({target:t,stagger:e})}(r,e)),n instanceof Promise)return n.then((()=>{const e=t.parentNode;e&&e.removeChild(t)}));const o=t.parentNode;o&&o.removeChild(t);const s=this.ownerSupport;if(s){const e=s.subject.global.clones,n=e.indexOf(t);n>=0&&e.splice(n,1)}return n}destroySubscriptions(){const t=this.subject.global.subscriptions;for(let e=t.length-1;e>=0;--e)t[e].unsubscribe();t.length=0}}class Ae extends Te{templater;ownerSupport;subject;version;isApp=!1;constructor(t,e,n,r,o=0){super(t,n,r),this.templater=t,this.ownerSupport=e,this.subject=n,this.version=o}getAppSupport(){let t=this;for(;t.ownerSupport;)t=t.ownerSupport;return t}}function Ee(t){const e=t.subject.global;e.context=[],delete e.oldest,delete e.newest;delete t.subject.support}function Re(t,e){t.forEach((t=>{if(t.domElement&&e.push(t.domElement),e.push(t.marker),"children"in t){Re(t.children,e)}}))}function Ve(t,e={byParent:!1,stagger:0}){const n=t.subject.global;n.deleted=!0,n.context=[];const r=St(n.childTags);t.destroySubscriptions(),r.forEach((t=>{const e=t.subject.global;delete e.newest,e.deleted=!0})),t.smartRemoveKids(),t.subject.global.clones.length=0,t.subject.global.childTags.length=0,Ee(t),r.forEach((t=>Ve(t,{byParent:!0,stagger:0})))}function Pe(t,e,n,r){const s=e?.templater,a=s?.tag,l=mt(t,e,n,r);if(!e||dt(e,l)){if(e){const t=l.templater.tag;t&&function(t,e,n){if(t.tagJsType===o.dom){const r=n?.dom;return void(it(r,t.dom)||Ve(e))}if(n){if(n.tagJsType===o.dom)throw new Error("check here");const r=n.strings;if(r){const n=r?.length;n!==t.strings.length&&Ve(e)}}}(t,e,a)}}else!function(t,e,n){const r=e.subject.global;!function(t,e){const n=t.subject.global;n.providers.forEach((t=>{t.children.forEach(((r,o)=>{if(n.destroy$===r.subject.global.destroy$)return t.children.splice(o,1),void t.children.push(e)}))}))}(t,e),Ve(t),delete r.deleted,r.oldest=e,r.newest=e,n.support=e}(e,l,n);const c=e?.ownerSupport;return l.ownerSupport=r||c,l}function Ne(t,e){let n=!1;const r=function(t,e,n=[]){n.push({support:t,renderCount:t.subject.global.renderCount,provider:e});const r=e.children;for(let t=r.length-1;t>=0;--t)n.push({support:r[t],renderCount:r[t].subject.global.renderCount,provider:e});return n}(t,e);for(let t=r.length-1;t>=0;--t){const{support:e,renderCount:o,provider:s}=r[t];if(e.subject.global.deleted)continue;o===e.subject.global.renderCount&&(n=!0,s.clone=lt(s.instance),Fe(e.subject.global.newest,!1))}return n}function Oe(t,e,n,r){const o=r.support,s=r.global;e.subject.global=s;const a=s.renderCount;!function(t){const e=t.subject.global.providers.filter((t=>!it(t.instance,t.clone)));let n=!1;for(let t=e.length-1;t>=0;--t){const r=e[t];Ne(r.owner,r)&&(n=!0),r.clone=lt(r.instance)}}(t);const l=s.newest;if(a!==s.renderCount)return t.subject.global.oldest.updateBy(l),l;const c=Pe(e,l||o||s.oldest,r,n),i=s.oldest||t;return dt(l,c)&&(r.support=c,i.updateBy(c)),c}function Fe(t,e){const n=t.subject.global,r=t.templater;if(!r.wrapper){const e=t.ownerSupport;return++n.renderCount,e.subject.global.deleted?t:Fe(e.subject.global.newest,!0)}if(t.subject.global.locked)return t.subject.global.blocked.push(t),t;const o=t.subject,s=t.subject.global.oldest;let a,l=!1;if(e&&t&&(a=t.ownerSupport,a)){l=!it(r.props,t.propsConfig.latestCloned)}const c=Oe(s,t,a,o);if(a&&l){return Fe(a.subject.global.newest,!0),c}return c}function Be(t,e,n,...r){const o=t.state;q(o,n);const s=e(...r);return q(n,o),Fe(t,!1),s instanceof Promise&&s.finally((()=>{q(n,o),Fe(t,!1)})),s}let Je=t=>(t,e,n,r,o,s)=>{throw new H("Callback function was called immediately in sync and must instead be call async")};const _e=()=>Je,De=Je;I({beforeRender:t=>Me(t),beforeRedraw:t=>Me(t),afterRender:t=>{t.subject.global.callbackMaker=!0,Je=De}});const We=new H("callback() was called outside of synchronous rendering. Use `callback = callbackMaker()` to create a callback that could be called out of sync with rendering");function $e(t){const e=M();if(!e)throw We;const n=I.memory.stateConfig.array;return(...r)=>e.subject.global.callbackMaker?Be(e,t,n,...r):t(...r)}function Me(t){const e=I.memory.stateConfig.array;Je=n=>(...r)=>t.subject.global.callbackMaker?Be(t,n,e,...r):n(...r)}function Ie(t){Q(t)}function Ue(t){Q((()=>{const e=M();e?.subject.global.destroy$.toCallback(t)}))}function ze(t){I.memory.childrenCurrentSupport=t}function Ke(){return I.memory.childrenCurrentSupport.templater.children}I({beforeRender:t=>ze(t),beforeRedraw:t=>ze(t)});const He=[];function Le(t,...e){return new u(t,e)}function Ze(t,e){const n=I.memory.stateConfig.array;return(r,s,a)=>function(t,e,n,r,s,a){const l=r.subject.global;++l.renderCount;const c=e.children,i=l.oldest?.templater.children.lastArray;i&&(c.lastArray=i);const u=n.original;let p=e.props,d=r.propsConfig.castProps;const f=a?.propsConfig.castProps;f&&(r.propsConfig.castProps=f,d=qt(r,a,a.ownerSupport,p));const g=d||Ht(p,r,t,0);let b=u(...g);b instanceof Function&&(b=b());const h=!b||b.tagJsType&&![o.tag,o.dom].includes(b.tagJsType);h&&(b=Le`${b}`);b.templater=e,e.tag=b,b.arrayValue=e.arrayValue;const m=new Ae(e,r.ownerSupport,s,g,l.renderCount);m.subject.global=l,l.oldest=l.oldest||m;const y=I.memory.stateConfig.array;if(m.state.push(...y),e.madeChildIntoSubject){const t=c.value;for(let e=t.length-1;e>=0;--e){const n=t[e],r=n.values;for(let t=r.length-1;t>=0;--t){const e=r[t];if(!(e instanceof Function))continue;const o=n.values[t];o.isChildOverride||(n.values[t]=function(...t){return ne(e,m.ownerSupport,this,t,m.state)},o.isChildOverride=!0)}}}return m}(n,t,e,r,s,a)}Le.dom=function(t,...e){return new p(t,e)};let Ye=0;function Ge(t){const e=function(...t){const n=new Tt(t);n.tagJsType=o.tagComponent;const r=Ze(n,e);return r.parentWrap||(r.parentWrap=e),n.tagged=!0,n.wrapper=r,n};e.original=t,e.compareTo=t.toString();const n=t;return e.isTag=!0,e.original=n,n.tags=He,n.setUse=I,n.tagIndex=Ye++,He.push(e),e}Ge.oneRender=(...t)=>{throw new Error("Do not call function tag.oneRender but instead set it as: `(props) => tag.oneRender = (state) => html`` `")},Ge.route=t=>{throw new Error("Do not call function tag.route but instead set it as: `tag.route = (routeProps: RouteProps) => (state) => html`` `")},Ge.app=t=>{throw new Error("Do not call function tag.route but instead set it as: `tag.route = (routeProps: RouteProps) => (state) => html`` `")},Object.defineProperty(Ge,"oneRender",{set(t){t.oneRender=!0}});const qe=[];function Qe(t,e,n){const r=qe.findIndex((t=>t.element===e));r>=0&&(qe[r].support.destroy(),qe.splice(r,1),console.warn("Found and destroyed app element already rendered to element",{element:e}));const o=t(n),s=document.createElement("template"),a=Vt.cloneNode(!1),l=function(t,e,n){let r={};const o=new At(r);r=new Te(t,o),o.global.insertBefore=e,o.global.placeholder=n,o.global.oldest=o.global.oldest||r,o.next(t),o.support=r,gt(r,void 0);const s=t.wrapper,a=s(r,o);return bt(r,a),a}(o,s,a),c=l.subject.global;l.appElement=e,l.isApp=!0,c.isApp=!0,e.destroy=()=>{l.destroy()},c.insertBefore=a,c.placeholder=a;const i=l.buildBeforeElement(void 0),u=[...i.children];return l.subject.global.oldest=l,l.subject.global.newest=l,e.setUse=t.original.setUse,qe.push({element:e,support:l}),e.appendChild(i),zt(u,l.subject,l),{support:l,tags:t.original.tags}}const Xe={tagElement:Qe,renderWithSupport:Pe,renderSupport:Fe,renderTagOnly:mt};var tn=e.W9,en=e.jo,nn=e.ew,rn=e.Jf,on=e.Y2,sn=e.ei,an=e.B7,ln=e.EF,cn=e.XF,un=e.vw,pn=e.PC,dn=e.O9,fn=e.Ot,gn=e.tD,bn=e.E2,hn=e.OH,mn=e.Y_,yn=e.zV,vn=e.WJ,wn=e.Ie,jn=e.wY,Cn=e.eZ,xn=e.Az,Sn=e.AZ,kn=e.cF,Tn=e.qy,An=e.O5,En=e.Ze,Rn=e._4,Vn=e.iO,Pn=e.dk,Nn=e.mn,On=e.NM,Fn=e.z,Bn=e.bc,Jn=e.sA,_n=e.MG,Dn=e.PL,Wn=e.r5,$n=e.uc,Mn=e.pG,In=e.QB,Un=e.Vz,zn=e.vJ,Kn=e.AI,Hn=e.wk,Ln=e.uz,Zn=e.Tc,Yn=e.Hf,Gn=e._A,qn=e.NU,Qn=e.Ah,Xn=e.wB,tr=e.id,er=e.MC,nr=e.zC;export{tn as ArrayNoKeyError,en as BaseSupport,nn as BaseTag,rn as Dom,on as RouteQuery,sn as StateMismatchError,an as Subject,ln as Support,cn as SyncCallbackError,un as Tag,pn as TagError,dn as TemplaterResult,fn as ValueSubject,gn as ValueTypes,bn as callback,hn as callbackMaker,mn as children,yn as combineLatest,vn as defineValueOn,wn as empty,jn as escapeSearch,Cn as escapeVariable,xn as getDomMeta,Sn as getValueType,kn as hmr,Tn as html,An as isLikeValueSets,En as isStaticTag,Rn as isSubjectInstance,Vn as isTagArray,Pn as isTagClass,Nn as isTagComponent,On as isTagTemplater,Fn as letProp,Bn as letState,Jn as onDestroy,_n as onInit,Dn as oneRenderToSupport,Wn as providers,$n as renderSupport,Mn as renderTagOnly,In as renderWithSupport,Un as resetSupport,zn as runBeforeRender,Kn as setUse,Hn as state,Ln as subject,Zn as tag,Yn as tagElement,Gn as tags,qn as variablePrefix,Qn as variableSuffix,Xn as watch,tr as willCallback,er as willPromise,nr as willSubscribe};
//# sourceMappingURL=bundle.js.map