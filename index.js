var t={d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};function r(t,e,r,n){return e.renderWithSupport(t,r,n)}function n(t){const e={beforeRender:t.beforeRender||(()=>{}),beforeRedraw:t.beforeRedraw||(()=>{}),afterRender:t.afterRender||(()=>{}),beforeDestroy:t.beforeDestroy||(()=>{})};n.tagUse.push(e)}function o(t,e){n.tagUse.forEach((r=>r.beforeRender(t,e)))}function a(t,e){n.tagUse.forEach((r=>r.afterRender(t,e)))}function s(t,e){n.tagUse.forEach((r=>r.beforeRedraw(t,e)))}function i(t){return u(t,new WeakMap)}function u(t,e){if(null===t||"object"!=typeof t)return t;if(e.has(t))return e.get(t);if(t instanceof Date)return new Date(t);if(t instanceof RegExp)return new RegExp(t);const r=Array.isArray(t)?[]:Object.create(Object.getPrototypeOf(t));if(e.set(t,r),Array.isArray(t))for(let n=0;n<t.length;n++)r[n]=u(t[n],e);else for(const n in t)t.hasOwnProperty(n)&&(r[n]=u(t[n],e));return r}function c(t,e){return l(t,e,new WeakMap)}function l(t,e,r){if(t===e||(o=e,(n=t)instanceof Function&&o instanceof Function&&n.toString()===o.toString()))return!0;var n,o;if("object"!=typeof t||"object"!=typeof e||null===t||null===e)return!1;const a=Object.keys(t),s=Object.keys(e);if(a.length!==s.length)return!1;if(r.has(t))return!0;r.set(t,0);for(const n of a)if(!s.includes(n)||!l(t[n],e[n],r))return!1;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!l(t[n],e[n],r))return!1}else if(Array.isArray(t)||Array.isArray(e))return!1;return!0}function p(t){t.tagSupport.memory.providers.filter((t=>!c(t.instance,t.clone))).forEach((e=>{!function(t,e){g(t,e).forEach((({tag:t,renderCount:e,provider:r})=>{e===t.tagSupport.memory.renderCount&&(r.clone=i(r.instance),t.tagSupport.render())}))}(t.getAppElement(),e),e.clone=i(e.instance)}))}function g(t,e,r=[]){const n=t.tagSupport.memory.providers.find((t=>t.constructMethod===e.constructMethod));return n&&r.push({tag:t,renderCount:t.tagSupport.memory.renderCount,provider:n}),t.children.forEach((t=>g(t,e,r))),r}t.d(e,{W9:()=>z,ei:()=>X,B7:()=>E,vw:()=>yt,PC:()=>K,uX:()=>v,Ot:()=>x,eQ:()=>zt,cF:()=>Yt,qy:()=>wt,xH:()=>Pt,u2:()=>it,zl:()=>ct,_4:()=>y,iO:()=>w,mn:()=>m,Yn:()=>h,Ly:()=>_t,sA:()=>Kt,MG:()=>Jt,r5:()=>Ut,iz:()=>r,vJ:()=>o,hZ:()=>Et,Un:()=>At,Ie:()=>Wt,AI:()=>n,Tc:()=>O,Hf:()=>f,TY:()=>Mt,_A:()=>F,wB:()=>Rt}),n.tagUse=[],n.memory={};const d=[];function f(t,e,r){const n=d.findIndex((t=>t.element===e));n>=0&&(d[n].tag.destroy(),d.splice(n,1),console.warn("Found and destroyed app element already rendered to element",{element:e}));const i=function(t){const e=t.tagSupport;o(e,void 0);const r=t.wrapper();return a(e,r),{tag:r,tagSupport:e}}(t(r)),{tag:u,tagSupport:c}=i;u.appElement=e,u.tagSupport.oldest=u,function(t,e){let r=e;t.mutatingRender=()=>{const n=t.memory.renderCount;if(p(e),n!==t.memory.renderCount)return r;s(e.tagSupport,e);const o=t.templater,i=r=o.wrapper();return i.tagSupport.memory=t.memory,t.propsConfig={...i.tagSupport.propsConfig},e.tagSupport.newest=i,a(e.tagSupport,e),t.oldest.updateByTag(i),t.newest=i,r}}(u.tagSupport,u);const l=document.createElement("template");return l.setAttribute("tag-detail","app-template-placeholder"),e.appendChild(l),u.buildBeforeElement(l),e.setUse=t.original.setUse,d.push({element:e,tag:u}),{tag:u,tags:t.original.tags}}function m(t){return!0===t?.isTemplater}function h(t){return!0===t?.isTag}function y(t){return!(!0!==t?.isSubject&&!t?.subscribe)}function w(t){return t instanceof Array&&t.every((t=>h(t)))}function b(t,e){if(t===e)throw new Error("someting here");const r=t.propsConfig.latest;if(function(t,e,r){if(void 0===t&&t===r)return!1;let n=t,o=e;if("object"==typeof t){if(!e)return!0;if(n={...t},o={...e||{}},!Object.entries(n).every((([t,e])=>{let r=o[t];return!(e instanceof Function)||r instanceof Function&&(r.original&&(r=r.original),e.original&&(e=e.original),e.toString()===r.toString()&&(delete n[t],delete o[t],!0))})))return!0}return!c(e,t)}(e.propsConfig.latest,t.propsConfig.latestCloned,r))return!0;const n=function(t,e){const r=t.propsConfig.lastClonedKidValues,n=e.propsConfig.lastClonedKidValues,o=r.every(((t,e)=>{const r=n[e];return t.every(((t,e)=>t===r[e]))}));return!o}(t,e);return n}class v{templater;children;propsConfig;memory={context:{},state:{newest:[]},providers:[],renderCount:0};constructor(t,e,r){this.templater=t,this.children=e;const n=T(r,t);this.propsConfig={latest:r,latestCloned:n,clonedProps:n,lastClonedKidValues:e.value.map((t=>S(t.values)))},h(r)||(this.propsConfig.latestCloned=i(n),this.propsConfig.clonedProps=this.propsConfig.latestCloned)}oldest;newest;mutatingRender(){const t='Tag function "render()" was called in sync but can only be called async';throw console.error(t,{tagSupport:this}),new Error(t)}render(){return++this.memory.renderCount,this.mutatingRender()}renderExistingTag(t,e){const r=this.memory.renderCount;if(p(t),r!==this.memory.renderCount)return!0;const n=b(t.tagSupport,e.tagSupport);return this.newest=this.templater.redraw(),!n}}function S(t){return t.map((t=>{const e=t;return h(e)?S(e.values):m(e)?i(e.tagSupport.propsConfig.latestCloned):w(e)?S(e):i(t)}))}class C{tagged;wrapper;newest;oldest;tagSupport;constructor(t,e){this.tagSupport=new v(this,e,t)}redraw;isTemplater=!0;forceRenderTemplate(t,e){const r=this.wrapper();return a(t,r),this.oldest=r,t.oldest=r,this.oldest=r,this.newest=r,r.ownerTag=e,r}renderWithSupport(t,e,r){++t.memory.renderCount;const i=e?.ownerTag||r;e?(t.propsConfig={...e.tagSupport.propsConfig},s(t,e)):(o(t,i),n.memory.providerConfig.ownerTag=i);const u=this,c=u.wrapper();a(t,c),u.newest=c,c.ownerTag=i;const l=t.oldest=t.oldest||c;return t.newest=c,l.tagSupport.templater=u,l.tagSupport.memory=c.tagSupport.memory,e&&e.isLikeTag(c)?(e.updateByTag(c),{remit:!1,retag:c}):{remit:!0,retag:c}}}function T(t,e){const r=function(t,e){if("object"!=typeof t)return t;const r=t;return Object.entries(r).forEach((([t,n])=>{if(n instanceof Function){const o=r[t].original;return o?(r[t]=(...t)=>e(n,t),void(r[t].original=o)):(r[t]=(...t)=>e(n,t),void(r[t].original=n))}})),r}(h(t)?0:t,(function(t,r){const n=t(...r),o=e.newest?.ownerTag?.tagSupport;return o&&o.render(),n}));return r}class E{isSubject=!0;subscribers=[];value;subscribe(t){this.subscribers.push(t),R.globalSubs.push(t),R.globalSubCount$.set(R.globalSubCount$.value+1);const e=()=>{e.unsubscribe()};return e.unsubscribe=()=>{A(this.subscribers,t),A(R.globalSubs,t),R.globalSubCount$.set(R.globalSubCount$.value-1),e.unsubscribe=()=>{}},e}set(t){this.value=t,this.subscribers.forEach((e=>{e.value=t,e(t)}))}next=this.set}function A(t,e){const r=t.indexOf(e);-1!==r&&t.splice(r,1)}const R=E;R.globalSubs=[],R.globalSubCount$=new E,R.globalSubCount$.set(0);class x extends E{value;constructor(t){super(),this.value=t}subscribe(t){const e=super.subscribe(t);return t(this.value),e}}function V(t,e){if(t.isChildOverride)return t;const r=(r,n)=>j(t,e,r,n);return r.tagFunction=t,r}function j(t,e,r,n){const o=e.tagSupport,a=(o&&o.memory.renderCount,t.bind(r)(...n));return o.memory.renderCount,o.render(),a instanceof Promise?a.then((()=>(o.render(),"no-data-ever"))):"no-data-ever"}let k=0;const F=[];function O(t){const e=function(e,r){(h(e)||w(e))&&(r=e,e=void 0);const{childSubject:n,madeSubject:o}=function(t){if(y(t))return{childSubject:t,madeSubject:!1};if(w(t))return{childSubject:new x(t),madeSubject:!0};const e=t;return e?(e.arrayValue=0,{childSubject:new x([e]),madeSubject:!0}):{childSubject:new x([]),madeSubject:!0}}(r);n.isChildSubject=!0;const a=new C(e,n);function s(){const t=s.original,e=a.tagSupport,r=a.oldest;let u=e.propsConfig.latest,c=T(u,a);const l=t(c,n);e.mutatingRender===v.prototype.mutatingRender&&(e.oldest=l,e.mutatingRender=()=>{if(e.renderExistingTag(l,a))return l;if(l.ownerTag){const t=l.ownerTag.tagSupport.render();return l.ownerTag.tagSupport.newest=t,l}return l}),l.tagSupport=new v(a,e.children);const p=i(c);return l.tagSupport.propsConfig={latest:u,latestCloned:p,clonedProps:p,lastClonedKidValues:l.tagSupport.propsConfig.lastClonedKidValues},l.tagSupport.memory=e.memory,l.tagSupport.mutatingRender=e.mutatingRender,e.newest=l,e.propsConfig={...l.tagSupport.propsConfig},r&&(r.tagSupport.propsConfig={...l.tagSupport.propsConfig}),o&&n.value.forEach((t=>{t.values.forEach(((e,r)=>{e instanceof Function&&(t.values[r].isChildOverride||(t.values[r]=function(...t){j(e,l.ownerTag,this,t)},t.values[r].isChildOverride=!0))}))})),l}return s.original=t,a.tagged=!0,a.wrapper=s,a};return function(t,e){t.isTag=!0,t.original=e}(e,t),function(t){t.tags=F,t.setUse=n,t.tagIndex=++k}(t),F.push(t),e}function B(t,e){e.parentNode.insertBefore(t,e)}function P(t,e,r){const n=t.split(".");if("style"===n[0]&&(r.style[n[1]]=e),"class"===n[0])return n.shift(),void(e?n.forEach((t=>r.classList.add(t))):n.forEach((t=>r.classList.remove(t))))}function N(t,e,r){const n=t.getAttributeNames();"TEXTAREA"!==t.nodeName||n.includes("value")||$("textVarValue",t.getAttribute("textVarValue"),t,e,r,((e,r)=>t.value=r));const o=(e,r)=>{t.setAttribute(e,r)};n.forEach((n=>{$(n,t.getAttribute(n),t,e,r,o)}))}function _(t){return t.search(/^(class|style)(\.)/)>=0}function $(t,e,r,n,o,a){if(U(e))return function(t,e,r,n,o,a){return W(t,I(n,e),r,o,a)}(t,e,r,n,o,a);if(U(t)){let e;const s=I(n,t).subscribe((t=>{!function(t,e,r,n,o){if(e&&e!=t&&("string"==typeof e?r.removeAttribute(e):e instanceof Object&&Object.entries(e).forEach((([t])=>r.removeAttribute(t)))),"string"!=typeof t)t instanceof Object&&Object.entries(t).forEach((([t,e])=>W(t,e,r,n,o)));else{if(!t.length)return;W(t,"",r,n,o)}}(t,e,r,o,a),e=t}));return o.cloneSubs.push(s),void r.removeAttribute(t)}return _(t)?P(t,e,r):void 0}new class{};const M=/^\s*{__tagvar/,L=/}\s*$/;function U(t){return t&&t.search(M)>=0&&t.search(L)>=0}function I(t,e){return t[e.replace("{","").split("").reverse().join("").replace("}","").split("").reverse().join("")]}function W(t,e,r,n,o){const a=_(t);if(e instanceof Function){const n=function(...t){return e(r,t)};r[t].action=n}if(y(e)){r.removeAttribute(t);const s=e=>function(t,e,r,n,o){if(t instanceof Function)return e[r]=function(...r){return t(e,r)},void(e[r].tagFunction=t);if(n)return void P(r,t,e);if(t)return void o(r,t);void 0===t||!1===t||null===t?e.removeAttribute(r):o(r,t)}(e,r,t,a,o),i=e.subscribe(s);n.cloneSubs.push(i)}else o(t,e)}const D=/(?:<[^>]*?(?:(?:\s+\w+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^>\s]+)))*\s*)\/?>)|({__tagvar[^}]+})/g;function J(t,e,r,{counts:n,forceElement:o}){const a=e,s=a.tag;if(s&&!o&&s.isLikeTag(t)){if(e instanceof Function){const t=e(s.tagSupport);return s.updateByTag(t),[]}return s.updateByTag(t),[]}const i=t.buildBeforeElement(r,{counts:n,forceElement:o});return a.tag=t,i}function H(t,e,r,a,i){if(!0!==t.tagged){let e=t.wrapper.original.name||t.wrapper.original.constructor?.name;"Function"===e&&(e=void 0);const r=e||t.wrapper.original.toString().substring(0,120);throw new Error(`Not a tag component. Wrap your function with tag(). Example tag(props => html\`\`) on component:\n\n${r}\n\n`)}const u=t,c=t.tagSupport;let l=u.newest;return n.memory.providerConfig.ownerTag=a,(!l||i.forceElement)&&(l?s(c,l):o(c,a),l=u.forceRenderTemplate(c,a),u.newest=l),a.children.push(l),c.templater=l.tagSupport.templater,J(l,e,r,i)}class K extends Error{details;constructor(t,e,r={}){super(t),this.name=K.name,this.details={...r,errorCode:e}}}class z extends K{constructor(t,e){super(t,"array-no-key-error",e),this.name=z.name}}class X extends K{constructor(t,e){super(t,"state-mismatch-error",e),this.name=X.name}}function G(t,e,r,n,o){const a=[];t.lastArray=t.lastArray||[],t.template=r;let s=0;t.lastArray=t.lastArray.filter(((r,n)=>{const a=e.length-1<n-s,i=e[n-s],u=i?.arrayValue;return!(a||!Y(u,r.tag.arrayValue))||(t.lastArray[n].tag.destroy({stagger:o.counts.removed,byParent:!1}),++s,++o.counts.removed,!1)}));const i=r||r.clone;return e.forEach(((r,s)=>{const u=t.lastArray[s],c=r.tagSupport||u?.tag.tagSupport;r.tagSupport=c||new v({},new x([])),c?c.newest=r:(r.tagSupport.mutatingRender=()=>(n.tagSupport.render(),r),n.children.push(r)),r.ownerTag=n;const l=r.arrayValue;if(l?.isArrayValueNeverSet){const t={template:r.getTemplate().string,array:e,ownerTagContent:n.lastTemplateString},o="Use html`...`.key(item) instead of html`...` to template an Array";throw console.error(o,t),new z(o,t)}if(t.lastArray.length>s)return Y(u.tag.arrayValue,r.arrayValue)?(r.tagSupport=r.tagSupport||u.tag.tagSupport,u.tag.updateByTag(r),[]):[];const p=function(t,e,r,n,o){r.lastArray.push({tag:e,index:n});const a={added:o.counts.added+n,removed:o.counts.removed},s=t;return e.buildBeforeElement(s,{counts:a,forceElement:o.forceElement})}(i,r,t,s,o);a.push(...p)})),a}function Y(t,e){return t===e||!!(t instanceof Array&&e instanceof Array&&t.length==e.length)&&t.every(((t,r)=>t==e[r]))}function q(t,e,r,n){const o=e.clone||r,a=rt(t,o);e.clone=a;const s=[],i=n.clones.indexOf(o);return i>=0&&!n.clones.includes(a)&&!o.parentNode&&(n.clones.splice(i,1),n.clones.push(a),s.push(a)),s}var Z;function Q(t,e,r,n,o){return t.tagSupport||(t.tagSupport=new v({},new x([])),t.tagSupport.mutatingRender=()=>{n.tagSupport.render()},t.tagSupport.oldest=t.tagSupport.oldest||t,n.children.push(t),t.ownerTag=n),e.template=r,J(t,e,r,o)}function tt(t,e,r,n){const o=e.tag,a=e.clone||r;a.parentNode.insertBefore(r,a);const s=rt(t,a);e.clone=s,delete e.tag;const i=n.counts.removed;return o.destroy({stagger:i}).then((t=>n.counts.removed=i+t))}function et(t,e,r,n,o){const a=[];if(!t.hasAttribute("end"))return a;const s=t.getAttribute("id");if(s?.substring(0,gt.length)!==gt)return a;const i=e[s];let u=o.forceElement;const c=i.subscribe((e=>{const{clones:o}=function(t,e,r,n,o){const a=function(t){return m(t)?Z.tagComponent:h(t)?Z.tag:w(t)?Z.tagArray:Z.value}(t),s=e,i=s.clone;if(a!==Z.value&&i){const t=i.parentNode;t.insertBefore(r,i),t.removeChild(i),delete s.clone}switch(a){case Z.tag:return{clones:Q(t,e,r,n,o)};case Z.tagArray:return{clones:G(e,t,r,n,o)};case Z.tagComponent:return{clones:H(t,e,r,n,o)}}return e.tag?{clones:[],promise:tt(t,e,r,o)}:{clones:q(t,e,r,n)}}(e,i,t,r,{counts:{added:n.added,removed:n.removed},forceElement:u});u&&(u=!1),o.push(...o)}));return r.cloneSubs.push(c),a}function rt(t,e){const r=e.parentNode;void 0!==t&&!1!==t&&null!==t||(t="");const n=document.createTextNode(t);return r.insertBefore(n,e),r.removeChild(e),n}function nt(t,e){if(!t.getAttribute)return;let r=e.counts.added;e.forceElement||(r=function(t,e){const r=t.oninit;if(!r)return e.added;const n=r.tagFunction;if(!n)return e.added;const o=n.tagFunction;return o?(o({target:t,stagger:e.added}),++e.added):e.added}(t,e.counts)-r),t.children&&(e.counts.added,e.counts.removed,new Array(...t.children).forEach(((t,r)=>nt(t,{...e,counts:e.counts}))))}!function(t){t.tag="tag",t.tagArray="tag-array",t.tagComponent="tag-component",t.value="value"}(Z||(Z={}));const ot=new RegExp('\\s*<template interpolate end id="__tagvar(\\d{1,4})"([^>]*)></template>(\\s*)');function at(t,e,r,n,o){if(!o||"TEMPLATE"===t.tagName)return[];const a=n.counts,s=[],i=new Array(...o);return"TEXTAREA"===t.tagName&&st(t),i.forEach(((t,o)=>{const i=et(t,e,r,a,n);"TEXTAREA"===t.tagName&&st(t),s.push(...i),t.children&&new Array(...t.children).forEach(((t,o)=>{(function(t){return"TEMPLATE"===t.tagName&&void 0!==t.getAttribute("interpolate")&&void 0!==t.getAttribute("end")})(t)&&et(t,e,r,a,n);const i=at(t,e,r,n,t.children);s.push(...i)}))})),s}function st(t){const e=t.value;if(e.search(ot)>=0){const r=e.match(/__tagvar(\d{1,4})/),n="{"+(r?r[0]:"")+"}";t.value="",t.setAttribute("textVarValue",n)}}function it(t,e,r,n,o){const a=[],s=r.interpolation,i=t.children[0].content.children;if(s.keys.length){const r=at(t,e,n,o,i);a.push(...r)}return N(t,e,n),ut(i,e,n),a}function ut(t,e,r){new Array(...t).forEach((t=>{N(t,e,r),t.children&&ut(t.children,e,r)}))}function ct(t){const e=function(t){const e=[];return{string:t.replace(D,((t,r)=>{if(t.startsWith("<"))return t;const n=r.substring(1,r.length-1);return e.push(n),`<template interpolate end id="${n}"></template>`})),keys:e}}(t);return e.string=e.string.replace(mt,gt),e}function lt(t,e,n){t.redraw=()=>{const o=e.tag,a=t.tagSupport.newest,s=o?.tagSupport||t.tagSupport,{remit:i,retag:u}=r(s,t,a,n);if(i)return e.set(t),u}}function pt(t,e){delete e.tag,delete e.tagSupport,t.destroy()}const gt="__tagvar",dt="--"+gt+"--",ft=new RegExp(gt,"g"),mt=new RegExp(dt,"g");class ht{isArrayValueNeverSet=!0}class yt{strings;values;isTag=!0;clones=[];cloneSubs=[];children=[];tagSupport;ownerTag;insertBefore;appElement;arrayValue=new ht;constructor(t,e){this.strings=t,this.values=e}key(t){return this.arrayValue=t,this}async destroy(t={stagger:0,byParent:!1}){!!this.tagSupport&&function(t,e){n.tagUse.forEach((r=>r.beforeDestroy(t,e)))}(this.tagSupport,this),this.destroySubscriptions();const e=this.children.map((e=>e.destroy({...t,byParent:!0})));return this.ownerTag&&(this.ownerTag.children=this.ownerTag.children.filter((t=>t!==this))),t.byParent||(t.stagger=await this.destroyClones(t)),await Promise.all(e),t.stagger}destroySubscriptions(){this.cloneSubs.forEach((t=>t.unsubscribe())),this.cloneSubs.length=0}async destroyClones({stagger:t}={stagger:0}){let e=!1;const r=this.clones.reverse().map(((r,n)=>{let o;r.ondestroy&&(o=function(t,e){const r=t.ondestroy;if(!r)return;const n=r.tagFunction;if(!n)return;const o=n.tagFunction;return o?o({target:t,stagger:e}):void 0}(r,t));const a=()=>{r.parentNode?.removeChild(r);const t=this.ownerTag;t&&(t.clones=t.clones.filter((t=>t!==r)))};return o instanceof Promise?(e=!0,o.then(a)):a(),o}));return e&&await Promise.all(r),t}updateByTag(t){this.updateConfig(t.strings,t.values),this.tagSupport.templater=t.tagSupport.templater,this.tagSupport.propsConfig={...t.tagSupport.propsConfig},this.tagSupport.newest=t}lastTemplateString=void 0;updateConfig(t,e){this.strings=t,this.updateValues(e)}getTemplate(){const t=ct(this.strings.map(((t,e)=>(t.replace(ft,dt)+(this.values.length>e?`{${gt}${e}}`:"")).replace(/>\s*/g,">").replace(/\s*</g,"<"))).join(""));return this.lastTemplateString=t.string,{interpolation:t,string:t.string,strings:this.strings,values:this.values,context:this.tagSupport?.memory.context||{}}}isLikeTag(t){const{string:e}=t.getTemplate();if(!this.lastTemplateString)throw new Error("no template here");return e===this.lastTemplateString&&t.values.length===this.values.length&&!!t.values.every(((t,e)=>{const r=this.values[e];return!(t instanceof Function&&r instanceof Function)||!(t.toString()!==r.toString())}))}update(){return this.updateContext(this.tagSupport.memory.context)}updateValues(t){return this.values=t,this.updateContext(this.tagSupport.memory.context)}updateContext(t){return this.strings.map(((e,r)=>{const n=gt+r,o=this.values.length>r,u=this.values[r];if(n in t)return function(t,e,r){const n=t.value,o=e,u=t,c=t;if(u.lastArray){if(u.isChildSubject&&(e=e.value),w(e))return void G(t,e,u.template,r,{counts:{added:0,removed:0}});t.lastArray.forEach((({tag:t})=>t.destroy())),delete t.lastArray}if(m(o))return function(t,e,r,n){let o=r.tag;if(!o)return lt(e,r,t),void e.redraw();const a=o.tagSupport.templater.wrapper,s=e.wrapper;let u=!1;a&&s&&(u=a.original===s.original);const c=e.tagSupport.propsConfig.latest,l=o.tagSupport;if(l.propsConfig.latest=c,u){const t=n?.tagSupport;let r=t.props;if(h(t.props)||(r=i(t.props)),o&&!b(l,e.tagSupport))return}else pt(o,r);lt(e,r,t),l.templater=e;const p=e.redraw();r.value.tag=l.newest=p,l.propsConfig={...e.tagSupport.propsConfig},u||(r.tag=p,r.tagSupport=e.tagSupport)}(r,o,c,n);const l=c.tag;if(l){w(e)&&(pt(l,c),delete c.tag);const n=l.tagSupport.templater.wrapper,i=e?.wrapper,u=n&&i&&n?.original===i?.original,p=e&&l.lastTemplateString===e.lastTemplateString,g=e&&e.getTemplate&&l.isLikeTag(e);if(p||g)return void Q(e,t,t.template,r,{counts:{added:0,removed:0}});if(u)return function(t,e,r){const n=e.tagSupport,o=n.oldest,i=n.newest;s(o.tagSupport,i||o);const u=t.wrapper();t.newest=u,n.newest=u,a(o.tagSupport,o),e.updateByTag(u),r.set(t)}(e,l,c);if(c.tag){pt(l,c);const n=l.insertBefore;return h(o)?void Q(e,t,n,r,{counts:{added:0,removed:0}}):void q(e,t,n,r)}throw new Error("existing value ignored")}e instanceof Function?c.set(V(e,r)):y(e)?c.set(e.value):c.set(e)}(t[n],u,this);!function(t,e,r,n,o){if(m(e))lt(e,r[n]=new x(e),o);else if(e instanceof Function)r[n]=function(t,e){return new x(V(t,e))}(e,o);else if(t)h(e)?(e.ownerTag=o,o.children.push(e),r[n]=new x(e)):y(e)?r[n]=e:r[n]=new x(e)}(o,u,t,n,this)})),t}getAppElement(){let t=this;for(;t.ownerTag;)t=t.ownerTag;return t}rebuild(){const t=this.insertBefore;if(!t){const t=new Error("Cannot rebuild. Previous insertBefore element is not defined on tag");throw t.tag=this,t}this.buildBeforeElement(t,{forceElement:!0,counts:{added:0,removed:0}})}buildBeforeElement(t,e={forceElement:!1,counts:{added:0,removed:0}}){this.insertBefore=t;const r=this.update(),n=this.getTemplate(),o=document.createElement("div");o.id="tag-temp-holder",o.innerHTML=`<template tag-wrap="22">${n.string}</template>`;const a=it(o,r,n,this,{forceElement:e.forceElement,counts:e.counts});this.clones.length=0;const s=function(t,e){const r=[];let n=t.children[0].content.firstChild;for(;n;){const t=n.nextSibling;B(n,e),r.push(n),n=t}return r}(o,t);return this.clones.push(...s),a.length&&(this.clones=this.clones.filter((t=>!a.find((e=>e===t))))),this.clones.forEach((t=>nt(t,e))),this.clones}}function wt(t,...e){return new yt(t,e)}function bt(t,e){return r=>(e.callback=r||(e=>[t,t=e]),t)}n.memory.stateConfig={array:[],rearray:[]};const vt=[];function St(t){const e=t.callback;if(!e)return t.defaultValue;const r=e(Ct),[n]=r,[o]=e(n);if(o!==Ct){const a='State property not used correctly. Second item in array is not setting value as expected.\n\nFor "let" state use `let name = state(default)(x => [name, name = x])`\n\nFor "const" state use `const name = state(default)()`\n\nProblem state:\n'+(e?e.toString():JSON.stringify(t))+"\n";throw console.error(a,{state:t,callback:e,oldState:r,oldValue:n,checkValue:o}),new Error(a)}return n}n({beforeRender:t=>Tt(t),beforeRedraw:t=>Tt(t),afterRender:t=>{const e=t.memory.state,r=n.memory.stateConfig;if(r.rearray.length&&r.rearray.length!==r.array.length){const e=`States lengths mismatched ${r.rearray.length} !== ${r.array.length}`;throw new X(e,{oldStates:r.array,newStates:r.rearray,component:t.templater?.wrapper.original})}r.rearray=[],e.newest=[...r.array],r.array=[],vt.forEach((t=>t())),vt.length=0}});class Ct{}function Tt(t){const e=t.memory.state,r=n.memory.stateConfig;if(r.rearray.length){const n="last array not cleared";throw console.error(n,{config:r,component:t.templater?.wrapper.original,state:e,expectedClearArray:r.rearray}),new X(n,{config:r,component:t.templater?.wrapper.original,state:e,expectedClearArray:r.rearray})}r.rearray=[],e?.newest.length&&r.rearray.push(...e.newest)}function Et(t){const e=n.memory.stateConfig;let r;const o=e.rearray[e.array.length];if(o){let t=St(o);r=e=>[t,t=e];const n={callback:r,lastValue:t,defaultValue:o.defaultValue};return e.array.push(n),t}let a=(t instanceof Function?t:()=>t)();r=t=>[a,a=t];const s={callback:r,lastValue:a,defaultValue:a};return e.array.push(s),a}function At(t){const e=n.memory.stateConfig;let r;const o=e.rearray[e.array.length];if(o){let t=St(o);r=e=>[t,t=e];const n={callback:r,lastValue:t,defaultValue:o.defaultValue};return e.array.push(n),bt(t,n)}let a=(t instanceof Function?t:()=>t)();r=t=>[a,a=t];const s={callback:r,lastValue:a,defaultValue:a};return e.array.push(s),bt(a,s)}function Rt(t,e){let r=At(void 0)((t=>[r,r=t]));return void 0===r?(e(t,r),r=t,t):(t.every(((t,e)=>t===r[e]))||(e(t,r),r=t),t)}const xt={},Vt={};function jt(t){const{id:e,observer:r,tag:n}=t;r.disconnect(),n.destroy(),delete xt[e]}function kt(t){return"__tagTemplate_"+function(t){let e=t.toString().replace(/\s+/g,"_").replace(/[^\w\d]/g,"_");return/^[a-zA-Z]/.test(e)||(e="fn_"+e),e}(t)}function Ft(t){const e=t.getAttribute("props");if(!e)return{element:t};try{const r=JSON.parse(e),n=t.getAttribute("events");n&&n.split(",").map((t=>t.trim())).map((t=>{r[t]=e=>o(t,{detail:{[t]:e}})}));const o=function(e,r){const n=new CustomEvent(e,r);t.dispatchEvent(n)};return r}catch(r){throw console.warn("Failed to parse props on element",{element:t,propsString:e}),r}}function Ot(t,e,r){const n=e.gateway;if(n)return n.updateTag(),n;const o=Ft(e);try{const{tag:n}=f(r,e,o);return function(t,e,r,n){const o=new MutationObserver((t=>{if(function(t){const{element:e}=t;if(!document.body.contains(e))return jt(t),!1}(s))for(const e of t)"attributes"===e.type&&a()}));function a(){const t=r.tagSupport.templater,n=t.tagSupport.propsConfig.latest,o=Ft(e);t.tagSupport.propsConfig.latest=o,JSON.stringify(n)===JSON.stringify(o)||(t.tagSupport.propsConfig.latest=o)}_t(n);const s={id:t,tag:r,observer:o,component:n,element:e,updateTag:a};return xt[t]=xt[t]||[],xt[t].push(s),e.gateway=s,o.observe(e,{attributes:!0}),s}(t,e,n,r)}catch(t){throw console.warn("Failed to render component to element",{component:r,element:e,props:o}),t}}class Bt extends HTMLElement{gateway;constructor(){super(),setTimeout((()=>this.gateway=function(t){const e=t.id||t.getAttribute("id");if(!e){const r="Cannot check a tag on element with no id attribute";throw console.warn(r,{id:e,element:t}),new Error(r)}const r=Vt[e];if(!r){const r=`Cannot find a tag registered by id of ${e}`;throw console.warn(r,{id:e,element:t}),new Error(r)}return Ot(e,t,r)}(this)),0)}disconnectedCallback(){jt(this.gateway)}}function Pt(){customElements.define("tag-element",Bt)}let Nt=!1;function _t(t){if(!Nt){try{Pt()}catch(t){throw t}Nt=!0}const e=kt(t);return Vt[e]=t,e}const $t={},Mt=function(t){const e=kt(t);if($t[e])return $t[e];let r,n=0;function o(){const n=function(t,e){return function(t,e,r){return e.forEach((e=>Ot(t,e,r))),e}(t,document.querySelectorAll("#"+t),e)}(e,t);return n.length?(r&&clearInterval(r),delete $t[e],n.length):n.length}return o()?{id:e}:(r=setInterval((()=>{if(n+=5,n>=2e3)throw clearInterval(r),new Error(`TaggedJs Element ${e} not found`);o()}),5),$t[e]={id:e},$t[e])};function Lt(t){return n.memory.providerConfig.providers.find((e=>e.constructMethod===t))}n.memory.providerConfig={providers:[],ownerTag:void 0};const Ut={create:t=>{const e=Lt(t);if(e)return e.clone=i(e.instance),e.instance;const r=t.constructor?new t:t();return n.memory.providerConfig.providers.push({constructMethod:t,instance:r,clone:i(r)}),r},inject:t=>{const e=Lt(t);if(e)return e.instance;const r=n.memory.providerConfig;let o={ownerTag:r.ownerTag};for(;o.ownerTag;){const e=o.ownerTag.tagSupport.memory.providers.find((e=>{if(e.constructMethod===t)return!0}));if(e)return e.clone=i(e.instance),r.providers.push(e),e.instance;o=o.ownerTag}const a=`Could not inject provider: ${t.name} ${t}`;throw console.warn(`${a}. Available providers`,r.providers),new Error(a)}};function It(t,e){const r=n.memory.providerConfig;r.ownerTag=e,t.memory.providers.length&&(r.providers.length=0,r.providers.push(...t.memory.providers))}function Wt(t){const e=n.memory.stateConfig,[r]=t(void 0);t(r);const o=e.rearray[e.array.length];if(o){let n=o.watch,a=St(o);const s={callback:t,lastValue:a,watch:o.watch};return r!=n&&(s.watch=r,a=s.lastValue=r),e.array.push(s),t(a),a}const a={callback:t,lastValue:r,watch:r};return e.array.push(a),r}function Dt(t){n.memory.initCurrentSupport=t}function Jt(t){n.memory.initCurrentSupport.memory.init||(n.memory.initCurrentSupport.memory.init=t,t())}let Ht;function Kt(t){Ht.memory.destroyCallback=t}n({beforeRender:(t,e)=>{It(t,e)},beforeRedraw:(t,e)=>{It(t,e.ownerTag)},afterRender:t=>{const e=n.memory.providerConfig;t.memory.providers=[...e.providers],e.providers.length=0}}),n({beforeRender:t=>Dt(t),beforeRedraw:t=>Dt(t)}),n({beforeRender:t=>Ht=t,beforeRedraw:t=>Ht=t,beforeDestroy:(t,e)=>{const r=t.memory.destroyCallback;r&&r()}});let zt=()=>t=>()=>{throw new Error("The real callback function was called and that should never occur")};function Xt(t,e){t.forEach(((t,r)=>{const n=St(t),o=e[r].callback;o&&o(n),e[r].lastValue=n}))}function Gt(t){zt=()=>{const e=n.memory.stateConfig.array;return r=>(...n)=>function(t,e,r,...n){const o=t.memory.state.newest;Xt(o,r);const a=e(...n);Xt(r,o),t.render(),a instanceof Promise&&a.finally((()=>{Xt(r,o),t.render()}))}(t,r,e,...n)}}n({beforeRender:t=>Gt(t),beforeRedraw:t=>Gt(t)});const Yt={tagElement:f,redrawTag:r};var qt=e.W9,Zt=e.ei,Qt=e.B7,te=e.vw,ee=e.PC,re=e.uX,ne=e.Ot,oe=e.eQ,ae=e.cF,se=e.qy,ie=e.xH,ue=e.u2,ce=e.zl,le=e._4,pe=e.iO,ge=e.mn,de=e.Yn,fe=e.Ly,me=e.sA,he=e.MG,ye=e.r5,we=e.iz,be=e.vJ,ve=e.hZ,Se=e.Un,Ce=e.Ie,Te=e.AI,Ee=e.Tc,Ae=e.Hf,Re=e.TY,xe=e._A,Ve=e.wB;export{qt as ArrayNoKeyError,Zt as StateMismatchError,Qt as Subject,te as Tag,ee as TagError,re as TagSupport,ne as ValueSubject,oe as getCallback,ae as hmr,se as html,ie as initWebComponents,ue as interpolateElement,ce as interpolateString,le as isSubjectInstance,pe as isTagArray,ge as isTagComponent,de as isTagInstance,fe as loadTagGateway,me as onDestroy,he as onInit,ye as providers,we as redrawTag,be as runBeforeRender,ve as set,Se as setLet,Ce as setProp,Te as setUse,Ee as tag,Ae as tagElement,Re as tagGateway,xe as tags,Ve as watch};