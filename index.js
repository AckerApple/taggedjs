var t={d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};function r(t){return n(t,new WeakMap)}function n(t,e){if(null===t||"object"!=typeof t)return t;if(e.has(t))return e.get(t);if(t instanceof Date)return new Date(t);if(t instanceof RegExp)return new RegExp(t);const r=Array.isArray(t)?[]:Object.create(Object.getPrototypeOf(t));if(e.set(t,r),Array.isArray(t))for(let o=0;o<t.length;o++)r[o]=n(t[o],e);else for(const o in t)t.hasOwnProperty(o)&&(r[o]=n(t[o],e));return r}function o(t,e){return s(t,e,new WeakMap)}function s(t,e,r){if(t===e)return!0;if("object"!=typeof t||"object"!=typeof e||null===t||null===e)return!1;const n=Object.keys(t),o=Object.keys(e);if(n.length!==o.length)return!1;if(r.has(t))return!0;r.set(t,0);for(const a of n)if(!o.includes(a)||!s(t[a],e[a],r)){if(t[a]instanceof Function&&e[a]instanceof Function&&t[a].toString()===e[a].toString())continue;return!1}if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!s(t[n],e[n],r))return!1}else if(Array.isArray(t)||Array.isArray(e))return!1;return!0}function a(t){return!0===t?.isTemplater}function i(t){return!0===t?.isTag}function u(t){return!(!0!==t?.isSubject&&!t?.subscribe)}function c(t){return t instanceof Array&&t.every((t=>i(t)))}function l(t){const e={beforeRender:t.beforeRender||(()=>{}),beforeRedraw:t.beforeRedraw||(()=>{}),afterRender:t.afterRender||(()=>{}),beforeDestroy:t.beforeDestroy||(()=>{})};l.tagUse.push(e)}function p(t,e){l.tagUse.forEach((r=>r.beforeRender(t,e)))}function d(t,e){l.tagUse.forEach((r=>r.afterRender(t,e)))}function g(t,e){l.tagUse.forEach((r=>r.beforeRedraw(t,e)))}t.d(e,{W9:()=>G,ei:()=>Y,B7:()=>A,vw:()=>yt,PC:()=>X,uX:()=>h,Ot:()=>R,eQ:()=>Dt,oM:()=>S,zC:()=>b,I1:()=>w,cF:()=>Ht,qy:()=>wt,xH:()=>Ot,u2:()=>ut,zl:()=>lt,_4:()=>u,iO:()=>c,mn:()=>a,Yn:()=>i,Ly:()=>Bt,sA:()=>zt,MG:()=>Ut,r5:()=>Mt,iz:()=>T,vJ:()=>p,AI:()=>l,wk:()=>bt,Tc:()=>F,Hf:()=>E,TY:()=>_t,_A:()=>k,wB:()=>Et}),l.tagUse=[],l.memory={};class f{tagged;wrapper;newest;oldest;tagSupport;constructor(t,e){this.tagSupport=new h(this,e,t)}redraw;isTemplater=!0;forceRenderTemplate(t,e){const r=this.wrapper();return r.setSupport(t),d(r.tagSupport,r),this.oldest=r,t.oldest=r,this.oldest=r,this.newest=r,r.ownerTag=e,r}renderWithSupport(t,e,r){++t.memory.renderCount;const n=e?.ownerTag||r;t.oldest?(t.props=t.latestProps,t.clonedProps=t.latestClonedProps,g(t,t.oldest)):(p(t,n),l.memory.providerConfig.ownerTag=n);const o=this,s=o.wrapper();t.latestProps=s.tagSupport.props,t.latestClonedProps=s.tagSupport.clonedProps,s.setSupport(t),d(t,s),o.newest=s,s.ownerTag=n;const a=t.oldest=t.oldest||s;t.newest=s;const i=a.tagSupport;return a.tagSupport=i||t,a.tagSupport.templater=o,e&&e.isLikeTag(s)?(a.updateByTag(s),{remit:!1,retag:s}):{remit:!0,retag:s}}}function m(t,e){const r=function(t,r){if("object"!=typeof t)return t;const n={...t};return Object.entries(n).forEach((([t,r])=>{n[t]=r instanceof Function?(...t)=>function(t,r){const n=t(...r);return e.newest?.ownerTag?.tagSupport.render(),n}(r,t):r})),n}(i(t)?0:t);return r}class h{templater;children;props;latestProps;latestClonedProps;lastClonedKidValues=[];clonedProps;memory={context:{},state:{newest:[]},providers:[],renderCount:0};constructor(t,e,n){this.templater=t,this.children=e,this.props=n,this.latestProps=n;const o=m(n,t);this.latestClonedProps=o,i(n)||(this.latestClonedProps=r(o)),this.clonedProps=this.latestClonedProps,this.lastClonedKidValues.length=0,e.value.forEach((t=>{const e=v(t.values);this.lastClonedKidValues.push(e)}))}oldest;newest;mutatingRender(){const t='Tag function "render()" was called in sync but can only be called async';throw console.error(t,{tagSupport:this}),new Error(t)}render(){return++this.memory.renderCount,this.mutatingRender()}renderExistingTag(t,e){const n=this.memory.renderCount;if(function(t){t.tagSupport.memory.providers.filter((t=>!o(t.instance,t.clone))).forEach((e=>{!function(t,e){y(t,e).forEach((({tag:t,renderCount:e,provider:n})=>{e===t.tagSupport.memory.renderCount&&(n.clone=r(n.instance),t.tagSupport.render())}))}(t.getAppElement(),e),e.clone=r(e.instance)}))}(t),n!==this.memory.renderCount)return!0;const s=w(t.tagSupport.templater.tagSupport,e.tagSupport);return this.newest=this.templater.redraw(),!s}}function y(t,e,r=[]){const n=t.tagSupport.memory.providers.find((t=>t.constructMethod===e.constructMethod));return n&&r.push({tag:t,renderCount:t.tagSupport.memory.renderCount,provider:n}),t.children.forEach((t=>y(t,e,r))),r}function w(t,e){const r=t.props;return!!b(e.props,t.latestClonedProps,r)||S(t,e)}function b(t,e,r){return!(void 0===t&&t===r||o(e,t))}function S(t,e){const r=t.lastClonedKidValues,n=e.lastClonedKidValues;return!r.every(((t,e)=>{const r=n[e];return t.every(((t,e)=>t===r[e]))}))}function v(t){return t.map((t=>{const e=t;if(i(e))return v(e.values);if(a(e)){const t=e;if(t.newest||t.oldest)throw 33;return r(t.tagSupport.latestClonedProps)}return c(e)?v(e):r(t)}))}function T(t,e,r){const n=t?.tagSupport||new h(e,e.tagSupport.children);return e.renderWithSupport(n,t,r)}const C=[];function E(t,e,r){const n=C.findIndex((t=>t.element===e));n>=0&&(C[n].tag.destroy(),C.splice(n,1),console.warn("Found and destroyed app element already rendered to element",{element:e}));const o=function(t){const e=t.tagSupport;p(e,void 0);const r=t.wrapper();return r.tagSupport=e,d(r.tagSupport,r),{tag:r,tagSupport:e}}(t(r)),{tag:s,tagSupport:a}=o;s.appElement=e,function(t,e){let r;t.mutatingRender=()=>{g(e.tagSupport,e);const n=t.templater,o=r=n.wrapper();return t.latestProps=o.tagSupport.props,t.latestClonedProps=o.tagSupport.clonedProps,o.setSupport(t),d(e.tagSupport,e),e.updateByTag(o),t.newest=o,r}}(a,s);const i=document.createElement("template");return i.setAttribute("tag-detail","app-template-placeholder"),e.appendChild(i),s.buildBeforeElement(i),e.setUse=t.original.setUse,C.push({element:e,tag:s}),{tag:s,tags:t.original.tags}}class A{isSubject=!0;subscribers=[];value;subscribe(t){this.subscribers.push(t),x.globalSubs.push(t),x.globalSubCount$.set(x.globalSubCount$.value+1);const e=()=>{e.unsubscribe()};return e.unsubscribe=()=>{P(this.subscribers,t),P(x.globalSubs,t),x.globalSubCount$.set(x.globalSubCount$.value-1),e.unsubscribe=()=>{}},e}set(t){this.value=t,this.subscribers.forEach((e=>{e.value=t,e(t)}))}next=this.set}function P(t,e){const r=t.indexOf(e);-1!==r&&t.splice(r,1)}const x=A;x.globalSubs=[],x.globalSubCount$=new A,x.globalSubCount$.set(0);class R extends A{value;constructor(t){super(),this.value=t}subscribe(t){const e=super.subscribe(t);return t(this.value),e}}function V(t,e){if(t.isChildOverride)return t;const r=(r,n)=>j(t,e,r,n);return r.tagFunction=t,r}function j(t,e,r,n){const o=e.tagSupport.memory.renderCount,s=t.bind(r)(...n);if(o===e.tagSupport.memory.renderCount)return e.tagSupport.render(),s instanceof Promise?s.then((()=>e.tagSupport.render()&&"no-data-ever")):"no-data-ever"}const k=[];let O=0;function F(t){const e=function(e,r){const n=i(e)||c(e);n&&(r=e,e=void 0);const{childSubject:o,madeSubject:s}=function(t){if(u(t))return{childSubject:t,madeSubject:!1};if(c(t))return{childSubject:new R(t),madeSubject:!0};const e=t;return e?(e.arrayValue=0,{childSubject:new R([e]),madeSubject:!0}):{childSubject:new R([]),madeSubject:!0}}(r);o.isChildSubject=!0;const a=new f(e,o);function l(){const t=(0,l.original)(a.tagSupport.props,o);return t.setSupport(a.tagSupport),s&&o.value.forEach((e=>{e.values.forEach(((r,n)=>{r instanceof Function&&(e.values[n].isChildOverride||(e.values[n]=function(...e){j(r,t.ownerTag,this,e)},e.values[n].isChildOverride=!0))}))})),t}return n||m(e,a),l.original=t,a.tagged=!0,a.wrapper=l,a};return function(t,e){t.isTag=!0,t.original=e}(e,t),function(t){t.tags=k,t.setUse=l,t.tagIndex=++O}(t),k.push(t),e}function B(t,e,r){t.redraw=()=>{const n=e.tag,{remit:o,retag:s}=T(n,t,r);if(e.tagSupport=s.tagSupport,o)return e.set(t),s}}function N(t,e){e.parentNode.insertBefore(t,e)}function _(t,e,r){const n=t.split(".");if("style"===n[0]&&(r.style[n[1]]=e),"class"===n[0])return n.shift(),void(e?n.forEach((t=>r.classList.add(t))):n.forEach((t=>r.classList.remove(t))))}function $(t,e,r){const n=t.getAttributeNames();"TEXTAREA"!==t.nodeName||n.includes("value")||L("textVarValue",t.getAttribute("textVarValue"),t,e,r,((e,r)=>t.value=r));const o=(e,r)=>{t.setAttribute(e,r)};n.forEach((n=>{L(n,t.getAttribute(n),t,e,r,o)}))}function M(t){return t.search(/^(class|style)(\.)/)>=0}function L(t,e,r,n,o,s){if(W(e))return function(t,e,r,n,o,s){return D(t,z(n,e),r,o,s)}(t,e,r,n,o,s);if(W(t)){let e;const a=z(n,t).subscribe((t=>{!function(t,e,r,n,o){if(e&&e!=t&&("string"==typeof e?r.removeAttribute(e):e instanceof Object&&Object.entries(e).forEach((([t])=>r.removeAttribute(t)))),"string"!=typeof t)t instanceof Object&&Object.entries(t).forEach((([t,e])=>D(t,e,r,n,o)));else{if(!t.length)return;D(t,"",r,n,o)}}(t,e,r,o,s),e=t}));return o.cloneSubs.push(a),void r.removeAttribute(t)}return M(t)?_(t,e,r):void 0}new class{};const I=/^\s*{__tagvar/,U=/}\s*$/;function W(t){return t&&t.search(I)>=0&&t.search(U)>=0}function z(t,e){return t[e.replace("{","").split("").reverse().join("").replace("}","").split("").reverse().join("")]}function D(t,e,r,n,o){const s=M(t);if(e instanceof Function){const n=function(...t){return e(r,t)};r[t].action=n}if(u(e)){r.removeAttribute(t);const a=e=>function(t,e,r,n,o){if(t instanceof Function)return e[r]=function(...r){return t(e,r)},void(e[r].tagFunction=t);if(n)return void _(r,t,e);if(t)return void o(r,t);void 0===t||!1===t||null===t?e.removeAttribute(r):o(r,t)}(e,r,t,s,o),i=e.subscribe(a);n.cloneSubs.push(i)}else o(t,e)}const J=/(?:<[^>]*?(?:(?:\s+\w+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^>\s]+)))*\s*)\/?>)|({__tagvar[^}]+})/g;function K(t,e,r,{index:n,counts:o,forceElement:s}){if(void 0!==n){const a=e.lastArray,i=a[n];if(i?.tag.isLikeTag(t))return i.tag.updateByTag(t),[];a.push({tag:t,index:n});const u=r;return t.buildBeforeElement(u,{counts:o,forceElement:s})}const a=e,i=a.tag;if(i&&!s&&i.isLikeTag(t)){if(e instanceof Function){const t=e(i.tagSupport);return i.updateByTag(t),[]}return i.updateByTag(t),[]}const u=t.buildBeforeElement(r,{counts:o,forceElement:s});return a.tag=t,u}function H(t,e,r,n,o){if(!0!==t.tagged){let e=t.wrapper.original.name||t.wrapper.original.constructor?.name;"Function"===e&&(e=void 0);const r=e||t.wrapper.original.toString().substring(0,120);throw new Error(`Not a tag component. Wrap your function with tag(). Example tag(props => html\`\`) on component:\n\n${r}\n\n`)}const s=t,a=t.tagSupport;a.mutatingRender=()=>e.tag&&a.renderExistingTag(e.tag,s)?e.tag:a.newest=n.tagSupport.render();let i=s.newest;return l.memory.providerConfig.ownerTag=n,(!i||o.forceElement)&&(i?g(i.tagSupport,i):p(a,n),i=s.forceRenderTemplate(a,n)),n.children.push(i),a.latestProps=i.tagSupport.props,a.latestClonedProps=i.tagSupport.clonedProps,a.memory=i.tagSupport.memory,i.setSupport(a),K(i,e,r,o)}class X extends Error{details;constructor(t,e,r={}){super(t),this.name=X.name,this.details={...r,errorCode:e}}}class G extends X{constructor(t,e){super(t,"array-no-key-error",e),this.name=G.name}}class Y extends X{constructor(t,e){super(t,"state-mismatch-error",e),this.name=Y.name}}function q(t,e,r,n,o){const s=[];t.lastArray=t.lastArray||[],t.template=r;let a=0;t.lastArray=t.lastArray.filter(((r,n)=>{const s=e.length-1<n-a,i=e[n-a],u=i?.arrayValue;return!s&&u===r.tag.arrayValue||(t.lastArray[n].tag.destroy({stagger:o.counts.removed,byParent:!1}),++a,++o.counts.removed,!1)}));const i=r||r.clone;return e.forEach(((r,a)=>{r.tagSupport=new h({},new R([])),r.tagSupport.mutatingRender=()=>(n.tagSupport.render(),r),r.ownerTag=n,n.children.push(r);const u=r.arrayValue;if(u?.isArrayValueNeverSet){const t={template:r.getTemplate().string,array:e,ownerTagContent:n.lastTemplateString},o="Use html`...`.key(item) instead of html`...` to template an Array";throw console.error(o,t),new G(o,t)}if(t.lastArray.length>a){const e=t.lastArray[a];return e.tag.arrayValue===r.arrayValue&&e.tag.updateValues(r.values),[]}const c=K(r,t,i,{index:a,...o,counts:{added:o.counts.added+a,removed:o.counts.removed}});s.push(...c)})),s}var Q;function Z(t,e,r,n){const o=e.clone||r,s=nt(t,o);e.clone=s;const a=[],i=n.clones.indexOf(o);return i>=0&&!n.clones.includes(s)&&!o.parentNode&&(n.clones.splice(i,1),n.clones.push(s),a.push(s)),a}function tt(t,e,r,n,o){return t.tagSupport||(t.tagSupport=new h({},new R([])),t.tagSupport.mutatingRender=n.tagSupport.mutatingRender,t.tagSupport.oldest=t.tagSupport.oldest||t,n.children.push(t),t.ownerTag=n,e.sideTag=n),e.template=r,K(t,e,r,o)}function et(t,e,r,n){const o=e.tag,s=e.clone||r;s.parentNode.insertBefore(r,s);const a=nt(t,s);e.clone=a,delete e.tag;const i=n.counts.removed;return o.destroy({stagger:i}).then((t=>n.counts.removed=i+t))}function rt(t,e,r,n,o){const s=[];if(!t.hasAttribute("end"))return s;const u=t.getAttribute("id");if(u?.substring(0,dt.length)!==dt)return s;const l=e[u];let p=o.forceElement;const d=l.subscribe((e=>{const{clones:o}=function(t,e,r,n,o){const s=function(t){return a(t)?Q.tagComponent:i(t)?Q.tag:c(t)?Q.tagArray:Q.value}(t),u=e,l=u.clone;if(s!==Q.value&&l){const t=l.parentNode;t.insertBefore(r,l),t.removeChild(l),delete u.clone}switch(s){case Q.tag:return{clones:tt(t,e,r,n,o)};case Q.tagArray:return{clones:q(e,t,r,n,o)};case Q.tagComponent:return{clones:H(t,e,r,n,o)}}return e.tag?{clones:[],promise:et(t,e,r,o)}:{clones:Z(t,e,r,n)}}(e,l,t,r,{counts:{added:n.added,removed:n.removed},forceElement:p});p&&(p=!1),o.push(...o)}));return r.cloneSubs.push(d),s}function nt(t,e){const r=e.parentNode;void 0!==t&&!1!==t&&null!==t||(t="");const n=document.createTextNode(t);return r.insertBefore(n,e),r.removeChild(e),n}function ot(t,e){if(!t.getAttribute)return;let r=e.counts.added;e.forceElement||(r=function(t,e){const r=t.oninit;if(!r)return e.added;const n=r.tagFunction;if(!n)return e.added;const o=n.tagFunction;return o?(o({target:t,stagger:e.added}),++e.added):e.added}(t,e.counts)-r),t.children&&(e.counts.added,e.counts.removed,new Array(...t.children).forEach(((t,r)=>ot(t,{...e,counts:e.counts}))))}!function(t){t.tag="tag",t.tagArray="tag-array",t.tagComponent="tag-component",t.value="value"}(Q||(Q={}));const st=new RegExp('\\s*<template interpolate end id="__tagvar(\\d{1,4})"([^>]*)></template>(\\s*)');function at(t,e,r,n,o){if(!o||"TEMPLATE"===t.tagName)return[];const s=n.counts,a=[],i=new Array(...o);return"TEXTAREA"===t.tagName&&it(t),i.forEach(((t,o)=>{const i=rt(t,e,r,s,n);"TEXTAREA"===t.tagName&&it(t),a.push(...i),t.children&&new Array(...t.children).forEach(((t,o)=>{(function(t){return"TEMPLATE"===t.tagName&&void 0!==t.getAttribute("interpolate")&&void 0!==t.getAttribute("end")})(t)&&rt(t,e,r,s,n);const i=at(t,e,r,n,t.children);a.push(...i)}))})),a}function it(t){const e=t.value;if(e.search(st)>=0){const r=e.match(/__tagvar(\d{1,4})/),n="{"+(r?r[0]:"")+"}";t.value="",t.setAttribute("textVarValue",n)}}function ut(t,e,r,n,o){const s=[],a=r.interpolation,i=t.children[0].content.children;if(a.keys.length){const r=at(t,e,n,o,i);s.push(...r)}return $(t,e,n),ct(i,e,n),s}function ct(t,e,r){new Array(...t).forEach((t=>{$(t,e,r),t.children&&ct(t.children,e,r)}))}function lt(t){const e=function(t){const e=[];return{string:t.replace(J,((t,r)=>{if(t.startsWith("<"))return t;const n=r.substring(1,r.length-1);return e.push(n),`<template interpolate end id="${n}"></template>`})),keys:e}}(t);return e.string=e.string.replace(mt,dt),e}function pt(t,e,r){delete e.tag,delete e.tagSupport,delete r.tagSupport,t.destroy()}const dt="__tagvar",gt="--"+dt+"--",ft=new RegExp(dt,"g"),mt=new RegExp(gt,"g");class ht{isArrayValueNeverSet=!0}class yt{strings;values;isTag=!0;clones=[];cloneSubs=[];children=[];tagSupport;ownerTag;insertBefore;appElement;arrayValue=new ht;constructor(t,e){this.strings=t,this.values=e}key(t){return this.arrayValue=t,this}async destroy(t={stagger:0,byParent:!1}){!!this.tagSupport&&function(t,e){l.tagUse.forEach((r=>r.beforeDestroy(t,e)))}(this.tagSupport,this),this.destroySubscriptions();const e=this.children.map((e=>e.destroy({...t,byParent:!0})));return this.ownerTag&&(this.ownerTag.children=this.ownerTag.children.filter((t=>t!==this))),t.byParent||(t.stagger=await this.destroyClones(t)),await Promise.all(e),t.stagger}destroySubscriptions(){this.cloneSubs.forEach((t=>t.unsubscribe())),this.cloneSubs.length=0}async destroyClones({stagger:t}={stagger:0}){let e=!1;const r=this.clones.reverse().map(((r,n)=>{let o;r.ondestroy&&(o=function(t,e){const r=t.ondestroy;if(!r)return;const n=r.tagFunction;if(!n)return;const o=n.tagFunction;return o?o({target:t,stagger:e}):void 0}(r,t));const s=()=>{r.parentNode?.removeChild(r);const t=this.ownerTag;t&&(t.clones=t.clones.filter((t=>t!==r)))};return o instanceof Promise?(e=!0,o.then(s)):s(),o}));return e&&await Promise.all(r),t}updateByTag(t){this.updateConfig(t.strings,t.values),this.tagSupport.templater=t.tagSupport.templater}lastTemplateString=void 0;setSupport(t){this.tagSupport=t,this.tagSupport.mutatingRender=t.mutatingRender}updateConfig(t,e){this.strings=t,this.updateValues(e)}getTemplate(){const t=lt(this.strings.map(((t,e)=>(t.replace(ft,gt)+(this.values.length>e?`{${dt}${e}}`:"")).replace(/>\s*/g,">").replace(/\s*</g,"<"))).join(""));return this.lastTemplateString=t.string,{interpolation:t,string:t.string,strings:this.strings,values:this.values,context:this.tagSupport?.memory.context||{}}}isLikeTag(t){const{string:e}=t.getTemplate();return e===this.lastTemplateString&&t.values.length===this.values.length&&!!t.values.every(((t,e)=>{const r=this.values[e];return!(t instanceof Function&&r instanceof Function)||!(t.toString()!==r.toString())}))}update(){return this.updateContext(this.tagSupport.memory.context)}updateValues(t){return this.values=t,this.updateContext(this.tagSupport.memory.context)}updateContext(t){return this.strings.map(((e,n)=>{const o=dt+n,s=this.values.length>n,l=this.values[n],p=t[o];if(p)return function(t,e,n){const o=t.value,s=o?.tag,l=e,p=t,f=t;if(p.lastArray){if(p.isChildSubject&&(e=e.value),c(e))return void q(t,e,p.template,n,{counts:{added:0,removed:0}});t.lastArray.forEach((({tag:t})=>t.destroy())),delete t.lastArray}if(a(l))return function(t,e,n,o){let s=n.tag;if(!s)return B(e,n,t),void e.redraw();const a=s.tagSupport.templater.wrapper,u=e.wrapper;let c=!1;a&&u&&(c=a.original===u.original);const l=e.tagSupport.props,p=s.tagSupport;if(p.latestProps=l,c){const t=o?.tagSupport;let n=t.props;if(i(t.props)||(n=r(t.props)),s&&!w(p,e.tagSupport))return}else pt(s,n,o);B(e,n,t),p.templater=e;const d=e.redraw();n.value.tag=p.newest=d,p.latestClonedProps=e.tagSupport.clonedProps,c||(n.tag=d,o.tagSupport=e.tagSupport)}(n,l,f,o);const m=f.tag;if(m){c(e)&&(pt(m,f,o),delete f.tag);const r=m.tagSupport.templater.wrapper,n=e?.wrapper,a=r&&n&&r?.original===n?.original,i=e&&m.lastTemplateString===e.lastTemplateString,u=e&&e.getTemplate&&m.isLikeTag(e);if(i||u)return void tt(e,t,t.template,m,{counts:{added:0,removed:0}});if(a)return function(t,e,r){const n=e.tagSupport,o=n.oldest;g(o.tagSupport,o);const s=t.wrapper();n.latestProps=s.tagSupport.props,n.latestClonedProps=s.tagSupport.clonedProps,n.memory=s.tagSupport.memory,s.setSupport(n),t.newest=s,n.newest=s,d(o.tagSupport,o),e.updateByTag(s),r.set(t)}(e,m,f);s&&(pt(m,f,o),delete f.tag)}e instanceof Function?f.set(V(e,n)):u(e)?f.set(e.value):f.set(e)}(p,l,this);!function(t,e,r,n,o){if(a(e))B(e,r[n]=new R(e),o);else if(e instanceof Function)r[n]=function(t,e){return new R(V(t,e))}(e,o);else if(t)i(e)?(e.ownerTag=o,o.children.push(e),r[n]=new R(e)):u(e)?r[n]=e:r[n]=new R(e)}(s,l,t,o,this)})),t}getAppElement(){let t=this;for(;t.ownerTag;)t=t.ownerTag;return t}rebuild(){const t=this.insertBefore;if(!t){const t=new Error("Cannot rebuild. Previous insertBefore element is not defined on tag");throw t.tag=this,t}this.buildBeforeElement(t,{forceElement:!0,counts:{added:0,removed:0}})}buildBeforeElement(t,e={forceElement:!1,counts:{added:0,removed:0}}){this.insertBefore=t;const r=this.update(),n=this.getTemplate(),o=document.createElement("div");o.id="tag-temp-holder",o.innerHTML=`<template tag-wrap="22">${n.string}</template>`;const s=ut(o,r,n,this,{forceElement:e.forceElement,counts:e.counts});this.clones.length=0;const a=function(t,e){const r=[];let n=t.children[0].content.firstChild;for(;n;){const t=n.nextSibling;N(n,e),r.push(n),n=t}return r}(o,t);return this.clones.push(...a),s.length&&(this.clones=this.clones.filter((t=>!s.find((e=>e===t))))),this.clones.forEach((t=>ot(t,e))),this.clones}}function wt(t,...e){return new yt(t,e)}function bt(t){const e=l.memory.stateConfig;let r;const n=e.rearray[e.array.length];if(n){let t=vt(n);r=e=>[t,t=e];const o={callback:r,lastValue:t,defaultValue:n.defaultValue};return e.array.push(o),e=>(o.callback=e||(e=>[t,t=e]),t)}let o=(t instanceof Function?t:()=>t)();r=t=>[o,o=t];const s={callback:r,lastValue:o,defaultValue:o};return e.array.push(s),t=>(s.callback=t||(t=>[o,o=t]),o)}l.memory.stateConfig={array:[],rearray:[]};const St=[];function vt(t){const e=t.callback;if(!e)return t.defaultValue;const r=e(Tt),[n]=r,[o]=e(n);if(o!==Tt){const s='State property not used correctly. Second item in array is not setting value as expected.\n\nFor "let" state use `let name = state(default)(x => [name, name = x])`\n\nFor "const" state use `const name = state(default)()`\n\nProblem state:\n'+(e?e.toString():JSON.stringify(t))+"\n";throw console.error(s,{state:t,callback:e,oldState:r,oldValue:n,checkValue:o}),new Error(s)}return n}l({beforeRender:t=>Ct(t),beforeRedraw:t=>Ct(t),afterRender:(t,e)=>{const r=t.memory.state,n=l.memory.stateConfig;if(n.rearray.length&&n.rearray.length!==n.array.length){const e=`States lengths mismatched ${n.rearray.length} !== ${n.array.length}`;throw new Y(e,{oldStates:n.array,newStates:n.rearray,component:t.templater?.wrapper.original})}n.rearray=[],r.newest=[...n.array],n.array=[],St.forEach((t=>t())),St.length=0}});class Tt{}function Ct(t){const e=t.memory.state,r=l.memory.stateConfig;if(r.rearray.length){const n="last array not cleared";throw console.error(n,{config:r,component:t.templater?.wrapper.original,state:e,expectedClearArray:r.rearray}),new Y(n,{config:r,component:t.templater?.wrapper.original,state:e,expectedClearArray:r.rearray})}r.rearray=[],e?.newest.length&&r.rearray.push(...e.newest)}function Et(t,e){let r=bt(void 0)((t=>[r,r=t]));if(void 0===r){e(t,r);const n={currentValues:t,previousValues:r};return r=t,n}if(t.every(((t,e)=>t===r[e])))return{currentValues:t,previousValues:r};e(t,r);const n={currentValues:t,previousValues:r};return r=t,n}const At={},Pt={};function xt(t){const{id:e,observer:r,tag:n}=t;r.disconnect(),n.destroy(),delete At[e]}function Rt(t){return"__tagTemplate_"+function(t){let e=t.toString().replace(/\s+/g,"_").replace(/[^\w\d]/g,"_");return/^[a-zA-Z]/.test(e)||(e="fn_"+e),e}(t)}function Vt(t){const e=t.getAttribute("props");if(!e)return{element:t};try{const r=JSON.parse(e),n=t.getAttribute("events");n&&n.split(",").map((t=>t.trim())).map((t=>{r[t]=e=>o(t,{detail:{[t]:e}})}));const o=function(e,r){const n=new CustomEvent(e,r);t.dispatchEvent(n)};return r}catch(r){throw console.warn("Failed to parse props on element",{element:t,propsString:e}),r}}function jt(t,e,r){const n=e.gateway;if(n)return console.log("drawing existing gateway ====="),n.updateTag(),n;const o=Vt(e);try{console.log("tagging element ***");const{tag:n}=E(r,e,o);return function(t,e,r,n){const o=new MutationObserver((t=>{if(function(t){const{element:e}=t;if(!document.body.contains(e))return xt(t),!1}(a))for(const e of t)"attributes"===e.type&&(console.log("attributes changed"),s())}));function s(){const t=r.tagSupport.templater,n=t.tagSupport.props,o=Vt(e);t.tagSupport.props=o,JSON.stringify(n)===JSON.stringify(o)||(t.tagSupport.latestProps=o)}Bt(n);const a={id:t,tag:r,observer:o,component:n,element:e,updateTag:s};return At[t]=At[t]||[],At[t].push(a),e.gateway=a,o.observe(e,{attributes:!0}),a}(t,e,n,r)}catch(t){throw console.warn("Failed to render component to element",{component:r,element:e,props:o}),t}}class kt extends HTMLElement{gateway;constructor(){super(),setTimeout((()=>this.gateway=function(t){const e=t.id||t.getAttribute("id");if(!e){const r="Cannot check a tag on element with no id attribute";throw console.warn(r,{id:e,element:t}),new Error(r)}const r=Pt[e];if(!r){const r=`Cannot find a tag registered by id of ${e}`;throw console.warn(r,{id:e,element:t}),new Error(r)}return jt(e,t,r)}(this)),0)}disconnectedCallback(){xt(this.gateway)}}function Ot(){customElements.define("tag-element",kt)}let Ft=!1;function Bt(t){if(!Ft){try{Ot()}catch(t){throw t}Ft=!0}const e=Rt(t);return Pt[e]=t,e}const Nt={},_t=function(t){const e=Rt(t);if(Nt[e])return Nt[e];let r,n=0;function o(){const n=function(t,e){return function(t,e,r){return e.forEach((e=>jt(t,e,r))),e}(t,document.querySelectorAll("#"+t),e)}(e,t);return n.length?(r&&clearInterval(r),delete Nt[e],n.length):n.length}return o()?{id:e}:(r=setInterval((()=>{if(n+=5,n>=2e3)throw clearInterval(r),new Error(`TaggedJs Element ${e} not found`);o()}),5),Nt[e]={id:e},Nt[e])};function $t(t){return l.memory.providerConfig.providers.find((e=>e.constructMethod===t))}l.memory.providerConfig={providers:[],currentTagSupport:void 0,ownerTag:void 0};const Mt={create:t=>{const e=$t(t);if(e)return e.clone=r(e.instance),e.instance;const n=t.constructor?new t:t();return l.memory.providerConfig.providers.push({constructMethod:t,instance:n,clone:r(n)}),n},inject:t=>{const e=$t(t);if(e)return e.instance;const n=l.memory.providerConfig;let o={ownerTag:n.ownerTag};for(;o.ownerTag;){const e=o.ownerTag.tagSupport.memory.providers.find((e=>{if(e.constructMethod===t)return!0}));if(e)return e.clone=r(e.instance),n.providers.push(e),e.instance;o=o.ownerTag}const s=`Could not inject provider: ${t.name} ${t}`;throw console.warn(`${s}. Available providers`,n.providers),new Error(s)}};function Lt(t,e){const r=l.memory.providerConfig;r.currentTagSuport=t,r.ownerTag=e,t.memory.providers.length&&(r.providers.length=0,r.providers.push(...t.memory.providers))}function It(t){l.memory.initCurrentSupport=t}function Ut(t){l.memory.initCurrentSupport?l.memory.initCurrentSupport.memory.init||(l.memory.initCurrentSupport.memory.init=t,t()):console.warn("possible init issue?")}let Wt;function zt(t){Wt.memory||console.error("xxx",Wt),Wt.memory.destroyCallback=t}l({beforeRender:(t,e)=>{Lt(t,e)},beforeRedraw:(t,e)=>{Lt(t,e.ownerTag)},afterRender:t=>{const e=l.memory.providerConfig;t.memory.providers=[...e.providers],e.providers.length=0}}),l({beforeRender:t=>It(t),beforeRedraw:t=>It(t)}),l({beforeRender:t=>Wt=t,beforeRedraw:t=>Wt=t,beforeDestroy:(t,e)=>{const r=t.memory.destroyCallback;r&&r()}});let Dt=()=>t=>()=>{throw new Error("The real callback function was called and that should never occur")};function Jt(t,e){t.forEach(((t,r)=>{const n=vt(t),o=e[r].callback;o&&o(n),e[r].lastValue=n}))}function Kt(t){Dt=()=>{const e=l.memory.stateConfig.array;return r=>(...n)=>function(t,e,r,...n){const o=t.memory.state.newest;Jt(o,r);const s=e(...n);Jt(r,o),t.render(),s instanceof Promise&&s.finally((()=>{Jt(r,o),t.render()}))}(t,r,e,...n)}}l({beforeRender:t=>Kt(t),beforeRedraw:t=>Kt(t)});const Ht={tagElement:E,redrawTag:T};var Xt=e.W9,Gt=e.ei,Yt=e.B7,qt=e.vw,Qt=e.PC,Zt=e.uX,te=e.Ot,ee=e.eQ,re=e.oM,ne=e.zC,oe=e.I1,se=e.cF,ae=e.qy,ie=e.xH,ue=e.u2,ce=e.zl,le=e._4,pe=e.iO,de=e.mn,ge=e.Yn,fe=e.Ly,me=e.sA,he=e.MG,ye=e.r5,we=e.iz,be=e.vJ,Se=e.AI,ve=e.wk,Te=e.Tc,Ce=e.Hf,Ee=e.TY,Ae=e._A,Pe=e.wB;export{Xt as ArrayNoKeyError,Gt as StateMismatchError,Yt as Subject,qt as Tag,Qt as TagError,Zt as TagSupport,te as ValueSubject,ee as getCallback,re as hasKidsChanged,ne as hasPropChanges,oe as hasTagSupportChanged,se as hmr,ae as html,ie as initWebComponents,ue as interpolateElement,ce as interpolateString,le as isSubjectInstance,pe as isTagArray,de as isTagComponent,ge as isTagInstance,fe as loadTagGateway,me as onDestroy,he as onInit,ye as providers,we as redrawTag,be as runBeforeRender,Se as setUse,ve as state,Te as tag,Ce as tagElement,Ee as tagGateway,Ae as tags,Pe as watch};