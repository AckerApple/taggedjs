var t={d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};t.d(e,{xQ:()=>r,Vp:()=>ot,fx:()=>w,RN:()=>Nt,er:()=>S,dy:()=>st,jW:()=>dt,SO:()=>z,IT:()=>K,SW:()=>l,js:()=>mt,ev:()=>Ft,nc:()=>Ot,a:()=>At,_b:()=>T,hs:()=>f,lc:()=>d,SB:()=>Rt,_q:()=>St,bX:()=>Et,Cc:()=>yt,pJ:()=>bt});class r{isSubject=!0;subscribers=[];value;subscribe(t){this.subscribers.push(t),o.globalSubs.push(t),o.globalSubCount$.set(o.globalSubCount$.value+1);const e=()=>{e.unsubscribe()};return e.unsubscribe=()=>{n(this.subscribers,t),n(o.globalSubs,t),o.globalSubCount$.set(o.globalSubCount$.value-1),e.unsubscribe=()=>{}},e}set(t){this.value=t,this.subscribers.forEach((e=>{e.value=t,e(t)}))}next=this.set}function n(t,e){const r=t.indexOf(e);-1!==r&&t.splice(r,1)}const o=r;o.globalSubs=[],o.globalSubCount$=new r,o.globalSubCount$.set(0);class s extends r{value;constructor(t){super(),this.value=t}subscribe(t){const e=super.subscribe(t);return t(this.value),e}}function a(t){return i(t,new WeakMap)}function i(t,e){if(null===t||"object"!=typeof t)return t;if(e.has(t))return e.get(t);if(t instanceof Date)return new Date(t);if(t instanceof RegExp)return new RegExp(t);const r=Array.isArray(t)?[]:Object.create(Object.getPrototypeOf(t));if(e.set(t,r),Array.isArray(t))for(let n=0;n<t.length;n++)r[n]=i(t[n],e);else for(const n in t)t.hasOwnProperty(n)&&(r[n]=i(t[n],e));return r}function u(t,e){return c(t,e,new WeakMap)}function c(t,e,r){if(t===e)return!0;if("object"!=typeof t||"object"!=typeof e||null===t||null===e)return!1;const n=Object.keys(t),o=Object.keys(e);if(n.length!==o.length)return!1;if(r.has(t))return!0;r.set(t,0);for(const s of n)if(!o.includes(s)||!c(t[s],e[s],r)){if(t[s]instanceof Function&&e[s]instanceof Function&&t[s].toString()===e[s].toString())continue;return!1}if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!c(t[n],e[n],r))return!1}else if(Array.isArray(t)||Array.isArray(e))return!1;return!0}function l(t){return!0===t?.isTemplater}function p(t){return!0===t?.isTag}function g(t){return!(!0!==t?.isSubject&&!t?.subscribe)}function d(t){const e={beforeRender:t.beforeRender||(()=>{}),beforeRedraw:t.beforeRedraw||(()=>{}),afterRender:t.afterRender||(()=>{}),beforeDestroy:t.beforeDestroy||(()=>{})};d.tagUse.push(e)}function f(t,e){d.tagUse.forEach((r=>r.beforeRender(t,e)))}function m(t,e){d.tagUse.forEach((r=>r.afterRender(t,e)))}function h(t,e){d.tagUse.forEach((r=>r.beforeRedraw(t,e)))}d.tagUse=[],d.memory={};class y{tagged;wrapper;newest;oldest;tagSupport;constructor(t){this.tagSupport=S(this,t)}redraw;isTemplater=!0;forceRenderTemplate(t,e){const r=this.wrapper();return r.setSupport(t),r.afterRender(),this.oldest=r,t.oldest=r,this.oldest=r,this.newest=r,r.ownerTag=e,r}renderWithSupport(t,e,r){++t.memory.renderCount;const n=e?.ownerTag||r;t.oldest?(t.props=t.latestProps,t.clonedProps=t.latestClonedProps,h(t,t.oldest)):(f(t,n),d.memory.providerConfig.ownerTag=n);const o=this,s=o.wrapper();t.latestProps=s.tagSupport.props,t.latestClonedProps=s.tagSupport.clonedProps,s.setSupport(t),m(t,s),o.newest=s,s.ownerTag=n;const a=t.oldest=t.oldest||s;t.newest=s;const i=a.tagSupport;return a.tagSupport=i||t,a.tagSupport.templater=o,e&&e.isLikeTag(s)?(a.updateByTag(s),{remit:!1,retag:s}):{remit:!0,retag:s}}}function b(t,e){const r=function(t,r){if("object"!=typeof t)return t;const n={...t};return Object.entries(n).forEach((([t,r])=>{n[t]=r instanceof Function?(...t)=>function(t,r){const n=t(...r);return e.newest?.ownerTag?.tagSupport.render(),n}(r,t):r})),n}(p(t)?0:t);return r}class w{templater;props;latestProps;clonedProps;latestClonedProps;memory={context:{},state:{newest:[]},providers:[],renderCount:0};constructor(t,e){this.templater=t,this.props=e,this.latestProps=e;const r=b(e,t);this.latestClonedProps=r,p(e)||(this.latestClonedProps=a(r)),this.clonedProps=this.latestClonedProps}oldest;newest;hasPropChanges(t,e,r){return!(void 0===t&&t===r||u(e,t))}mutatingRender(){const t='Tag function "render()" was called in sync but can only be called async';throw console.error(t,{tagSupport:this}),new Error(t)}render(){return++this.memory.renderCount,this.mutatingRender()}renderExistingTag(t,e){const r=this.memory.renderCount;if(function(t){t.tagSupport.memory.providers.filter((t=>!u(t.instance,t.clone))).forEach((e=>{!function(t,e){v(t,e).forEach((({tag:t,renderCount:e,provider:r})=>{e===t.tagSupport.memory.renderCount&&(r.clone=a(r.instance),t.tagSupport.render())}))}(t.getAppElement(),e),e.clone=a(e.instance)}))}(t),r!==this.memory.renderCount)return!0;const n=t.tagSupport.templater,o=e.tagSupport.props,s=n.tagSupport.clonedProps,i=n?.tagSupport.props;return function(t,e,r,n,o){const s=t.hasPropChanges(e,r,n);return t.newest=o.redraw(),!s}(this,o,s,i,this.templater)}}function S(t,e){return new w(t,e)}function v(t,e,r=[]){const n=t.tagSupport.memory.providers.find((t=>t.constructMethod===e.constructMethod));return n&&r.push({tag:t,renderCount:t.tagSupport.memory.renderCount,provider:n}),t.children.forEach((t=>v(t,e,r))),r}function T(t,e,r){const n=t?.tagSupport||S(e);return e.renderWithSupport(n,t,r)}function E(t,e){function r(r,n){const o=e.tagSupport.memory.renderCount,s=t.bind(r)(...n);if(o===e.tagSupport.memory.renderCount)return e.tagSupport.render(),s instanceof Promise?s.then((()=>e.tagSupport.render()&&"no-data-ever")):Promise.resolve(s).then((()=>"no-data-ever"))}return r.tagFunction=t,r}function C(t,e,r){e.tagSupport?.memory.renderCount,t.redraw=n=>{const o=e.tag,{remit:s,retag:a}=T(o,t,r);if(e.tagSupport=a.tagSupport,s){if(e.set(t),n){const t=o.tagSupport.memory.context;Object.values(t).forEach((t=>{t.value?.isTemplater&&t.value.redraw()}))}return a}}}function A(t,e){e.parentNode.insertBefore(t,e)}function P(t,e,r){const n=t.split(".");if("style"===n[0]&&(r.style[n[1]]=e),"class"===n[0])return n.shift(),void(e?n.forEach((t=>r.classList.add(t))):n.forEach((t=>r.classList.remove(t))))}function R(t,e,r){const n=t.getAttributeNames();"TEXTAREA"!==t.nodeName||n.includes("value")||j("textVarValue",t.getAttribute("textVarValue"),t,e,r,((e,r)=>t.value=r));const o=(e,r)=>{t.setAttribute(e,r)};n.forEach((n=>{j(n,t.getAttribute(n),t,e,r,o)}))}function x(t){return t.search(/^(class|style)(\.)/)>=0}function j(t,e,r,n,o,s){if(O(e))return function(t,e,r,n,o,s){return F(t,B(n,e),r,o,s)}(t,e,r,n,o,s);if(O(t)){let e;const a=B(n,t).subscribe((t=>{!function(t,e,r,n,o){if(e&&e!=t&&("string"==typeof e?r.removeAttribute(e):e instanceof Object&&Object.entries(e).forEach((([t])=>r.removeAttribute(t)))),"string"!=typeof t)t instanceof Object&&Object.entries(t).forEach((([t,e])=>F(t,e,r,n,o)));else{if(!t.length)return;F(t,"",r,n,o)}}(t,e,r,o,s),e=t}));return o.cloneSubs.push(a),void r.removeAttribute(t)}return x(t)?P(t,e,r):void 0}const k=/^\s*{__tagvar/,V=/}\s*$/;function O(t){return t&&t.search(k)>=0&&t.search(V)>=0}function B(t,e){return t[e.replace("{","").split("").reverse().join("").replace("}","").split("").reverse().join("")]}function F(t,e,r,n,o){const s=x(t);if(e instanceof Function){const n=function(...t){return e(r,t)};r[t].action=n}if(g(e)){r.removeAttribute(t);const a=e=>function(t,e,r,n,o){if(t instanceof Function)return e[r]=function(...r){return t(e,r)},void(e[r].tagFunction=t);if(n)return void P(r,t,e);if(t)return void o(r,t);void 0===t||!1===t||null===t?e.removeAttribute(r):o(r,t)}(e,r,t,s,o),i=e.subscribe(a);n.cloneSubs.push(i)}else o(t,e)}const N=/(?:<[^>]*?(?:(?:\s+\w+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^>\s]+)))*\s*)\/?>)|({__tagvar[^}]+})/g;function _(t,e,r,{index:n,counts:o,forceElement:s}){if(void 0!==n){const a=e.lastArray,i=a[n];if(i?.tag.isLikeTag(t))return i.tag.updateByTag(t),[];a.push({tag:t,index:n});const u=r;return t.buildBeforeElement(u,{counts:o,forceElement:s})}const a=e,i=a.tag;if(i&&!s&&i.isLikeTag(t)){if(e instanceof Function){const t=e(i.tagSupport);return i.updateByTag(t),[]}return i.updateByTag(t),[]}const u=t.buildBeforeElement(r,{counts:o,forceElement:s});return a.tag=t,u}function $(t,e,r,n,o){if(!0!==t.tagged){let e=t.wrapper.original.name||t.wrapper.original.constructor?.name;"Function"===e&&(e=void 0);const r=e||t.wrapper.original.toString().substring(0,120);throw new Error(`Not a tag component. Wrap your function with tag(). Example tag(props => html\`\`) on component:\n\n${r}\n\n`)}const s=t,a=t.tagSupport;a.mutatingRender=()=>e.tag&&a.renderExistingTag(e.tag,s)?e.tag:a.newest=n.tagSupport.render();let i=s.newest;return d.memory.providerConfig.ownerTag=n,(!i||o.forceElement)&&(i||f(a,n),i&&h(a,i),i=s.forceRenderTemplate(a,n)),n.children.push(i),a.latestProps=i.tagSupport.props,a.latestClonedProps=i.tagSupport.clonedProps,a.memory=i.tagSupport.memory,i.setSupport(a),_(i,e,r,o)}function L(t,e,r,n,o){const s=[];t.lastArray=t.lastArray||[],t.template=r;let a=0;t.lastArray=t.lastArray.filter(((r,n)=>{const s=e.length-1<n-a,i=e[n-a],u=i?.arrayValue;return!s&&u===r.tag.arrayValue||(t.lastArray[n].tag.destroy({stagger:o.counts.removed,byParent:!1}),++a,++o.counts.removed,!1)}));const i=r||r.clone;return e.forEach(((e,r)=>{if(e.tagSupport=S({}),e.tagSupport.mutatingRender=()=>(n.tagSupport.render(),e),e.ownerTag=n,n.children.push(e),void 0===e.arrayValue&&!Object.keys(e).includes("arrayValue")){const t=new Error("Use html`...`.key(item) instead of html`...` to template an Array");throw t.code="add-array-key",t}const a=t.lastArray[r];if(a)return a.tag.arrayValue===e.arrayValue&&a.tag.updateValues(e.values),[];const u=_(e,t,i,{index:r,...o});s.push(...u)})),s}var M;function U(t){return t instanceof Array&&t.every((t=>p(t)))}function W(t,e,r,n){const o=e.clone||r,s=X(t,o);e.clone=s;const a=[],i=n.clones.indexOf(o);return i>=0&&!n.clones.includes(s)&&!o.parentNode&&(n.clones.splice(i,1),n.clones.push(s),a.push(s)),a}function D(t,e,r,n,o){return t.tagSupport||(t.tagSupport=S({}),t.tagSupport.mutatingRender=n.tagSupport.mutatingRender,t.tagSupport.oldest=t.tagSupport.oldest||t,n.children.push(t),t.ownerTag=n,e.sideTag=n),e.template=r,_(t,e,r,o)}function I(t,e,r,n){const o=e.tag,s=e.clone||r;s.parentNode.insertBefore(r,s),e.clone&&e.clone.parentNode.removeChild(e.clone),delete e.tag;const a=n.counts.removed,i=o.destroy({stagger:a}).then((t=>n.counts.removed=a+t));delete e.tag;const u=X(t,r);return e.clone=u,i}function J(t,e,r,n,o){const s=[];if(!t.hasAttribute("end"))return s;const a=t.getAttribute("id");if(a?.substring(0,tt.length)!==tt)return s;const i=e[a];let u=o.forceElement;const c=i.subscribe((e=>{const{clones:o}=function(t,e,r,n,o){const s=function(t){return l(t)?M.tagComponent:p(t)?M.tag:U(t)?M.tagArray:M.value}(t),a=e,i=a.clone;if(s!==M.value&&i){const t=i.parentNode;r.removeAttribute("removedAt"),t.insertBefore(r,i),t.removeChild(i),delete a.clone}switch(s){case M.tag:return{clones:D(t,e,r,n,o)};case M.tagArray:return{clones:L(e,t,r,n,o)};case M.tagComponent:return{clones:$(t,e,r,n,o)}}return e.tag?{clones:[],promise:I(t,e,r,o)}:{clones:W(t,e,r,n)}}(e,i,t,r,{counts:n,forceElement:u});u&&(u=!1),o.push(...o),setTimeout((()=>{n.added=0,n.removed=0}),0)}));return r.cloneSubs.push(c),s}function X(t,e){const r=e.parentNode;void 0!==t&&!1!==t&&null!==t||(t="");const n=document.createTextNode(t);return r.insertBefore(n,e),r.removeChild(e),"TEMPLATE"===e.nodeName&&e.setAttribute("removedAt",Date.now().toString()),n}function q(t,e){t.getAttribute&&(e.forceElement||function(t,e){const r=t.oninit;if(!r)return;const n=r.tagFunction;if(!n)return;const o=n.tagFunction;o&&(o({target:t,stagger:e.added}),++e.added)}(t,e.counts),t.children&&new Array(...t.children).forEach((t=>q(t,e))))}!function(t){t.tag="tag",t.tagArray="tag-array",t.tagComponent="tag-component",t.value="value"}(M||(M={}));const G=new RegExp('\\s*<template interpolate end id="__tagvar(\\d{1,4})"([^>]*)></template>(\\s*)');function H(t,e,r,n,o){if(!o||"TEMPLATE"===t.tagName)return[];const s={added:0,removed:0},a=[],i=new Array(...o);return"TEXTAREA"===t.tagName&&Q(t),i.forEach((t=>{const o=J(t,e,r,s,n);"TEXTAREA"===t.tagName&&Q(t),a.push(...o),t.children&&new Array(...t.children).forEach((t=>{(function(t){return"TEMPLATE"===t.tagName&&void 0!==t.getAttribute("interpolate")&&void 0!==t.getAttribute("end")})(t)&&J(t,e,r,s,n);const o=H(t,e,r,n,t.children);a.push(...o)}))})),a}function Q(t){const e=t.value;if(e.search(G)>=0){const r=e.match(/__tagvar(\d{1,4})/),n="{"+(r?r[0]:"")+"}";t.value="",t.setAttribute("textVarValue",n)}}function z(t,e,r,n,o){const s=[],a=r.interpolation,i=t.children[0].content.children;if(a.keys.length){const r=H(t,e,n,o,i);s.push(...r)}return R(t,e,n),Z(i,e,n),s}function Z(t,e,r){new Array(...t).forEach((t=>{R(t,e,r),t.children&&Z(t.children,e,r)}))}function K(t){const e=function(t){const e=[];return{string:t.replace(N,((t,r)=>{if(t.startsWith("<"))return t;const n=r.substring(1,r.length-1);return e.push(n),`<template interpolate end id="${n}"></template>`})),keys:e}}(t);return e.string=e.string.replace(nt,tt),e}function Y(t,e,r){delete e.tag,delete e.tagSupport,delete r.tagSupport,t.destroy()}const tt="__tagvar",et="--"+tt+"--",rt=new RegExp(tt,"g"),nt=new RegExp(et,"g");class ot{strings;values;isTag=!0;clones=[];cloneSubs=[];children=[];tagSupport;ownerTag;insertBefore;appElement;arrayValue;constructor(t,e){this.strings=t,this.values=e}beforeRedraw(){h(this.tagSupport,this)}afterRender(){m(this.tagSupport,this)}key(t){return this.arrayValue=t,this}async destroy(t={stagger:0,byParent:!1}){!!this.tagSupport&&function(t,e){d.tagUse.forEach((r=>r.beforeDestroy(t,e)))}(this.tagSupport,this),this.destroySubscriptions();const e=this.children.map((e=>e.destroy({...t,byParent:!0})));return t.byParent||(t.stagger=await this.destroyClones(t)),this.ownerTag&&(this.ownerTag.children=this.ownerTag.children.filter((t=>t!==this))),await Promise.all(e),t.stagger}destroySubscriptions(){this.cloneSubs.forEach((t=>t.unsubscribe())),this.cloneSubs.length=0}async destroyClones({stagger:t}={stagger:0}){const e=this.clones.reverse().map(((e,r)=>{let n=Promise.resolve();return e.ondestroy&&(n=function(t,e){const r=t.ondestroy;if(!r)return;const n=r.tagFunction;if(!n)return;const o=n.tagFunction;return o?o({target:t,stagger:e}):void 0}(e,t)),n.then((()=>{e.parentNode?.removeChild(e);const t=this.ownerTag;t&&(t.clones=t.clones.filter((t=>t!==e)))})),n}));return await Promise.all(e),t}updateByTag(t){this.updateConfig(t.strings,t.values),this.tagSupport.templater=t.tagSupport.templater}lastTemplateString=void 0;setSupport(t){this.tagSupport=t,this.tagSupport.mutatingRender=t.mutatingRender}updateConfig(t,e){this.strings=t,this.updateValues(e)}getTemplate(){const t=K(this.strings.map(((t,e)=>(t.replace(rt,et)+(this.values.length>e?`{${tt}${e}}`:"")).replace(/>\s*/g,">").replace(/\s*</g,"<"))).join(""));return this.lastTemplateString=t.string,{interpolation:t,string:t.string,strings:this.strings,values:this.values,context:this.tagSupport?.memory.context||{}}}isLikeTag(t){const{string:e}=t.getTemplate();if(e!==this.lastTemplateString||t.values.length!==this.values.length)return!1;const r=t.values.every(((t,e)=>{const r=this.values[e];if(t instanceof Function&&r instanceof Function)return!(t.toString()!==r.toString());const n=t;return!p(n)||!p(r)||(n.ownerTag=this,this.children.push(n),n.lastTemplateString||n.getTemplate().string,!!n.isLikeTag(r))}));return!!r}update(){return this.updateContext(this.tagSupport.memory.context)}updateValues(t){return this.values=t,this.updateContext(this.tagSupport.memory.context)}updateContext(t){return this.strings.map(((e,r)=>{const n=tt+r,o=this.values.length>r,i=this.values[r],u=t[n];if(u)return function(t,e,r){const n=t.value,o=n?.tag,s=e,i=t,u=t;if(t.lastArray){if(U(e))return void L(t,e,i.template,r,{counts:{added:0,removed:0}});t.lastArray.forEach((({tag:t})=>t.destroy())),delete t.lastArray}if(l(s))return function(t,e,r,n){const o=e.tagSupport.props;let s=r.tag;if(!s)return C(e,r,t),void e.redraw();const i=s.tagSupport.templater.wrapper,u=e.wrapper;let c=!1;i&&u&&(c=i.original===u.original);const l=s.tagSupport,g=l.props;l.latestProps=o;const d=l.latestClonedProps;if(l.latestClonedProps=e.tagSupport.clonedProps,c){const t=n?.tagSupport;let e=t.props;if(p(t.props)||(e=a(t.props)),s&&!l.hasPropChanges(o,d,g))return}else Y(s,r,n);C(e,r,t),l.templater=e;const f=e.redraw();r.value.tag=l.newest=f,c||(r.tag=f,n.tagSupport=e.tagSupport)}(r,s,u,n);const c=u.tag;if(c){U(e)&&(Y(c,u,n),delete u.tag);const r=c.tagSupport.templater.wrapper,s=e?.wrapper,a=r&&s&&r?.original===s?.original,i=e&&c.lastTemplateString===e.lastTemplateString,l=e&&e.getTemplate&&c.isLikeTag(e);if(i||l)return void D(e,t,t.template,c,{counts:{added:0,removed:0}});if(a)return function(t,e,r){const n=e.tagSupport,o=n.oldest;o.beforeRedraw();const s=t.wrapper();n.latestProps=s.tagSupport.props,n.latestClonedProps=s.tagSupport.clonedProps,n.memory=s.tagSupport.memory,s.setSupport(n),t.newest=s,n.newest=s,o.afterRender(),e.updateByTag(s),r.set(t)}(e,c,u);o&&(Y(c,u,n),delete u.tag)}e instanceof Function?u.set(E(e,r)):g(e)?u.set(e.value):u.set(e)}(u,i,this);!function(t,e,r,n,o){if(l(e))C(e,r[n]=new s(e),o);else if(e instanceof Function)r[n]=function(t,e){return new s(E(t,e))}(e,o);else if(t)p(e)?(e.ownerTag=o,o.children.push(e),r[n]=new s(e)):g(e)?r[n]=e:r[n]=new s(e)}(o,i,t,n,this)})),t}getAppElement(){let t=this;for(;t.ownerTag;)t=t.ownerTag;return t}rebuild(){const t=this.insertBefore;if(!t){const t=new Error("Cannot rebuild. Previous insertBefore element is not defined on tag");throw t.tag=this,t}this.buildBeforeElement(t,{forceElement:!0,counts:{added:0,removed:0}})}buildBeforeElement(t,e={forceElement:!1,counts:{added:0,removed:0}}){this.insertBefore=t;const r=this.update(),n=this.getTemplate(),o=document.createElement("div");o.id="tag-temp-holder",o.innerHTML=`<template tag-wrap="22">${n.string}</template>`;const s=z(o,r,n,this,{forceElement:e.forceElement});this.clones.length=0;const a=function(t,e){const r=[];let n=t.children[0].content.firstChild;for(;n;){const t=n.nextSibling;A(n,e),r.push(n),n=t}return r}(o,t);return this.clones.push(...a),s.length&&(this.clones=this.clones.filter((t=>!s.find((e=>e===t))))),this.clones.forEach((t=>q(t,e))),this.clones}}function st(t,...e){return new ot(t,e)}const at={},it={};function ut(t){const{id:e,observer:r,tag:n}=t;r.disconnect(),n.destroy(),delete at[e]}function ct(t){return"__tagTemplate_"+function(t){let e=t.toString().replace(/\s+/g,"_").replace(/[^\w\d]/g,"_");return/^[a-zA-Z]/.test(e)||(e="fn_"+e),e}(t)}function lt(t){const e=t.getAttribute("props");if(!e)return{element:t};try{const r=JSON.parse(e),n=t.getAttribute("events");n&&n.split(",").map((t=>t.trim())).map((t=>{r[t]=e=>o(t,{detail:{[t]:e}})}));const o=function(e,r){const n=new CustomEvent(e,r);t.dispatchEvent(n)};return r}catch(r){throw console.warn("Failed to parse props on element",{element:t,propsString:e}),r}}function pt(t,e,r){const n=e.gateway;if(n)return n.updateTag(),n;const o=lt(e);try{const{tag:n}=Et(r,e,o);return function(t,e,r,n){let o=r;const s=new MutationObserver((t=>{if(function(t){const{element:e}=t;if(!document.body.contains(e))return ut(t),!1}(i))for(const e of t)"attributes"===e.type&&a()}));function a(){const t=r.tagSupport.templater,n=t.tagSupport.props,s=lt(e);if(t.tagSupport.props=s,JSON.stringify(n)===JSON.stringify(s))return;t.tagSupport.latestProps=s;const a=T(o,t);i.tag=o=a.retag}mt(n);const i={id:t,tag:r,observer:s,component:n,element:e,updateTag:a};return at[t]=at[t]||[],at[t].push(i),e.gateway=i,s.observe(e,{attributes:!0}),i}(t,e,n,r)}catch(t){throw console.warn("Failed to render component to element",{component:r,element:e,props:o}),t}}class gt extends HTMLElement{gateway;constructor(){super(),setTimeout((()=>this.gateway=function(t){const e=t.id||t.getAttribute("id");if(!e){const r="Cannot check a tag on element with no id attribute";throw console.warn(r,{id:e,element:t}),new Error(r)}const r=it[e];if(!r){const r=`Cannot find a tag registered by id of ${e}`;throw console.warn(r,{id:e,element:t}),new Error(r)}return pt(e,t,r)}(this)),0)}disconnectedCallback(){ut(this.gateway)}}function dt(){customElements.define("tag-element",gt)}let ft=!1;function mt(t){if(!ft){try{dt()}catch(t){throw t}ft=!0}const e=ct(t);return it[e]=t,e}const ht={},yt=function(t){const e=ct(t);if(ht[e])return ht[e];let r,n=0;function o(){const n=function(t,e){return function(t,e,r){return e.forEach((e=>pt(t,e,r))),e}(t,document.querySelectorAll("#"+t),e)}(e,t);return n.length?(r&&clearInterval(r),delete ht[e],n.length):n.length}return o()?{id:e}:(r=setInterval((()=>{if(n+=5,n>=2e3)throw clearInterval(r),new Error(`TaggedJs Element ${e} not found`);o()}),5),ht[e]={id:e},ht[e])},bt=[];let wt=0;function St(t){const e=function(e,r){const n=p(e),o=new y(e);let s=b(e,o);function a(){const t=(0,a.original)(o.tagSupport.props,r);return t.setSupport(o.tagSupport),t}return n&&(r=e,s=vt),a.original=t,o.tagged=!0,o.wrapper=a,o};return function(t,e){t.isTag=!0,t.original=e}(e,t),function(t){t.tags=bt,t.setUse=d,t.tagIndex=++wt}(t),bt.push(t),e}const vt=new class{},Tt=[];function Et(t,e,r){const n=Tt.findIndex((t=>t.element===e));n>=0&&(Tt[n].tag.destroy(),Tt.splice(n,1),console.warn("Found and destroyed app element already rendered to element",{element:e}));const o=function(t){const e=t.tagSupport;f(e,void 0);const r=t.wrapper();return r.tagSupport=e,r.afterRender(),{tag:r,tagSupport:e}}(t(r)),{tag:s,tagSupport:a}=o;s.appElement=e,function(t,e){let r;t.mutatingRender=()=>{e.beforeRedraw();const n=t.templater,o=r=n.wrapper();return t.latestProps=o.tagSupport.props,t.latestClonedProps=o.tagSupport.clonedProps,o.setSupport(t),e.afterRender(),e.updateByTag(o),t.newest=o,r}}(a,s);const i=document.createElement("template");return i.setAttribute("tag-detail","app-template-placeholder"),e.appendChild(i),s.buildBeforeElement(i),e.setUse=t.original.setUse,Tt.push({element:e,tag:s}),{tag:s,tags:t.original.tags}}function Ct(t){return d.memory.providerConfig.providers.find((e=>e.constructMethod===t))}d.memory.providerConfig={providers:[],currentTagSupport:void 0,ownerTag:void 0};const At={create:t=>{const e=Ct(t);if(e)return e.clone=a(e.instance),e.instance;const r=t.constructor?new t:t();return d.memory.providerConfig.providers.push({constructMethod:t,instance:r,clone:a(r)}),r},inject:t=>{const e=Ct(t);if(e)return e.instance;const r=d.memory.providerConfig;let n={ownerTag:r.ownerTag};for(;n.ownerTag;){const e=n.ownerTag.tagSupport.memory.providers.find((e=>{if(e.constructMethod===t)return!0}));if(e)return e.clone=a(e.instance),r.providers.push(e),e.instance;n=n.ownerTag}const o=`Could not inject provider: ${t.name} ${t}`;throw console.warn(`${o}. Available providers`,r.providers),new Error(o)}};function Pt(t,e){const r=d.memory.providerConfig;r.currentTagSuport=t,r.ownerTag=e,t.memory.providers.length&&(r.providers.length=0,r.providers.push(...t.memory.providers))}function Rt(t){const e=d.memory.stateConfig;let r;const n=e.rearray[e.array.length];if(n){let t=xt(n);r=e=>[t,t=e];const o={callback:r,lastValue:t,defaultValue:n.defaultValue};return e.array.push(o),e=>(o.callback=e||(e=>[t,t=e]),t)}let o=(t instanceof Function?t:()=>t)();r=t=>[o,o=t];const s={callback:r,lastValue:o,defaultValue:o};return e.array.push(s),t=>(s.callback=t||(t=>[o,o=t]),o)}function xt(t){const e=t.callback;if(!e)return t.defaultValue;const r=e(jt),[n]=r,[o]=e(n);if(o!==jt)throw new Error('State property not used correctly.\n\nFor "let" state use `let name = state(default, x => [name, name = x])`\n\nFor "const" state use `const name = state(default)`\n\nProblem function:\n'+t+"\n");return n}d({beforeRender:(t,e)=>{Pt(t,e)},beforeRedraw:(t,e)=>{Pt(t,e.ownerTag)},afterRender:t=>{const e=d.memory.providerConfig;t.memory.providers=[...e.providers],e.providers.length=0}}),d.memory.stateConfig={array:[],rearray:[]},d({beforeRender:t=>kt(t),beforeRedraw:t=>kt(t),afterRender:(t,e)=>{const r=t.memory.state,n=d.memory.stateConfig;if(n.rearray.length&&n.rearray.length!==n.array.length){const e=`States lengths mismatched ${n.rearray.length} !== ${n.array.length}`;throw console.error(e,{oldStates:n.array,newStates:n.rearray,component:t.templater?.wrapper.original}),new Error(e)}n.rearray=[],r.newest=[...n.array],n.array=[]}});class jt{}function kt(t){const e=t.memory.state,r=d.memory.stateConfig;if(r.rearray.length){const n="last array not cleared";throw console.error(n,{config:r,component:t.templater?.wrapper.original,state:e}),n}r.rearray=[],e?.newest.length&&r.rearray.push(...e.newest)}function Vt(t){d.memory.initCurrentSupport=t}function Ot(t){d.memory.initCurrentSupport?d.memory.initCurrentSupport.memory.init||(d.memory.initCurrentSupport.memory.init=t,t()):console.warn("possible init issue?")}let Bt;function Ft(t){Bt.memory||console.error("xxx",Bt),Bt.memory.destroyCallback=t}d({beforeRender:t=>Vt(t),beforeRedraw:t=>Vt(t)}),d({beforeRender:t=>Bt=t,beforeRedraw:t=>Bt=t,beforeDestroy:(t,e)=>{const r=t.memory.destroyCallback;r&&r()}});let Nt=()=>t=>()=>{throw new Error("The real callback function was called and that should never occur")};function _t(t,e){t.forEach(((t,r)=>{const n=xt(t),o=e[r].callback;o&&o(n),e[r].lastValue=n}))}function $t(t){Nt=()=>{const e=d.memory.stateConfig.array;return r=>(...n)=>function(t,e,r,...n){const o=t.memory.state.newest;_t(o,r);const s=e(...n);_t(r,o),t.render(),s instanceof Promise&&s.finally((()=>{_t(r,o),t.render()}))}(t,r,e,...n)}}d({beforeRender:t=>$t(t),beforeRedraw:t=>$t(t)});var Lt=e.xQ,Mt=e.Vp,Ut=e.fx,Wt=e.RN,Dt=e.er,It=e.dy,Jt=e.jW,Xt=e.SO,qt=e.IT,Gt=e.SW,Ht=e.js,Qt=e.ev,zt=e.nc,Zt=e.a,Kt=e._b,Yt=e.hs,te=e.lc,ee=e.SB,re=e._q,ne=e.bX,oe=e.Cc,se=e.pJ;export{Lt as Subject,Mt as Tag,Ut as TagSupport,Wt as getCallback,Dt as getTagSupport,It as html,Jt as initWebComponents,Xt as interpolateElement,qt as interpolateString,Gt as isTagComponent,Ht as loadTagGateway,Qt as onDestroy,zt as onInit,Zt as providers,Kt as redrawTag,Yt as runBeforeRender,te as setUse,ee as state,re as tag,ne as tagElement,oe as tagGateway,se as tags};