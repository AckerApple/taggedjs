var t={d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};function r(t,e,r,n){return e.renderWithSupport(t,r,n)}function n(t){const e={beforeRender:t.beforeRender||(()=>{}),beforeRedraw:t.beforeRedraw||(()=>{}),afterRender:t.afterRender||(()=>{}),beforeDestroy:t.beforeDestroy||(()=>{})};n.tagUse.push(e)}function o(t,e){n.tagUse.forEach((r=>r.beforeRender(t,e)))}function a(t,e){n.tagUse.forEach((r=>r.afterRender(t,e)))}function s(t,e){n.tagUse.forEach((r=>r.beforeRedraw(t,e)))}function i(t){return u(t,new WeakMap)}function u(t,e){if(null===t||"object"!=typeof t)return t;if(e.has(t))return e.get(t);if(t instanceof Date)return new Date(t);if(t instanceof RegExp)return new RegExp(t);const r=Array.isArray(t)?[]:Object.create(Object.getPrototypeOf(t));if(e.set(t,r),Array.isArray(t))for(let n=0;n<t.length;n++)r[n]=u(t[n],e);else for(const n in t)t.hasOwnProperty(n)&&(r[n]=u(t[n],e));return r}function c(t,e){return l(t,e,new WeakMap)}function l(t,e,r){if(t===e||(o=e,(n=t)instanceof Function&&o instanceof Function&&n.toString()===o.toString()))return!0;var n,o;if("object"!=typeof t||"object"!=typeof e||null===t||null===e)return!1;const a=Object.keys(t),s=Object.keys(e);if(a.length!==s.length)return!1;if(r.has(t))return!0;r.set(t,0);for(const n of a)if(!s.includes(n)||!l(t[n],e[n],r))return!1;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!l(t[n],e[n],r))return!1}else if(Array.isArray(t)||Array.isArray(e))return!1;return!0}function p(t,e){if(t===e)throw new Error("someting here");const r=t.propsConfig.latest;if(function(t,e,r){if(void 0===t&&t===r)return!1;let n=t,o=e;if("object"==typeof t){if(!e)return!0;if(n={...t},o={...e||{}},!Object.entries(n).every((([t,e])=>{let r=o[t];return!(e instanceof Function)||r instanceof Function&&(r.original&&(r=r.original),e.original&&(e=e.original),e.toString()===r.toString()&&(delete n[t],delete o[t],!0))})))return!0}return!c(e,t)}(e.propsConfig.latest,t.propsConfig.latestCloned,r))return!0;const n=function(t,e){const r=t.propsConfig.lastClonedKidValues,n=e.propsConfig.lastClonedKidValues,o=r.every(((t,e)=>{const r=n[e];return t.every(((t,e)=>t===r[e]))}));return!o}(t,e);return n}function g(t){t.tagSupport.memory.providers.filter((t=>!c(t.instance,t.clone))).forEach((e=>{!function(t,e){d(t,e).forEach((({tag:t,renderCount:e,provider:r})=>{e===t.tagSupport.memory.renderCount&&(r.clone=i(r.instance),t.tagSupport.render())}))}(t.getAppElement(),e),e.clone=i(e.instance)}))}function d(t,e,r=[]){const n=t.tagSupport.memory.providers.find((t=>t.constructMethod===e.constructMethod));return n&&r.push({tag:t,renderCount:t.tagSupport.memory.renderCount,provider:n}),t.children.forEach((t=>d(t,e,r))),r}function f(t,e,r){const n=r.memory.renderCount;if(g(t),n!==r.memory.renderCount)return!0;const o=p(t.tagSupport,e.tagSupport),a=r.templater;return r.newest=a.redraw(),e.newest=r.newest,!o}t.d(e,{W9:()=>G,ei:()=>Q,B7:()=>A,vw:()=>bt,PC:()=>q,uX:()=>S,Ot:()=>j,eQ:()=>$t,cF:()=>Mt,qy:()=>wt,u2:()=>ut,zl:()=>lt,_4:()=>w,iO:()=>v,mn:()=>y,Yn:()=>b,sA:()=>Nt,MG:()=>Ot,r5:()=>xt,iz:()=>r,vJ:()=>o,hZ:()=>At,Un:()=>Vt,Ie:()=>Ft,AI:()=>n,Tc:()=>O,Hf:()=>m,_A:()=>F,wB:()=>Rt}),n.tagUse=[],n.memory={};const h=[];function m(t,e,r){const n=h.findIndex((t=>t.element===e));n>=0&&(h[n].tag.destroy(),h.splice(n,1),console.warn("Found and destroyed app element already rendered to element",{element:e}));const s=function(t){const e=t.tagSupport;o(e,void 0);const r=t.wrapper();return a(e,r),{tag:r,tagSupport:e}}(t(r)),{tag:i,tagSupport:u}=s;i.appElement=e,i.tagSupport.oldest=i,function(t,e){t.templater.redraw=()=>{const r=e,{retag:n}=t.templater.renderWithSupport(t,r,{});return e.updateByTag(n),n},t.mutatingRender=()=>(f(e,t.templater,t),e)}(i.tagSupport,i);const c=document.createElement("template");return c.setAttribute("id","app-tag-"+h.length),c.setAttribute("app-tag-detail",h.length.toString()),e.appendChild(c),i.buildBeforeElement(c),e.setUse=t.original.setUse,h.push({element:e,tag:i}),{tag:i,tags:t.original.tags}}function y(t){return!0===t?.isTemplater}function b(t){return!0===t?.isTag}function w(t){return!(!0!==t?.isSubject&&!t?.subscribe)}function v(t){return t instanceof Array&&t.every((t=>b(t)))}class S{templater;children;propsConfig;memory={context:{},state:{newest:[]},providers:[],renderCount:0};constructor(t,e,r){this.templater=t,this.children=e;const n=T(r,t);this.propsConfig={latest:r,latestCloned:n,clonedProps:n,lastClonedKidValues:e.value.map((t=>C(t.values)))},b(r)||(this.propsConfig.latestCloned=i(n),this.propsConfig.clonedProps=this.propsConfig.latestCloned)}oldest;newest;mutatingRender(){const t='Tag function "render()" was called in sync but can only be called async';throw console.error(t,{tagSupport:this}),new Error(t)}render(){return++this.memory.renderCount,this.mutatingRender()}}function C(t){return t.map((t=>{const e=t;return b(e)?C(e.values):y(e)?i(e.tagSupport.propsConfig.latestCloned):v(e)?C(e):i(t)}))}class E{tagged;wrapper;insertBefore;newest;oldest;tagSupport;constructor(t,e){this.tagSupport=new S(this,e,t)}redraw;isTemplater=!0;renderWithSupport(t,e,r){++t.memory.renderCount;const i=e?.ownerTag||r;e?(t.propsConfig={...e.tagSupport.propsConfig},s(t,e)):(o(t,i),n.memory.providerConfig.ownerTag=i);const u=this.wrapper();return a(t,u),this.newest=u,u.ownerTag=i,t.newest=u,{remit:!0,retag:u}}}function T(t,e){const r=function(t,e){if("object"!=typeof t)return t;const r=t;return Object.entries(r).forEach((([t,n])=>{if(n instanceof Function){const o=r[t].original;return o?(r[t]=(...t)=>e(n,t),void(r[t].original=o)):(r[t]=(...t)=>e(n,t),void(r[t].original=n))}})),r}(b(t)?0:t,(function(t,r){const n=t(...r),o=e.newest?.ownerTag?.tagSupport;return o&&o.render(),n}));return r}class A{value;isSubject=!0;subscribers=[];constructor(t){this.value=t}subscribe(t){this.subscribers.push(t),R.globalSubs.push(t);const e=R.globalSubCount$;R.globalSubCount$.set(e.value+1);const r=()=>{r.unsubscribe()};return r.unsubscribe=()=>{V(this.subscribers,t),V(R.globalSubs,t),R.globalSubCount$.set(e.value-1),r.unsubscribe=()=>{}},r}set(t){this.value=t,this.subscribers.forEach((e=>{e.value=t,e(t)}))}next=this.set}function V(t,e){const r=t.indexOf(e);-1!==r&&t.splice(r,1)}const R=A;R.globalSubs=[],R.globalSubCount$=new A,R.globalSubCount$.set(0);class j extends A{value;constructor(t){super(t),this.value=t}subscribe(t){const e=super.subscribe(t);return t(this.value),e}}function x(t,e){if(t.isChildOverride)return t;const r=(r,n)=>k(t,e,r,n);return r.tagFunction=t,r}function k(t,e,r,n){const o=e.tagSupport,a=(o&&o.memory.renderCount,t.bind(r)(...n));return o.memory.renderCount,o.render(),a instanceof Promise?a.then((()=>(o.render(),"promise-no-data-ever"))):"no-data-ever"}const F=[];let B=0;function O(t){const e=function(e,r){(b(e)||v(e))&&(r=e,e=void 0);const{childSubject:n,madeSubject:o}=function(t){if(w(t))return{childSubject:t,madeSubject:!1};if(v(t))return{childSubject:new j(t),madeSubject:!0};const e=t;return e?(e.arrayValue=0,{childSubject:new j([e]),madeSubject:!0}):{childSubject:new j([]),madeSubject:!0}}(r);n.isChildSubject=!0;const a=new E(e,n);function s(){const t=s.original,e=a.tagSupport,r=a.oldest;let u=e.propsConfig.latest,c=T(u,a);const l=t(c,n);e.mutatingRender===S.prototype.mutatingRender&&(e.oldest=l,e.mutatingRender=()=>{if(f(l,a,e))return l;if(l.ownerTag){const t=l.ownerTag.tagSupport.render();return l.ownerTag.tagSupport.newest=t,l}return l}),l.tagSupport=new S(a,e.children);const p=i(c);return l.tagSupport.propsConfig={latest:u,latestCloned:p,clonedProps:p,lastClonedKidValues:l.tagSupport.propsConfig.lastClonedKidValues},l.tagSupport.memory=e.memory,l.tagSupport.mutatingRender=e.mutatingRender,e.newest=l,e.propsConfig={...l.tagSupport.propsConfig},r&&(r.tagSupport.propsConfig={...l.tagSupport.propsConfig}),o&&n.value.forEach((t=>{t.values.forEach(((e,r)=>{e instanceof Function&&(t.values[r].isChildOverride||(t.values[r]=function(...t){k(e,l.ownerTag,this,t)},t.values[r].isChildOverride=!0))}))})),l}return s.original=t,a.tagged=!0,a.wrapper=s,a};return function(t,e){t.isTag=!0,t.original=e}(e,t),function(t){t.tags=F,t.setUse=n,t.tagIndex=++B}(t),F.push(t),e}function P(t,e){e.parentNode.insertBefore(t,e)}function N(t,e,r){const n=t.split(".");if("style"===n[0]&&(r.style[n[1]]=e),"class"===n[0])return n.shift(),void(e?n.forEach((t=>r.classList.add(t))):n.forEach((t=>r.classList.remove(t))))}function $(t,e,r){t.setAttribute(e,r)}function U(t,e,r){t[e]=r}function _(t,e,r){const n=t.getAttributeNames();"TEXTAREA"!==t.nodeName||n.includes("value")||W("textVarValue",t.getAttribute("textVarValue"),t,e,r,((e,r)=>t.value=r));let o=$;n.forEach((n=>{"INPUT"===t.nodeName&&"value"===n&&(o=U),W(n,t.getAttribute(n),t,e,r,o),o=$}))}function M(t){return t.search(/^(class|style)(\.)/)>=0}function W(t,e,r,n,o,a){if(D(e))return function(t,e,r,n,o,a){return X(t,K(n,e),r,o,a)}(t,e,r,n,o,a);if(D(t)){let e;const s=K(n,t).subscribe((t=>{!function(t,e,r,n,o){if(e&&e!=t&&("string"==typeof e?r.removeAttribute(e):e instanceof Object&&Object.entries(e).forEach((([t])=>r.removeAttribute(t)))),"string"!=typeof t)t instanceof Object&&Object.entries(t).forEach((([t,e])=>X(t,e,r,n,o)));else{if(!t.length)return;X(t,"",r,n,o)}}(t,e,r,o,a),e=t}));return o.cloneSubs.push(s),void r.removeAttribute(t)}return M(t)?N(t,e,r):void 0}new class{};const I=/^\s*{__tagvar/,L=/}\s*$/;function D(t){return t&&t.search(I)>=0&&t.search(L)>=0}function K(t,e){return t[e.replace("{","").split("").reverse().join("").replace("}","").split("").reverse().join("")]}function X(t,e,r,n,o){const a=M(t);if(e instanceof Function){const n=function(...t){return e(r,t)};r[t].action=n}if(w(e)){r.removeAttribute(t);const s=e=>function(t,e,r,n,o){if(t instanceof Function)return e[r]=function(...r){return t(e,r)},void(e[r].tagFunction=t);if(n)return void N(r,t,e);if(t)return void o(e,r,t);void 0===t||!1===t||null===t?e.removeAttribute(r):o(e,r,t)}(e,r,t,a,o),i=e.subscribe(s);n.cloneSubs.push(i)}else o(r,t,e)}const z=/(?:<[^>]*?(?:(?:\s+\w+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^>\s]+)))*\s*)\/?>)|({__tagvar[^}]+})/g;function H(t,e,r,{counts:n,forceElement:o}){const a=e,s=a.tag;if(s&&!o&&s.isLikeTag(t)){if(e instanceof Function){const t=e(s.tagSupport);return s.updateByTag(t),[]}return s.updateByTag(t),[]}if(!r||!r.parentNode)throw new Error("bad parent already started");const i=t.buildBeforeElement(r,{counts:n,forceElement:o});return a.tag=a.tag||t,i}function J(t,e,r,a,i){if(!0!==t.tagged){let e=t.wrapper.original.name||t.wrapper.original.constructor?.name;"Function"===e&&(e=void 0);const r=e||t.wrapper.original.toString().substring(0,120);throw new Error(`Not a tag component. Wrap your function with tag(). Example tag(props => html\`\`) on component:\n\n${r}\n\n`)}const u=t;u.insertBefore=r;const c=t.tagSupport;let l=u.newest;return n.memory.providerConfig.ownerTag=a,l&&!i.forceElement||(l?s(c,u.oldest):o(c,a),l=u.renderWithSupport(c,e.tag,a).retag,u.newest=l),a.children.push(l),c.templater=l.tagSupport.templater,H(l,e,r,i)}class q extends Error{details;constructor(t,e,r={}){super(t),this.name=q.name,this.details={...r,errorCode:e}}}class G extends q{constructor(t,e){super(t,"array-no-key-error",e),this.name=G.name}}class Q extends q{constructor(t,e){super(t,"state-mismatch-error",e),this.name=Q.name}}function Y(t,e,r,n,o){const a=[];t.lastArray=t.lastArray||[],t.template=r;let s=0;t.lastArray=t.lastArray.filter(((r,n)=>{const a=e.length-1<n-s,i=e[n-s],u=i?.arrayValue;return!(a||!Z(u,r.tag.arrayValue))||(t.lastArray[n].tag.destroy({stagger:o.counts.removed,byParent:!1}),++s,++o.counts.removed,!1)}));const i=r||r.clone;return e.forEach(((r,s)=>{const u=t.lastArray[s],c=r.tagSupport||u?.tag.tagSupport;r.tagSupport=c||new S({},new j([])),c?c.newest=r:(r.tagSupport.mutatingRender=()=>(n.tagSupport.render(),r),n.children.push(r)),r.ownerTag=n;const l=r.arrayValue;if(l?.isArrayValueNeverSet){const t={template:r.getTemplate().string,array:e,ownerTagContent:n.lastTemplateString},o="Use html`...`.key(item) instead of html`...` to template an Array";throw console.error(o,t),new G(o,t)}if(t.lastArray.length>s)return Z(u.tag.arrayValue,r.arrayValue)?(r.tagSupport=r.tagSupport||u.tag.tagSupport,u.tag.updateByTag(r),[]):[];const p=function(t,e,r,n,o){r.lastArray.push({tag:e,index:n});const a={added:o.counts.added+n,removed:o.counts.removed},s=t;return e.buildBeforeElement(s,{counts:a,forceElement:o.forceElement})}(i,r,t,s,o);a.push(...p)})),a}function Z(t,e){return t===e||!!(t instanceof Array&&e instanceof Array&&t.length==e.length)&&t.every(((t,r)=>t==e[r]))}function tt(t,e,r){e.template=r;const n=e.clone||r;e.lastValue=t;const o=function(t,e){const r=e.parentNode;void 0!==t&&!1!==t&&null!==t||(t="");const n=document.createTextNode(t);return r.insertBefore(n,e),r.removeChild(e),n}(t,n);return e.clone=o,[]}var et;function rt(t,e,r,n,o){return t.tagSupport||(t.tagSupport=new S({},new j([])),t.tagSupport.mutatingRender=()=>{n.tagSupport.render()},t.tagSupport.oldest=t.tagSupport.oldest||t,n.children.push(t),t.ownerTag=n),e.template=r,H(t,e,r,o)}function nt(t,e,r,n,o){const a=[];if(!t.hasAttribute("end"))return a;const s=t.getAttribute("id");if(s?.substring(0,dt.length)!==dt)return a;const i=e[s];let u=o.forceElement;const c=i.subscribe((e=>{i.clone&&(t=i.clone);const{clones:o}=function(t,e,r,n,o){const a=function(t){return y(t)?et.tagComponent:b(t)?et.tag:v(t)?et.tagArray:et.value}(t);switch(a){case et.tag:return{clones:rt(t,e,r,n,o)};case et.tagArray:return{clones:Y(e,t,r,n,o)};case et.tagComponent:return{clones:J(t,e,r,n,o)}}return{clones:tt(t,e,r)}}(e,i,t,r,{counts:{added:n.added,removed:n.removed},forceElement:u});u&&(u=!1),o.push(...o)}));return r.cloneSubs.push(c),a}function ot(t,e){if(!t.getAttribute)return;let r=e.counts.added;e.forceElement||(r=function(t,e){const r=t.oninit;if(!r)return e.added;const n=r.tagFunction;if(!n)return e.added;const o=n.tagFunction;return o?(o({target:t,stagger:e.added}),++e.added):e.added}(t,e.counts)-r),t.children&&(e.counts.added,e.counts.removed,new Array(...t.children).forEach(((t,r)=>ot(t,{...e,counts:e.counts}))))}!function(t){t.tag="tag",t.tagArray="tag-array",t.tagComponent="tag-component",t.value="value"}(et||(et={}));const at=new RegExp('\\s*<template interpolate end id="__tagvar(\\d{1,4})"([^>]*)></template>(\\s*)');function st(t,e,r,n,o){if(!o||"TEMPLATE"===t.tagName)return[];const a=n.counts,s=[],i=new Array(...o);return"TEXTAREA"===t.tagName&&it(t),i.forEach((t=>{const o=nt(t,e,r,a,n);"TEXTAREA"===t.tagName&&it(t),s.push(...o),t.children&&new Array(...t.children).forEach(((t,o)=>{(function(t){return"TEMPLATE"===t.tagName&&void 0!==t.getAttribute("interpolate")&&void 0!==t.getAttribute("end")})(t)&&nt(t,e,r,a,n);const i=st(t,e,r,n,t.children);s.push(...i)}))})),s}function it(t){const e=t.value;if(e.search(at)>=0){const r=e.match(/__tagvar(\d{1,4})/),n="{"+(r?r[0]:"")+"}";t.value="",t.setAttribute("textVarValue",n)}}function ut(t,e,r,n,o){const a=[],s=r.interpolation,i=t.children[0].content.children;if(s.keys.length){const r=st(t,e,n,o,i);a.push(...r)}return _(t,e,n),ct(i,e,n),a}function ct(t,e,r){new Array(...t).forEach((t=>{_(t,e,r),t.children&&ct(t.children,e,r)}))}function lt(t){const e=function(t){const e=[];return{string:t.replace(z,((t,r)=>{if(t.startsWith("<"))return t;const n=r.substring(1,r.length-1);return e.push(n),`<template interpolate end id="${n}"></template>`})),keys:e}}(t);return e.string=e.string.replace(mt,dt),e}function pt(t,e,r){t.redraw=()=>{const n=e.tag,o=n?.tagSupport||t.tagSupport,{retag:a}=t.renderWithSupport(o,n,r);return e.set(t),a}}function gt(t,e){delete e.tag,delete e.tagSupport,t.destroy()}const dt="__tagvar",ft="--"+dt+"--",ht=new RegExp(dt,"g"),mt=new RegExp(ft,"g");class yt{isArrayValueNeverSet=!0}class bt{strings;values;isTag=!0;clones=[];cloneSubs=[];children=[];tagSupport;ownerTag;appElement;arrayValue=new yt;constructor(t,e){this.strings=t,this.values=e}key(t){return this.arrayValue=t,this}async destroy(t={stagger:0,byParent:!1}){!!this.tagSupport&&function(t,e){n.tagUse.forEach((r=>r.beforeDestroy(t,e)))}(this.tagSupport,this),this.destroySubscriptions();const e=this.children.map((e=>e.destroy({...t,byParent:!0})));return this.children.length=0,this.ownerTag&&(this.ownerTag.children=this.ownerTag.children.filter((t=>t!==this))),t.byParent||(t.stagger=await this.destroyClones(t)),await Promise.all(e),t.stagger}destroySubscriptions(){this.cloneSubs.forEach((t=>t.unsubscribe())),this.cloneSubs.length=0}async destroyClones({stagger:t}={stagger:0}){let e=!1;const r=this.clones.reverse().map(((r,n)=>{let o;r.ondestroy&&(o=function(t,e){const r=t.ondestroy;if(!r)return;const n=r.tagFunction;if(!n)return;const o=n.tagFunction;return o?o({target:t,stagger:e}):void 0}(r,t));const a=()=>{r.parentNode?.removeChild(r);const t=this.ownerTag;t&&(t.clones=t.clones.filter((t=>t!==r)))};return o instanceof Promise?(e=!0,o.then(a)):a(),o}));return this.clones.length=0,e&&await Promise.all(r),t}updateByTag(t){this.updateConfig(t.strings,t.values),this.tagSupport.templater=t.tagSupport.templater,this.tagSupport.propsConfig={...t.tagSupport.propsConfig},this.tagSupport.newest=t}lastTemplateString=void 0;updateConfig(t,e){this.strings=t,this.updateValues(e)}getTemplate(){const t=lt(this.strings.map(((t,e)=>(t.replace(ht,ft)+(this.values.length>e?`{${dt}${e}}`:"")).replace(/>\s*/g,">").replace(/\s*</g,"<"))).join(""));return this.lastTemplateString=t.string,{interpolation:t,string:t.string,strings:this.strings,values:this.values,context:this.tagSupport?.memory.context||{}}}isLikeTag(t){const{string:e}=t.getTemplate();if(!this.lastTemplateString)throw new Error("no template here");return e===this.lastTemplateString&&t.values.length===this.values.length&&!!t.values.every(((t,e)=>{const r=this.values[e];return!(t instanceof Function&&r instanceof Function)||!(t.toString()!==r.toString())}))}update(){return this.updateContext(this.tagSupport.memory.context)}updateValues(t){return this.values=t,this.updateContext(this.tagSupport.memory.context)}updateContext(t){return this.strings.map(((e,r)=>{const n=dt+r,o=this.values.length>r,u=this.values[r];if(n in t)return function(t,e,r){const n=t.value,o=t,u=t,c=o.isChildSubject,l=y(e);if(c&&(e=e.value),function(t,e){const r=t.lastArray;if(r&&!v(e))return r.forEach((({tag:t})=>t.destroy())),delete t.lastArray,1;const n=t,o=n.tag;if(o){const r=b(e);return b(t.value)&&r?(s=o,((a=e).strings.length!==s.strings.length||!a.strings.every(((t,e)=>s.strings[e]===t))||a.values.length!==s.values.length)&&(gt(o,n),2)):!y(e)&&(gt(o,n),3)}var a,s;const i=t,u="lastValue"in i,c=i.lastValue;u&&c!==e&&function(t,e){const r=e.clone,n=r.parentNode;if(r===t)throw"ok";n.insertBefore(t,r),n.removeChild(r),delete e.clone,delete e.lastValue}(i.template,i)}(t,e),l)return function(t,e,r,n){let o=r.tag;if(!o)return pt(e,r,t),void e.redraw();const a=o.tagSupport.templater.wrapper,s=e.wrapper;let u=!1;a&&s&&(u=a.original===s.original);const c=e.tagSupport.propsConfig.latest,l=o.tagSupport;if(l.propsConfig.latest=c,u){const t=n?.tagSupport;let r=t.props;if(b(t.props)||(r=i(t.props)),o&&!p(l,e.tagSupport))return}else gt(o,r);pt(e,r,t),l.templater=e;const g=e.redraw();o.isLikeTag(g)||(o.destroy(),r.tagSupport=g.tagSupport,r.tag=g,l.oldest=g),l.newest=g,l.propsConfig={...e.tagSupport.propsConfig}}(r,e,u,n);const g=u.tag;if(g)!function(t,e,r,n){const o=t.tagSupport.templater.wrapper,i=r?.wrapper,u=o&&i&&o?.original===i?.original,c=r&&t.lastTemplateString===r.lastTemplateString,l=r&&r.getTemplate&&t.isLikeTag(r);c||l?rt(r,e,e.template,n,{counts:{added:0,removed:0}}):u?function(t,e,r){const n=e.tagSupport,o=n.oldest;n.newest,s(o.tagSupport,o);const i=t.wrapper();t.newest=i,n.newest=i,a(o.tagSupport,o),e.updateByTag(i),r.set(t)}(r,t,e):tt(r,e,e.template)}(g,t,e,r);else if(v(e)){const n=Y(t,e,o.template||u.tag?.tagSupport.templater.insertBefore,r,{counts:{added:0,removed:0}});r.clones.push(...n)}else e instanceof Function?u.set(x(e,r)):w(e)?u.set(e.value):u.set(e)}(t[n],u,this);!function(t,e,r,n,o){if(y(e))pt(e,r[n]=new j(e),o);else if(e instanceof Function)r[n]=function(t,e){return new j(x(t,e))}(e,o);else if(t)b(e)?(e.ownerTag=o,o.children.push(e),r[n]=new j(e)):w(e)?r[n]=e:r[n]=new j(e)}(o,u,t,n,this)})),t}getAppElement(){let t=this;for(;t.ownerTag;)t=t.ownerTag;return t}rebuild(){const t=this.tagSupport.templater.insertBefore;if(!t){const t=new Error("Cannot rebuild. Previous insertBefore element is not defined on tag");throw t.tag=this,t}this.buildBeforeElement(t,{forceElement:!0,counts:{added:0,removed:0}})}buildBeforeElement(t,e={forceElement:!1,counts:{added:0,removed:0}}){this.tagSupport.templater.insertBefore=t;const r=this.update(),n=this.getTemplate(),o=document.createElement("div");o.id="tag-temp-holder",o.innerHTML=`<template id="temp-template-tag-wrap">${n.string}</template>`;const a=ut(o,r,n,this,{forceElement:e.forceElement,counts:e.counts});this.clones.length=0;const s=function(t,e){const r=[];let n=t.children[0].content.firstChild;for(;n;){const t=n.nextSibling;P(n,e),r.push(n),n=t}return r}(o,t);return this.clones.push(...s),a.length&&(this.clones=this.clones.filter((t=>!a.find((e=>e===t))))),this.clones.forEach((t=>ot(t,e))),this.clones}}function wt(t,...e){return new bt(t,e)}function vt(t,e){return r=>(e.callback=r||(e=>[t,t=e]),t)}n.memory.stateConfig={array:[],rearray:[]};const St=[];function Ct(t){const e=t.callback;if(!e)return t.defaultValue;const r=e(Et),[n]=r,[o]=e(n);if(o!==Et){const a='State property not used correctly. Second item in array is not setting value as expected.\n\nFor "let" state use `let name = state(default)(x => [name, name = x])`\n\nFor "const" state use `const name = state(default)()`\n\nProblem state:\n'+(e?e.toString():JSON.stringify(t))+"\n";throw console.error(a,{state:t,callback:e,oldState:r,oldValue:n,checkValue:o}),new Error(a)}return n}n({beforeRender:t=>Tt(t),beforeRedraw:t=>Tt(t),afterRender:t=>{const e=t.memory.state,r=n.memory.stateConfig;if(r.rearray.length&&r.rearray.length!==r.array.length){const e=`States lengths mismatched ${r.rearray.length} !== ${r.array.length}`;throw new Q(e,{oldStates:r.array,newStates:r.rearray,component:t.templater?.wrapper.original})}r.rearray=[],e.newest=[...r.array],r.array=[],St.forEach((t=>t())),St.length=0}});class Et{}function Tt(t){const e=t.memory.state,r=n.memory.stateConfig;if(r.rearray.length){const n="last array not cleared";throw console.error(n,{config:r,component:t.templater?.wrapper.original,state:e,expectedClearArray:r.rearray}),new Q(n,{config:r,component:t.templater?.wrapper.original,state:e,expectedClearArray:r.rearray})}r.rearray=[],e?.newest.length&&r.rearray.push(...e.newest)}function At(t){const e=n.memory.stateConfig;let r;const o=e.rearray[e.array.length];if(o){let t=Ct(o);r=e=>[t,t=e];const n={callback:r,lastValue:t,defaultValue:o.defaultValue};return e.array.push(n),t}let a=(t instanceof Function?t:()=>t)();r=t=>[a,a=t];const s={callback:r,lastValue:a,defaultValue:a};return e.array.push(s),a}function Vt(t){const e=n.memory.stateConfig;let r;const o=e.rearray[e.array.length];if(o){let t=Ct(o);r=e=>[t,t=e];const n={callback:r,lastValue:t,defaultValue:o.defaultValue};return e.array.push(n),vt(t,n)}let a=(t instanceof Function?t:()=>t)();r=t=>[a,a=t];const s={callback:r,lastValue:a,defaultValue:a};return e.array.push(s),vt(a,s)}function Rt(t,e){let r=Vt(void 0)((t=>[r,r=t]));return void 0===r?(e(t,r),r=t,t):(t.every(((t,e)=>t===r[e]))||(e(t,r),r=t),t)}function jt(t){return n.memory.providerConfig.providers.find((e=>e.constructMethod===t))}n.memory.providerConfig={providers:[],ownerTag:void 0};const xt={create:t=>{const e=jt(t);if(e)return e.clone=i(e.instance),e.instance;const r=t.constructor?new t:t();return n.memory.providerConfig.providers.push({constructMethod:t,instance:r,clone:i(r)}),r},inject:t=>{const e=jt(t);if(e)return e.instance;const r=n.memory.providerConfig;let o={ownerTag:r.ownerTag};for(;o.ownerTag;){const e=o.ownerTag.tagSupport.memory.providers.find((e=>{if(e.constructMethod===t)return!0}));if(e)return e.clone=i(e.instance),r.providers.push(e),e.instance;o=o.ownerTag}const a=`Could not inject provider: ${t.name} ${t}`;throw console.warn(`${a}. Available providers`,r.providers),new Error(a)}};function kt(t,e){const r=n.memory.providerConfig;r.ownerTag=e,t.memory.providers.length&&(r.providers.length=0,r.providers.push(...t.memory.providers))}function Ft(t){const e=n.memory.stateConfig,[r]=t(void 0);t(r);const o=e.rearray[e.array.length];if(o){let n=o.watch,a=Ct(o);const s={callback:t,lastValue:a,watch:o.watch};return r!=n&&(s.watch=r,a=s.lastValue=r),e.array.push(s),t(a),a}const a={callback:t,lastValue:r,watch:r};return e.array.push(a),r}function Bt(t){n.memory.initCurrentSupport=t}function Ot(t){n.memory.initCurrentSupport.memory.init||(n.memory.initCurrentSupport.memory.init=t,t())}let Pt;function Nt(t){Pt.memory.destroyCallback=t}n({beforeRender:(t,e)=>{kt(t,e)},beforeRedraw:(t,e)=>{kt(t,e.ownerTag)},afterRender:t=>{const e=n.memory.providerConfig;t.memory.providers=[...e.providers],e.providers.length=0}}),n({beforeRender:t=>Bt(t),beforeRedraw:t=>Bt(t)}),n({beforeRender:t=>Pt=t,beforeRedraw:t=>Pt=t,beforeDestroy:(t,e)=>{const r=t.memory.destroyCallback;r&&r()}});let $t=()=>t=>()=>{throw new Error("The real callback function was called and that should never occur")};function Ut(t,e){t.forEach(((t,r)=>{const n=Ct(t),o=e[r].callback;o&&o(n),e[r].lastValue=n}))}function _t(t){$t=()=>{const e=n.memory.stateConfig.array;return r=>(...n)=>function(t,e,r,...n){const o=t.memory.state.newest;Ut(o,r);const a=e(...n);Ut(r,o),t.render(),a instanceof Promise&&a.finally((()=>{Ut(r,o),t.render()}))}(t,r,e,...n)}}n({beforeRender:t=>_t(t),beforeRedraw:t=>_t(t)});const Mt={tagElement:m,redrawTag:r};var Wt=e.W9,It=e.ei,Lt=e.B7,Dt=e.vw,Kt=e.PC,Xt=e.uX,zt=e.Ot,Ht=e.eQ,Jt=e.cF,qt=e.qy,Gt=e.u2,Qt=e.zl,Yt=e._4,Zt=e.iO,te=e.mn,ee=e.Yn,re=e.sA,ne=e.MG,oe=e.r5,ae=e.iz,se=e.vJ,ie=e.hZ,ue=e.Un,ce=e.Ie,le=e.AI,pe=e.Tc,ge=e.Hf,de=e._A,fe=e.wB;export{Wt as ArrayNoKeyError,It as StateMismatchError,Lt as Subject,Dt as Tag,Kt as TagError,Xt as TagSupport,zt as ValueSubject,Ht as getCallback,Jt as hmr,qt as html,Gt as interpolateElement,Qt as interpolateString,Yt as isSubjectInstance,Zt as isTagArray,te as isTagComponent,ee as isTagInstance,re as onDestroy,ne as onInit,oe as providers,ae as redrawTag,se as runBeforeRender,ie as set,ue as setLet,ce as setProp,le as setUse,pe as tag,ge as tagElement,de as tags,fe as watch};